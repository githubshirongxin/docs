---
layout: post
titile: redis基础
---

jedis

## 1. redis基本数据类型和API
### 1.1 String类型
- 使用场景： 
  - 计数器
  - 统计多单位数量 uid:123454:fllow 0 ,
  - 粉丝数

https://www.bilibili.com/video/BV1S54y1R7SB?p=13&spm_id_from=pageDriver
![](/docs/images/2021-02-05-10-45-28.png)

```shell
###########################################
get key1 
# 获得一部分
getrange key1 0 3
getrange key1 0 -1  #获取全部字符串 = get key1

# 替换
setrange key1 1 xx

################################################
setex( set with expire) # 设置过期时间


setex key3 30 # 30 秒之后过期
ttl key3 # 看还剩多少时间过期

# 当前不存在就创建redis
setnx # ( set if not exist) # 设置不存在时才能设置成功，存在就设置失败。
setnx mykey "MongoDB" # 在分布式锁中常用。 返回0 就是没成功。不存在就创建kv

####################################
mset k1 v1 k2 v2 k3 v3 #一次设置多个kv对
keys *
mget k1 k2 k3 # 同时获取多个值。

msetnx k1 v1 k4 v4 # k1失败 ，原子行操作k4也失败。

# 对象
set user:1 {name:zhqangsan , age:30} # 设置一个User1对象为json字符串。
mset user:1:name zhangsan user:1:age 30
mget user:1:name user:1:age

# user:{id}:{field}
set articale:10000:view 0 

####################################

# 组合命令
getset # 先get后set
getset db redis
get db
getset db mongodb # 返回当前值，然后设置新的值。
get db

########################################
```

-  Jedis就是java的客户端。都是方法。

### 1.2 List类型
**可以做成堆栈，或队列。**

所有list命令都是L开头

Redis不区分大小写命令。

```shell
## 压入，弹出
LPUSH list one # list就是list的名字
LPUSH list two
LPUSH list three # 查到最顶的位置 最左边最新（最顶）
LRANGE list 0 -1 # 获取list中的值
LRANGE list 0 1 # 获取具体的值

Rpush list lastone # 查到最底部位置（最右边）

LPup list # 移除最左（最新的）
RPup list # 移除最老的


## 通过下表获取值
lindex list 1

lindex list 0

## 长度
llen list # 获取长度

## 移除指定的值  例如，取除关注
lrem list 1 one # 移除list中的one并且是1个， 精确匹配
lrem list 2 three # 移除两个three

########################################

## trim 修建，值保留一部分元素
Rpush mylist "hello"
Rpush mylist "hello1"
Rpush mylist "hello2"
Rpush mylist "hello3"

ltrim mylist 1 2  # 截取指定的长度，list已经被改变，只剩下截取后的部分。
lrange mylist 0 -1 # 只剩下hell1，hello2

# 组合命令 rpoplpush #移除列表最后一个元素，并添加一个新的元素
Rpush mylist "hello"
Rpush mylist "hello1"
Rpush mylist "hello2"
rpoplpush mylist myotherList # 将mylist先做rpop，然后对myotherlist做lpush 
lrange mylist 0 -1 # hello，hello1
lrange myotherlist 0 -1 # hello2

# 列表不存在的时候，lset更新就会报错。
EXISTS list
lset list 0 item # error no such key
lpush list value1 # 这样list就有值了。
lset list 0 item # 相当于更新。
lrange list 0 0 # 输出

########################################

# 清空当前db的内容 
flushdb

# 插入列表中某个具体位置
rpush mylist "hello"
rpush mylist "world"
linsert mylist before "world" "other"
lrange mylist 0 -1 # hello other world
linsert mylist after "other" "new"
lrange mylist 0 -1 # hello other new world


########################################
```

#### 小结：
* list实际上是一个链表。before node，after ， left，right
* key不存在，创建新的链表
* key存在，新增内容
* 移除key，所以的值消失，空链表。也不存在
* 在两边插入或改动之，效率最高。中间元素，相对效率低。

应用：
* 消息队列，还可以截断
* 栈


### 1.3 SET
set中的值不能重复，无序不重复集合。
应用：
- 可以抽随机

```shell
#########################################

sadd myset "hello" # 加入一个元素
sadd myset "kangshen" # （加入重复元素会失败）

Smembers myset # 显示所有set值

sismember myset "world" #判断某个值在不在set中。

scard myset # 显示元素个数

srem myset "hello" # 移除hello元素

srandmember myset # 随机抽选出一个元素
srandmember myset 2 # 随机抽选出2个元素

# 删除指定的key
spop myset # 随机删除一个元素
Smembers myset # 显示所有set值


# 将一个指定的值移动到另外一个set
sadd myset2 "set2"
smove myset myset2 "hello" 
smembers myset
smembers myset2

```

数字集合类：
- 差集
- 并集
- 交集

```shell
sadd key1 a
sadd key1 b
sadd key1 c

sadd key2 c
sadd key2 d
sadd key2 e

sdiff key1 key2 # 差集
sinter key1 key2 # 交集 ，例如共同好友。

sunion key1 key2 # 返回的结果就是并集

```

将A用户的，所有关注的人放在一个set集合总，他的粉丝也放在一个集合中。
共同关注，共同爱好。


### 1.4 Hash

Map集合，key-map 这个值就是map集合。

用法和string没什么区别。还是一个简单key-value

```shell
hset myhash field1 value1  # 存值
hget myhash field1 # 取值 
hmset myhash field1 value1 field2 value2 #  同时设置多个
hmget myhash field1 hield2 # 同时取得多个字段值

hgetall myhash # 获取所有 ，展示，就是key-value


hdel myhash field1 # 删除指定的key

hlen myhash # 获取hash的长度

hexists myhash field1 # 判断某个字段是否存在

# 只获得所有字段
hkeys myhash

# 只获得所有值
hvals myhash

# 增减
hset myhash field3 5
hincrby myhash field3 1   #指定增量
hincrby myhash field3 -1 
hdecrby myhash field3 1 

# 存在判断
hsetnx myhash field4 hello # 如果存在，创建失败。不存在，创建。


```

#### 应用：
- 处理经常变动的数据，经常变动的信息。Hash更适合于对象的存储。String更适合字符串的存储。
  - hset user:1 name "srx"
  - hget user:1 name

所以，对象用hash。


### 1.5 ZSet 排序集合
在set基础上，增加了排序功能。


```shell
# 添加
zadd myset 1 one
zadd myset 2 two  3 three

# 显示
zrange myset 0 -1 

zadd salary 2500 xiaohong
zadd salary 5000 zhangsan
zadd salary 500 lisi
# 排序
zrangebyscore salary -inf +inf # 增序 
# 只想查一部分
zrangebyscore salary -inf 2500 withscores #升序 带上value <2500的

# 移除rem中的元素
zrem salary xiaohong 
zrange salary 0 -1

# 查看所有元素个数
zcard salary 

zrange salary 0 -1 # 从高到低
zrange salary  # 从低到高

# 这个区间的元素个数
zcount salary 1000 2000 
```

**应用：**
- 工资表排序
- 权重，普通消息1 ，重要消息2.
- 排行榜，每分钟刷新。


### 其他API
去看官方文档。


## 2. 三种特殊数据类型

### 2.1 geospatial 地理位置
朋友定位，附近的人，城市距离，打车距离计算

城市经度纬度查询 www.json.cn/lngcode


```shell
# 添加具体位置 # 参数： key，纬度，经度，名称。
geoadd china:city 39.916527 116.397128  beijing
geoadd china:city 31.40527 121.48941   shanghai 
geoadd china:city 29.40268 106.54041  chongqing
geoadd china:city 22.55329 113.88308  shenzhen
geoadd china:city 30.2084 120.21201  hangzhou
geoadd china:city 34.23053 108.93425  xian
# 地球南北极无法直接添加。一般下载文件用java一次性导入

```


### 2.2 

### 2.3 
