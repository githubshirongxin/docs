---
layout: post
title: 课程表算法
---

工程上传：
[gitlab.ccbjb.com.cn/ec7mongrp/althtmp](https://gitlab.ccbjb.com.cn/ec7mongrp/althtmp)


## 背景：

### INPUT：前端输入
- 一周每天投入小时
- 起始日期
- 视频总时长
- 每个视频时长

### OUTPUT：算出
- 每个视频的预计开始时间



## 主函数
```java
package srx;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

/**
 * Hello world!
 *
 */
class Video {
	public float len;
	public String startDate;

	public Video(float _len) {
		this.len = _len;
	}
}

class Input {
	public float len;
	public String inputDate;

	public Input(float _len, String _inputDate) {
		this.len = _len;
		this.inputDate = _inputDate;
	}
}

public class App {
	
	/**
	 * 
	 * @param vlist 输入和输出，具体课程的所有视频一览
	 * @param inputWeek 每周投入的时间，index=0是周一，index=6是周日。
	 * @param startDate 计划开始时间
	 * @param videoSumDuration 该课程的视频时长
	 * @throws Throwable 
	 */
	public void planDate(List<Video> vlist,List<Float> inputWeek,String startDate,float videoSumDuration) throws Throwable {
		this.cacuVideoStartDate(vlist, this.getEndDate(inputWeek, startDate, videoSumDuration));
	}

	/**
	 * 主要算法，给视频开始日期做排序
	 * 
	 * @param vlist
	 * @param ilist
	 */
	public void cacuVideoStartDate(List<Video> vlist, List<Input> ilist) {

		float videoSum = 0;
		float inputSum = 0;

		int j = 0;
		int oldj = -1 ;
		for (int i = 0; i < vlist.size(); i++) {
			Video video = (Video) vlist.get(i);

			videoSum += video.len;

			//System.out.println("video.len=" + video.len);
			while (j < ilist.size()) {
				Input input = (Input) ilist.get(j);

				if(oldj < j) {
				  inputSum += input.len;
				  oldj = j;
				}
				
				//System.out.println("-------------> input.len=" + input.len);
				if (i == 0) {
					video.startDate = input.inputDate;
					if(videoSum >= inputSum) {
					  j++;
					}
					break;
				}

				//System.out.println("videoSum="+videoSum+" , inputSum="+inputSum);
				if (videoSum <= inputSum) {
					video.startDate = input.inputDate;
					if (videoSum == inputSum) {
						j++;
					}
					break;
				}

				j++;
			}
			//System.out.println("video.start=" + video.startDate);

		}
	}

	/**
	 * 
	 * @param inputWeek ，,每周投入时间。默认七个元素
	 * @param startDate，计划开始时间
	 * @param videoSumDuration , 这个视频的总时长
	 * @throws Throwable 
	 */
	public ArrayList<Input> getEndDate(List<Float> inputWeek, String startDate,float videoSumDuration) throws Throwable{
		
		ArrayList<Input> inputList = new ArrayList<Input>();
		
		// 算出开始日期是星期几。找到inputWeek的索引 index
		int index = dayForWeek(startDate)-1;
		float len = inputWeek.get(index).floatValue();
		
		float tmpSum = 0f ;
		
		if(tmpSum+len>=videoSumDuration) {
			inputList.add(new Input(len,startDate));
			return inputList;
		}
		
		String endDate = startDate;
		// 临时总和+ inputWeek(index) < videoSum ,
		while( tmpSum < videoSumDuration)
		{
			    len = inputWeek.get(index).floatValue();
		        
		        // 临时总和 += inputWeek(index);
				tmpSum += len;
				
				if( len >0) {
				  inputList.add(new Input(len,endDate));
			    }
		       
		        // index = index ++ % inputWeek.size();
				index ++ ;
				if(index >= 7) {
					index = 0;
				}
				// endDate = endDate + 1 ;
		        endDate = getNextDay(endDate);
				
		        
		}
		
		return inputList;
	}
	
	/**
	 * 
	 * @param pTime  2001-09-21
	 * @return
	 * @throws Throwable
	 */
	 public static int dayForWeek(String pTime) throws Throwable {  

	        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");  

	        Date tmpDate = format.parse(pTime);  

	        Calendar cal = Calendar.getInstance(); 

	        int[] weekDays = { 7, 1, 2, 3,4, 5, 6 };

	        try {

	            cal.setTime(tmpDate);

	        } catch (Exception e) {

	            e.printStackTrace();

	        }

	        int w = cal.get(Calendar.DAY_OF_WEEK) - 1; // 指示一个星期中的某天。

	        if (w < 0)

	            w = 0;

	        return weekDays[w];

	    }  
	 /**
	  * 獲取下一天
	  * @param baseDate
	  * @return
	  */
	 private static String getNextDay(String baseDate) {
		 DateFormat dft = new SimpleDateFormat("yyyy-MM-dd");
		 String nextDay = null;
         try {
             Date temp = dft.parse(baseDate);
             Calendar cld = Calendar.getInstance();
             cld.setTime(temp);
             cld.add(Calendar.DATE, 1);
             temp = cld.getTime();
             //获得下一天日期字符串
              nextDay = dft.format(temp);
              
         } catch (ParseException e) {
             e.printStackTrace();
         }
		return nextDay;
	}
	 
	public static void main(String[] args) {
		App obj = new App();
		try {
			
			System.out.println(obj.dayForWeek("2021-01-10"));
		} catch (Throwable e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}
```

## 单元测试
```java
package srx;

import java.util.ArrayList;
import java.util.Iterator;

import static org.junit.Assert.assertEquals;

import org.junit.Test;

/**
 * Unit test for simple App.
 */
public class AppTest 
{
    /**
     * Rigorous Test :-)
     */
    @Test
    public void testCal1()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(5f));
    	vlist.add(new Video(0.2f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(5f,"1/1"));
    	ilist.add(new Input(5f,"1/2"));
    	
    	
    	obj.cacuVideoStartDate(vlist, ilist);
//    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
//			Video video = (Video) iterator.next();
//			System.out.println(video.startDate);
//		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/2");
    }
    
    @Test
    public void testCal2()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(5f));
    	vlist.add(new Video(0.2f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(5f,"1/1"));
    	ilist.add(new Input(0f,"1/2"));
    	ilist.add(new Input(0f,"1/3"));
    	ilist.add(new Input(0.2f,"1/4"));
    	
    	
    	obj.cacuVideoStartDate(vlist, ilist);
//    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
//			Video video = (Video) iterator.next();
//			System.out.println(video.startDate);
//		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/4");
    }
    
    
    @Test
    public void testCal3()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(0.2f));
    	vlist.add(new Video(0.2f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(0.2f,"1/1"));
    	ilist.add(new Input(0f,"1/2"));
    	ilist.add(new Input(0f,"1/3"));
    	ilist.add(new Input(0.2f,"1/4"));
    	
    	
    	obj.cacuVideoStartDate(vlist, ilist);
//    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
//			Video video = (Video) iterator.next();
//			System.out.println(video.startDate);
//		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/4");
    }
    
    @Test
    public void testCal4()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(4f));
    	vlist.add(new Video(3f));
    	vlist.add(new Video(1f));
    	vlist.add(new Video(0.5f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(0.5f,"1/1"));
    	ilist.add(new Input(7f,"1/2"));
    	ilist.add(new Input(0.5f,"1/3"));
    	ilist.add(new Input(0.5f,"1/4"));
    	
    	
    	obj.cacuVideoStartDate(vlist, ilist);
    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
			Video video = (Video) iterator.next();
			System.out.println(video.startDate);
		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/2");
    	assertEquals(vlist.get(2).startDate,"1/3");
    	assertEquals(vlist.get(3).startDate,"1/4");
    	
    }
    
    @Test
    public void testCal5()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(4f));
    	vlist.add(new Video(0.5f));
    	vlist.add(new Video(1f));
    	vlist.add(new Video(2f));
    	vlist.add(new Video(2.4f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(0.5f,"1/1"));
    	ilist.add(new Input(0.1f,"1/2"));
    	ilist.add(new Input(0.1f,"1/3"));
    	ilist.add(new Input(0f,"1/4"));
    	ilist.add(new Input(2f,"1/5"));
    	ilist.add(new Input(8f,"1/6"));
    	
    	
    	obj.cacuVideoStartDate(vlist, ilist);
    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
			Video video = (Video) iterator.next();
			System.out.println(video.startDate);
		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/6");
    	assertEquals(vlist.get(2).startDate,"1/6");
    	assertEquals(vlist.get(3).startDate,"1/6");
    	
    }
    
    @Test
    public void testCal6()
    {
    	App obj = new App();
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(4f));
    	vlist.add(new Video(0.5f));
    	vlist.add(new Video(1f));
    	vlist.add(new Video(2f));
    	vlist.add(new Video(2.4f));
    	ArrayList<Input> ilist = new ArrayList<Input> ();
    	ilist.add(new Input(10f,"1/1"));
    
    	
    	obj.cacuVideoStartDate(vlist, ilist);
    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
			Video video = (Video) iterator.next();
			System.out.println(video.startDate);
		}
    	assertEquals(vlist.get(0).startDate,"1/1");
    	assertEquals(vlist.get(1).startDate,"1/1");
    	assertEquals(vlist.get(2).startDate,"1/1");
    	assertEquals(vlist.get(3).startDate,"1/1");
     	assertEquals(vlist.get(4).startDate,"1/1");
    	
    }
    
    /**
     * 测试返回的inputList，每天投入都少时间。直到能够完成视频为止。
     * @throws Throwable 
     */
    @Test
    public void testGetEndDate() throws Throwable {
    	App obj = new App();
    	
    	ArrayList<Float> inputWeek = new ArrayList<Float>();
    	Float monday = new Float(8);
    	Float tuesday = new Float(10);
    	Float wednesday = new Float(2);
    	Float tursday = new Float(0);
    	Float friday = new Float(0);
    	Float satday = new Float(0.4);
    	Float sunday = new Float(0);
    	inputWeek.add(monday);
    	inputWeek.add(tuesday);
    	inputWeek.add(wednesday);
    	inputWeek.add(tursday);
    	inputWeek.add(friday);
    	inputWeek.add(satday);
    	inputWeek.add(sunday);
    	
    	String startDate="2021-01-12";
    	int i=0;
    	for (Iterator iterator = inputWeek.iterator(); iterator.hasNext();) {
			Float week = (Float) iterator.next();
			i++;
			if(App.dayForWeek(startDate) == i) {
				System.out.println("week."+i+"="+week.floatValue()+" <--- startDate"+startDate);
			}else {
				System.out.println("week."+i+"="+week.floatValue());
			}
			
		}
    	
    	
    	
    	float videoSum = 40f;
    	ArrayList<Input> iList = null;
    	try {
    		iList = obj.getEndDate(inputWeek, startDate, videoSum);
    		float tmpSum = 0 ;
    		for (Iterator iterator = iList.iterator(); iterator.hasNext();) {
				Input input = (Input) iterator.next();
				System.out.println(input.inputDate+" "+ input.len);
				tmpSum += input.len;
			}
    		
    		System.out.println("videoSum= "+videoSum+", tmpSum= "+tmpSum);
    		assertEquals(iList.get(0).inputDate,"2021-01-12");
    		assertEquals(iList.get(1).inputDate,"2021-01-13");
    		assertEquals(iList.get(2).inputDate,"2021-01-16");
    		assertEquals(iList.get(3).inputDate,"2021-01-18");
    		assertEquals(iList.get(4).inputDate,"2021-01-19");
    		assertEquals(iList.get(5).inputDate,"2021-01-20");
    		
		} catch (Throwable e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    }
    
    @Test
    public void testPlanDate() throws Throwable {
    	
    	App obj = new App();
    	
    	String startDate="2021-01-12";
    	
    	ArrayList<Float> inputWeek = new ArrayList<Float>();
    	Float monday = new Float(8);
    	Float tuesday = new Float(2);
    	Float wednesday = new Float(2);
    	Float tursday = new Float(0);
    	Float friday = new Float(0);
    	Float satday = new Float(0.4);
    	Float sunday = new Float(0);
    	inputWeek.add(monday);
    	inputWeek.add(tuesday);
    	inputWeek.add(wednesday);
    	inputWeek.add(tursday);
    	inputWeek.add(friday);
    	inputWeek.add(satday);
    	inputWeek.add(sunday);
    	int i=0;
    	for (Iterator iterator = inputWeek.iterator(); iterator.hasNext();) {
			Float week = (Float) iterator.next();
			i++;
			if(App.dayForWeek(startDate) == i) {
				System.out.println("week."+i+"="+week.floatValue()+" <--- startDate"+startDate);
			}else {
				System.out.println("week."+i+"="+week.floatValue());
			}
			
		}
    	
    	
    	ArrayList<Video> vlist = new ArrayList<Video>();
    	vlist.add(new Video(4f));
    	vlist.add(new Video(0.5f));
    	vlist.add(new Video(1f));
    	vlist.add(new Video(2f));
    	vlist.add(new Video(2.4f));
    	
    	float videoSumDuration = 0f;
    	for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
			Video video = (Video) iterator.next();
			videoSumDuration += video.len;
		}
    	
    	
    	try {
    		float tmpSum =0f;
			ArrayList<Input> ilist = obj.getEndDate(inputWeek, startDate, videoSumDuration);
			System.out.println("inputList:");
			for (Iterator iterator = ilist.iterator(); iterator.hasNext();) {
				Input input = (Input) iterator.next();
				System.out.println("------------------>"+input.inputDate+"  "+input.len);
				tmpSum+=input.len;
			}
			System.out.println("videoSumDuration:"+videoSumDuration+" tmpSum="+tmpSum);
		} catch (Throwable e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
    	
    	
    	try {
			obj.planDate(vlist, inputWeek, startDate, videoSumDuration);
			for (Iterator iterator = vlist.iterator(); iterator.hasNext();) {
				Video video = (Video) iterator.next();
				
				System.out.println(video.len+" "+ video.startDate);
			}
		} catch (Throwable e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    	
    	
    }
    
}
```
