---
layout: post
title: 教育系统后台管理的设计
---

## 1. 目前的状态2021/02/23： 
- 一般用户的功能基本实现了
  - 视频查看相关 
    - 视频搜索
    - 视频浏览并显示mark
  - 计划表
    - 制作修改计划
    - 查看时显示计划延迟和正常 
  - PlayYard
    - 私有云生成独享环境 
- 简单的视频生成DB信息 （已经落后不适用了）
  - nodejs扫描文件系统全件，生成db metadata
  - 系统后台api接收metadata，truncate后insert 

（一般用户不提供上传视频功能）

---
## 2. 本次冲刺内容：
- 课程维护
- SSO认证中心

### 2.2 TODO一览
- 前端
  - 推送消息显示
  - 视频页面增加资料显示功能
  - 后台admin界面


- 后端
  - express服务，nodejs改版
  - 架构设计，批量更新用户计划（MQ），用户消息推送
  - 增加learnpath数据库

- 接口
  - 视频查询返回接口videos[]里增加download信息

- DB
  - video表增加download信息 

- NodejsExpress
  - 生成json数据的逻辑需要修改，接口修改

- 认证中心
  - 所有数据请求，包括NodejsExpress请求都加上认证check     

### 2.3 课程维护细节
后台画面维护分类名字，课程名字，章节名字，视频名字
- 删除分类，仅仅提示下面有课程，但允许删除 。 新增，修改当然允许。
- 删除课程，仅仅提示有对应的计划表。删除课程同时删除用户计划表，并推送消息给用户。修改课程名当然没问题。新增课程仅仅新增一个课程id和名字。
- 删除章节，仅仅提示有对应的计划表。删除章节同时更新用户计划表，并推送消息给用户。修改章节名当然没问题。新增章节后面说明。
- 删除视频，仅仅提示有对应的计划表。删除视频同时更新用户计划表，并推送消息给用户。修改视频名当然没问题。新增视频后面说明。

### 2.4 维护章节和视频时的工作方式
- 1.首先视频应该已经上传到文件系统。管理员可以直接操作文件服务器的mount可写目录。 
- 2.管理界面左侧是DB显示的该课程的树形数据。 
  - 右侧是文件系统里真实的该课程目录。
    - 通过nodejs Express提供的api获得文件系统的meta data。显示成树。
    - 发送课程名字（必须和文件系统的课程名字一致），express查找对应的目录。找到之后，
    - nodejs Express调用之前写的nodejs程序遍历 ，生成metadata的json数据返回给后端。
      - nodejs程序，能够遍历不同的目录形式，类似IT营这种视频也能按照接口遍历出来合理的数据。
      - 视频表增加download1-10字段存储以视频为单位的资料。（之前是以课程为单位资料在course表的download1-10字段里）
  - 并高亮显示两者的不同之处，甚至连同名视频文件的视频长度不同也会显示。
  - 点击后底部显示不同之处。就像Diff工具BeyondCompare。
- 3.界面上管理员操作两棵树中的节点。
  - 右边文件系统树也允许删除，左边也允许删除
  - 允许从右边拖拽到左边（右边有左边无的这种），章节允许托，视频也允许托。脱完左边让就存在，但是视图上左右就变成相同的了。就不高亮了。
  - 左边随时可以删掉。视图对比高亮更新。
  - 首次插入则允许整棵树拖拽到左边然后整体插入。视图对比高亮更新。
  - 然后点保存。左边的DB内容会同步更新到DB。
    - 该课程如果有对应的计划表。更新了课程的内容需要批量更新所有用户的计划表。删除了课程需要同步删除所有用户的对应的该课程的计划表。推送消息给用户。
- 4.管理员所有操作记录日志。
- 5.监控资源状态。总文件数，总课程数，每课程的文件数。课程更新频率柱状图。


---

## 3. 下次冲刺功能 TODO
- 学习小组，组内聊天，发消息
   - 按项目组显示留言板。可以@给别人。实时聊天和朋友圈似的留言板（可以发送链接，例如某个学习后的记录。）
- 笔记
- learn path：爬取既存的learn path和课程难易度。 -》 侯胜山
- learn path的拓扑图表现。
- flashcard 
- 后台admin界面认证，自己写认证信息。
