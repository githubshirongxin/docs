<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【CKA】02-安装、配置、验证 | 积累</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/docs/logo.png">
    <link rel="icon" href="/docs/logo.png">
    <link rel="manifest" href="/docs/manifest.json">
    <link rel="apple-touch-icon" href="/docs/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/docs/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="共享库">
    <meta name="name" content="cjb的资料库">
    <meta name="keywords" content="k8s,微服务,gitlab,分布式存储">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/docs/assets/css/0.styles.27bfdfe7.css" as="style"><link rel="preload" href="/docs/assets/js/app.080d4239.js" as="script"><link rel="preload" href="/docs/assets/js/5.379e7eff.js" as="script"><link rel="preload" href="/docs/assets/js/2.28087ae7.js" as="script"><link rel="preload" href="/docs/assets/js/72.548dd7a5.js" as="script"><link rel="preload" href="/docs/assets/js/3.32492e15.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.85b8b9ca.js"><link rel="prefetch" href="/docs/assets/js/100.0b431fd8.js"><link rel="prefetch" href="/docs/assets/js/101.c9978631.js"><link rel="prefetch" href="/docs/assets/js/102.4c697f13.js"><link rel="prefetch" href="/docs/assets/js/103.4727fed0.js"><link rel="prefetch" href="/docs/assets/js/104.c9e89063.js"><link rel="prefetch" href="/docs/assets/js/105.faf252e4.js"><link rel="prefetch" href="/docs/assets/js/106.c8779cf7.js"><link rel="prefetch" href="/docs/assets/js/107.46a75cd8.js"><link rel="prefetch" href="/docs/assets/js/108.982cb60b.js"><link rel="prefetch" href="/docs/assets/js/109.11af5813.js"><link rel="prefetch" href="/docs/assets/js/11.5a4e518f.js"><link rel="prefetch" href="/docs/assets/js/110.0e3a0424.js"><link rel="prefetch" href="/docs/assets/js/111.7103a7a4.js"><link rel="prefetch" href="/docs/assets/js/112.4dd7cca2.js"><link rel="prefetch" href="/docs/assets/js/113.74a27c12.js"><link rel="prefetch" href="/docs/assets/js/114.53c3ed21.js"><link rel="prefetch" href="/docs/assets/js/115.a4693092.js"><link rel="prefetch" href="/docs/assets/js/116.69fea587.js"><link rel="prefetch" href="/docs/assets/js/117.131a6445.js"><link rel="prefetch" href="/docs/assets/js/118.0bcc8dba.js"><link rel="prefetch" href="/docs/assets/js/119.971494ac.js"><link rel="prefetch" href="/docs/assets/js/12.31509b98.js"><link rel="prefetch" href="/docs/assets/js/120.0f9979aa.js"><link rel="prefetch" href="/docs/assets/js/121.f1456f81.js"><link rel="prefetch" href="/docs/assets/js/122.aa351b73.js"><link rel="prefetch" href="/docs/assets/js/123.e2f8a9d8.js"><link rel="prefetch" href="/docs/assets/js/124.7567f2dd.js"><link rel="prefetch" href="/docs/assets/js/125.80b632a6.js"><link rel="prefetch" href="/docs/assets/js/126.8eb4c0f8.js"><link rel="prefetch" href="/docs/assets/js/127.bfddcc6b.js"><link rel="prefetch" href="/docs/assets/js/128.0dc491b3.js"><link rel="prefetch" href="/docs/assets/js/129.edce85f7.js"><link rel="prefetch" href="/docs/assets/js/13.3dd5a385.js"><link rel="prefetch" href="/docs/assets/js/130.2597aede.js"><link rel="prefetch" href="/docs/assets/js/131.a7bd7c8f.js"><link rel="prefetch" href="/docs/assets/js/132.10e3f85b.js"><link rel="prefetch" href="/docs/assets/js/133.12e5f24d.js"><link rel="prefetch" href="/docs/assets/js/134.b2d8e07a.js"><link rel="prefetch" href="/docs/assets/js/135.2e06a476.js"><link rel="prefetch" href="/docs/assets/js/136.49477f68.js"><link rel="prefetch" href="/docs/assets/js/137.c5bc2817.js"><link rel="prefetch" href="/docs/assets/js/138.315aad74.js"><link rel="prefetch" href="/docs/assets/js/139.6d609eec.js"><link rel="prefetch" href="/docs/assets/js/14.089d42f4.js"><link rel="prefetch" href="/docs/assets/js/140.8e24c778.js"><link rel="prefetch" href="/docs/assets/js/141.b5fc09c3.js"><link rel="prefetch" href="/docs/assets/js/142.85ebaeb0.js"><link rel="prefetch" href="/docs/assets/js/143.b7a98930.js"><link rel="prefetch" href="/docs/assets/js/144.6db94e8b.js"><link rel="prefetch" href="/docs/assets/js/145.f002e278.js"><link rel="prefetch" href="/docs/assets/js/146.d101b861.js"><link rel="prefetch" href="/docs/assets/js/147.193a48b7.js"><link rel="prefetch" href="/docs/assets/js/148.62b59815.js"><link rel="prefetch" href="/docs/assets/js/149.7e46ec43.js"><link rel="prefetch" href="/docs/assets/js/15.29510137.js"><link rel="prefetch" href="/docs/assets/js/150.24e716ba.js"><link rel="prefetch" href="/docs/assets/js/151.517c82a9.js"><link rel="prefetch" href="/docs/assets/js/152.3fa354f4.js"><link rel="prefetch" href="/docs/assets/js/153.4f956405.js"><link rel="prefetch" href="/docs/assets/js/154.5c848408.js"><link rel="prefetch" href="/docs/assets/js/155.93b0ec46.js"><link rel="prefetch" href="/docs/assets/js/156.fdbdbca9.js"><link rel="prefetch" href="/docs/assets/js/157.6d0fa38c.js"><link rel="prefetch" href="/docs/assets/js/158.72d097ca.js"><link rel="prefetch" href="/docs/assets/js/159.7f77cc41.js"><link rel="prefetch" href="/docs/assets/js/16.fd9dcf43.js"><link rel="prefetch" href="/docs/assets/js/160.ab121697.js"><link rel="prefetch" href="/docs/assets/js/161.0d88c6d9.js"><link rel="prefetch" href="/docs/assets/js/162.007b8b05.js"><link rel="prefetch" href="/docs/assets/js/163.65ed11cd.js"><link rel="prefetch" href="/docs/assets/js/164.4d573921.js"><link rel="prefetch" href="/docs/assets/js/165.b36bfa72.js"><link rel="prefetch" href="/docs/assets/js/166.19fcbc2d.js"><link rel="prefetch" href="/docs/assets/js/167.b4667697.js"><link rel="prefetch" href="/docs/assets/js/168.a4f8fd2b.js"><link rel="prefetch" href="/docs/assets/js/169.19bdcb87.js"><link rel="prefetch" href="/docs/assets/js/17.543cc8af.js"><link rel="prefetch" href="/docs/assets/js/170.fbd6bb24.js"><link rel="prefetch" href="/docs/assets/js/171.95ad7005.js"><link rel="prefetch" href="/docs/assets/js/172.24fe1f4c.js"><link rel="prefetch" href="/docs/assets/js/173.89f2a3d0.js"><link rel="prefetch" href="/docs/assets/js/174.61b0af67.js"><link rel="prefetch" href="/docs/assets/js/175.4aab86ba.js"><link rel="prefetch" href="/docs/assets/js/176.d466d235.js"><link rel="prefetch" href="/docs/assets/js/177.ca7ec18e.js"><link rel="prefetch" href="/docs/assets/js/178.753c0d83.js"><link rel="prefetch" href="/docs/assets/js/179.81ae7ea0.js"><link rel="prefetch" href="/docs/assets/js/18.5d502119.js"><link rel="prefetch" href="/docs/assets/js/180.070cbdc9.js"><link rel="prefetch" href="/docs/assets/js/181.e2599a6b.js"><link rel="prefetch" href="/docs/assets/js/182.d6b01fbf.js"><link rel="prefetch" href="/docs/assets/js/183.79d0e7ba.js"><link rel="prefetch" href="/docs/assets/js/19.cb490e25.js"><link rel="prefetch" href="/docs/assets/js/20.adcfedaf.js"><link rel="prefetch" href="/docs/assets/js/21.9d582c4d.js"><link rel="prefetch" href="/docs/assets/js/22.c16ea19a.js"><link rel="prefetch" href="/docs/assets/js/23.aec242c2.js"><link rel="prefetch" href="/docs/assets/js/24.a4233062.js"><link rel="prefetch" href="/docs/assets/js/25.3d18f236.js"><link rel="prefetch" href="/docs/assets/js/26.b57bc7b9.js"><link rel="prefetch" href="/docs/assets/js/27.233fae77.js"><link rel="prefetch" href="/docs/assets/js/28.2a2e594b.js"><link rel="prefetch" href="/docs/assets/js/29.ef6d52c8.js"><link rel="prefetch" href="/docs/assets/js/30.73e277b5.js"><link rel="prefetch" href="/docs/assets/js/31.97098df8.js"><link rel="prefetch" href="/docs/assets/js/32.5e9f1127.js"><link rel="prefetch" href="/docs/assets/js/33.1c117b15.js"><link rel="prefetch" href="/docs/assets/js/34.68fd559e.js"><link rel="prefetch" href="/docs/assets/js/35.8e1747d2.js"><link rel="prefetch" href="/docs/assets/js/36.69874229.js"><link rel="prefetch" href="/docs/assets/js/37.1562fb22.js"><link rel="prefetch" href="/docs/assets/js/38.4de05033.js"><link rel="prefetch" href="/docs/assets/js/39.71177f26.js"><link rel="prefetch" href="/docs/assets/js/4.a5c66eac.js"><link rel="prefetch" href="/docs/assets/js/40.12bb3e1e.js"><link rel="prefetch" href="/docs/assets/js/41.80389c58.js"><link rel="prefetch" href="/docs/assets/js/42.af222ef5.js"><link rel="prefetch" href="/docs/assets/js/43.f1f13eb8.js"><link rel="prefetch" href="/docs/assets/js/44.88384ab6.js"><link rel="prefetch" href="/docs/assets/js/45.20017963.js"><link rel="prefetch" href="/docs/assets/js/46.34137c54.js"><link rel="prefetch" href="/docs/assets/js/47.6813e361.js"><link rel="prefetch" href="/docs/assets/js/48.b5db341d.js"><link rel="prefetch" href="/docs/assets/js/49.a031612d.js"><link rel="prefetch" href="/docs/assets/js/50.842b2b8c.js"><link rel="prefetch" href="/docs/assets/js/51.7d1627ce.js"><link rel="prefetch" href="/docs/assets/js/52.b31e982f.js"><link rel="prefetch" href="/docs/assets/js/53.28de3084.js"><link rel="prefetch" href="/docs/assets/js/54.528c3ac6.js"><link rel="prefetch" href="/docs/assets/js/55.fd53cfe0.js"><link rel="prefetch" href="/docs/assets/js/56.298cb8ec.js"><link rel="prefetch" href="/docs/assets/js/57.32df94b5.js"><link rel="prefetch" href="/docs/assets/js/58.7b045f14.js"><link rel="prefetch" href="/docs/assets/js/59.03a57726.js"><link rel="prefetch" href="/docs/assets/js/6.d4972abb.js"><link rel="prefetch" href="/docs/assets/js/60.67aabf73.js"><link rel="prefetch" href="/docs/assets/js/61.44ba2473.js"><link rel="prefetch" href="/docs/assets/js/62.48e6cfaa.js"><link rel="prefetch" href="/docs/assets/js/63.1673eccb.js"><link rel="prefetch" href="/docs/assets/js/64.bf52f2b6.js"><link rel="prefetch" href="/docs/assets/js/65.ff88ab03.js"><link rel="prefetch" href="/docs/assets/js/66.55eaa3af.js"><link rel="prefetch" href="/docs/assets/js/67.889aa739.js"><link rel="prefetch" href="/docs/assets/js/68.02fcba5c.js"><link rel="prefetch" href="/docs/assets/js/69.8982f533.js"><link rel="prefetch" href="/docs/assets/js/7.6b204d57.js"><link rel="prefetch" href="/docs/assets/js/70.cdee5037.js"><link rel="prefetch" href="/docs/assets/js/71.3a8f5184.js"><link rel="prefetch" href="/docs/assets/js/73.cf5c3451.js"><link rel="prefetch" href="/docs/assets/js/74.8d7935ab.js"><link rel="prefetch" href="/docs/assets/js/75.c6465616.js"><link rel="prefetch" href="/docs/assets/js/76.d56a3d09.js"><link rel="prefetch" href="/docs/assets/js/77.b60fde21.js"><link rel="prefetch" href="/docs/assets/js/78.5a00a5c6.js"><link rel="prefetch" href="/docs/assets/js/79.08ba6ff5.js"><link rel="prefetch" href="/docs/assets/js/8.4b22937f.js"><link rel="prefetch" href="/docs/assets/js/80.c542ef70.js"><link rel="prefetch" href="/docs/assets/js/81.5c81d466.js"><link rel="prefetch" href="/docs/assets/js/82.cc957d3e.js"><link rel="prefetch" href="/docs/assets/js/83.f4d12148.js"><link rel="prefetch" href="/docs/assets/js/84.cb0c938d.js"><link rel="prefetch" href="/docs/assets/js/85.c4b54be8.js"><link rel="prefetch" href="/docs/assets/js/86.ea618cae.js"><link rel="prefetch" href="/docs/assets/js/87.e4791b17.js"><link rel="prefetch" href="/docs/assets/js/88.2acc3826.js"><link rel="prefetch" href="/docs/assets/js/89.d3d5a4eb.js"><link rel="prefetch" href="/docs/assets/js/9.3f282ae5.js"><link rel="prefetch" href="/docs/assets/js/90.35bf2faa.js"><link rel="prefetch" href="/docs/assets/js/91.3456cb65.js"><link rel="prefetch" href="/docs/assets/js/92.c80d5002.js"><link rel="prefetch" href="/docs/assets/js/93.49eea563.js"><link rel="prefetch" href="/docs/assets/js/94.27d5cb8a.js"><link rel="prefetch" href="/docs/assets/js/95.dd834ff3.js"><link rel="prefetch" href="/docs/assets/js/96.b15175ab.js"><link rel="prefetch" href="/docs/assets/js/97.de8bb94e.js"><link rel="prefetch" href="/docs/assets/js/98.3bad6c84.js"><link rel="prefetch" href="/docs/assets/js/99.ac4b5750.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.27bfdfe7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/logo.png" alt="积累" class="logo"> <span class="site-name can-hide">积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础设施" class="dropdown-title"><span class="title">基础设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/基础设施/linux-powshell/windows/" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/linux-powshell/" class="nav-link">
  linux-powshell
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/maven-nexus/" class="nav-link">
  maven-nexus
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/vuepress/" class="nav-link">
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/gitlab/" class="nav-link">
  gitlab
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/高可用系统/" class="nav-link">
  高可用系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/NFS/" class="nav-link">
  NFS
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/k8s/" class="nav-link">
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/" class="nav-link">
  基础设施
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="elasticSearch" class="dropdown-title"><span class="title">elasticSearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/elasticSearch/" class="nav-link">
  elasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="媒体" class="dropdown-title"><span class="title">媒体</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/媒体/nginx直播点播/" class="nav-link">
  nginx直播点播
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="application" class="dropdown-title"><span class="title">application</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/application/" class="nav-link">
  application
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础设施" class="dropdown-title"><span class="title">基础设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/基础设施/linux-powshell/windows/" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/linux-powshell/" class="nav-link">
  linux-powshell
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/maven-nexus/" class="nav-link">
  maven-nexus
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/vuepress/" class="nav-link">
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/gitlab/" class="nav-link">
  gitlab
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/高可用系统/" class="nav-link">
  高可用系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/NFS/" class="nav-link">
  NFS
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/k8s/" class="nav-link">
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/docs/基础设施/" class="nav-link">
  基础设施
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="elasticSearch" class="dropdown-title"><span class="title">elasticSearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/elasticSearch/" class="nav-link">
  elasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="媒体" class="dropdown-title"><span class="title">媒体</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/媒体/nginx直播点播/" class="nav-link">
  nginx直播点播
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="application" class="dropdown-title"><span class="title">application</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/application/" class="nav-link">
  application
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>k8s</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/k8s/" aria-current="page" class="sidebar-link">■ K8s相关=========================</a></li><li><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-00k8s管理员.html" class="sidebar-link">===■ CKA.k8s管理员===</a></li><li><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-02安装配置.html" class="active sidebar-link">【CKA】02-安装、配置、验证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-02安装配置.html#_1-安装-master、worker-非高可用" class="sidebar-link">1. 安装 master、worker(非高可用)</a></li><li class="sidebar-sub-header"><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-02安装配置.html#_2-高可用cluster" class="sidebar-link">2. 高可用cluster</a></li><li class="sidebar-sub-header"><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-02安装配置.html#_3-securing-k8s" class="sidebar-link">3. securing k8s</a></li><li class="sidebar-sub-header"><a href="/docs/基础设施/k8s/2020-08-21-【CKA】-02安装配置.html#_4-端到端测试，验证pod状态正常" class="sidebar-link">4. 端到端测试，验证pod状态正常</a></li></ul></li><li><a href="/docs/基础设施/k8s/2020-08-22-【CKA】-03管理集群.html" class="sidebar-link">【CKA】03-管理集群</a></li><li><a href="/docs/基础设施/k8s/2020-08-24-【CKA】-04网络.html" class="sidebar-link">【CKA】04-网络</a></li><li><a href="/docs/基础设施/k8s/2020-08-24-【CKA】-05Scheduling.html" class="sidebar-link">【CKA】05-Scheduling</a></li><li><a href="/docs/基础设施/k8s/2020-08-24-【CKA】-06应用的生命周期.html" class="sidebar-link">【CKA】06-应用的生命周期</a></li><li><a href="/docs/基础设施/k8s/2020-08-24-【CKA】-07在kubernetes集群中管理数据.html" class="sidebar-link">【CKA】07-在Kubernetes集群中管理数据</a></li><li><a href="/docs/基础设施/k8s/2020-08-25-【CKA】-08保护k8s集群.html" class="sidebar-link">【CKA】08-保护k8s集群</a></li><li><a href="/docs/基础设施/k8s/2020-08-31-【CKA】-09监视集群组件.html" class="sidebar-link">【CKA】09-监视k8s集群</a></li><li><a href="/docs/基础设施/k8s/2020-08-31-【CKA】-10识别集群故障.html" class="sidebar-link">【CKA】10-识别集群中常见故障</a></li><li><a href="/docs/基础设施/k8s/2020-09-01-【CKAD】-00k8s认证的应用程序开发人员.html" class="sidebar-link">===■ CKAD.k8s开发者===</a></li><li><a href="/docs/基础设施/k8s/2020-09-01-【CKAD】-01核心概念.html" class="sidebar-link">【CKAD】01.核心概念</a></li><li><a href="/docs/基础设施/k8s/2020-09-01-【CKAD】-02配置.html" class="sidebar-link">【CKAD】02.配置</a></li><li><a href="/docs/基础设施/k8s/2020-09-03-【CKAD】-03多容器pod.html" class="sidebar-link">【CKAD】03.多容器pod</a></li><li><a href="/docs/基础设施/k8s/2020-09-10-【CKAD】-04可观察.html" class="sidebar-link">【CKAD】04.可观察性</a></li><li><a href="/docs/基础设施/k8s/2020-09-10-【CKAD】-05Pod设计.html" class="sidebar-link">【CKAD】05.Pod设计</a></li><li><a href="/docs/基础设施/k8s/2020-09-10-【CKAD】-06 Services and Networking.html" class="sidebar-link">【CKAD】06.Service and Networking</a></li><li><a href="/docs/基础设施/k8s/2020-09-10-【CKAD】-07 持久性.html" class="sidebar-link">【CKAD】07.卷</a></li><li><a href="/docs/基础设施/k8s/2020-09-14-【k8s基本概念】.html" class="sidebar-link">【K8s基本理解】service转发后端服务的四种类型</a></li><li><a href="/docs/基础设施/k8s/2020-6-29-k8sInstall.html" class="sidebar-link">【k8s安装】 centos7 k8s v1.15.3（3.105安装方法，验证好用）</a></li><li><a href="/docs/基础设施/k8s/2020-6-30-【k8s笔记】Other.html" class="sidebar-link">【k8s某机构视频学习笔记】（讲得还行）</a></li><li><a href="/docs/基础设施/k8s/2020-7-1-【k8sLearn17hours】-00非高可用k8s安装.html" class="sidebar-link">【k8s笔记】【视频教程70P】（一，非高可用k8s安装）</a></li><li><a href="/docs/基础设施/k8s/2020-7-1-【k8sLearn17hours】-01harbor与k8s.html" class="sidebar-link">【k8s笔记】【视频教程70P】(二. harbor安装后k8s节点配置)</a></li><li><a href="/docs/基础设施/k8s/2020-7-1-【k8sLearn17hours】-02K8s定义资源清单方式创建服务.html" class="sidebar-link">【k8s笔记】【视频教程70P】(三. K8s资源清单yaml文件讲解)</a></li><li><a href="/docs/基础设施/k8s/2020-7-1-【k8sLearn17hours】-99高可用k8s安装.html" class="sidebar-link">【k8s笔记】【视频教程70P】（最后，高可用k8s安装）待续...</a></li><li><a href="/docs/基础设施/k8s/2020-7-1-【k8sThoubleShooting】.html" class="sidebar-link">【k8s trouble shootting】【持续更新中】</a></li><li><a href="/docs/基础设施/k8s/2020-8-13-【k8s应用】部署mysql集群.html" class="sidebar-link">【k8s应用】【部署mysql集群】</a></li><li><a href="/docs/基础设施/k8s/2020-8-15-【k8s应用】官网最基本练习.html" class="sidebar-link">【k8s应用】【官网最基本练习】</a></li><li><a href="/docs/基础设施/k8s/2020-8-17-【k8s常用命令】.html" class="sidebar-link">【k8s常用命令】</a></li><li><a href="/docs/基础设施/k8s/2020-8-18-【k8s基本理解】nodePort、LoadBalance、ExtennalName.html" class="sidebar-link">【k8s基本理解】nodePort、LoadBalance、ExternalName（未完）</a></li><li><a href="/docs/基础设施/k8s/2020-8-18-【k8s基本理解】nodePort、port、targetPort、hostPort.html" class="sidebar-link">【k8s基本理解】nodePort、port、target Port、hostPort</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li><a href="#1-%E5%AE%89%E8%A3%85-masterworker%E9%9D%9E%E9%AB%98%E5%8F%AF%E7%94%A8">1. 安装 master、worker(非高可用)</a> <ul><li><a href="#%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E9%83%BD%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4">所有节点都执行的命令</a></li> <li><a href="#%E5%8F%AA%E6%9C%89%E5%9C%A8master%E4%B8%8A%E6%89%A7%E8%A1%8C">只有在Master上执行</a></li> <li><a href="#%E5%8F%AA%E5%9C%A8worker%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%B0%B1%E4%B8%80%E5%8F%A5join">只在worker上执行，就一句join</a></li> <li><a href="#%E6%9C%80%E5%90%8E%E9%AA%8C%E8%AF%81%E4%B8%80%E4%B8%8B%E5%B0%B1%E4%B8%80%E5%8F%A5">最后验证一下。就一句</a></li> <li><a href="#%E6%96%87%E5%AD%97%E5%91%BD%E4%BB%A4">文字命令</a></li></ul></li> <li><a href="#2-%E9%AB%98%E5%8F%AF%E7%94%A8cluster">2. 高可用cluster</a></li> <li><a href="#3-securing-k8s">3. securing k8s</a> <ul><li><a href="#31-apiserver%E6%8E%A5%E5%8F%97%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B">3.1 apiserver接受请求的过程</a> <ul><li><a href="#%E9%A6%96%E5%85%88apiserver%E6%8E%A5%E5%8F%97%E8%AF%B7%E6%B1%82%E5%81%9A%E4%B8%8B%E9%9D%A2%E5%9B%9B%E6%AD%A5">首先，apiserver接受请求。做下面四步</a></li> <li><a href="#%E6%9C%80%E5%90%8E%E6%8A%8A%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A5etcd">最后，把结果写入etcd</a></li> <li><a href="#%E6%BC%94%E7%A4%BA">演示</a></li></ul></li> <li><a href="#32-%E8%AF%B7%E6%B1%82%E5%8F%91%E8%B5%B7%E7%AB%AF%E7%9A%84serviceaccount">3.2 请求发起端的ServiceAccount</a></li></ul></li> <li><a href="#4-%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95%E9%AA%8C%E8%AF%81pod%E7%8A%B6%E6%80%81%E6%AD%A3%E5%B8%B8">4. 端到端测试，验证pod状态正常</a>
minikube是最好用的单节点k8s</li></ul> <h2 id="_1-安装-master、worker-非高可用"><a href="#_1-安装-master、worker-非高可用" class="header-anchor">#</a> 1. 安装 master、worker(非高可用)</h2> <p>PS1=&quot;node0:~$ &quot;
PS1=&quot;node1:~$ &quot;
PS1=&quot;node2:~$ &quot;</p> <h3 id="所有节点都执行的命令"><a href="#所有节点都执行的命令" class="header-anchor">#</a> 所有节点都执行的命令</h3> <p><img src="/docs/images/2020-08-21-10-34-09.png" alt=""></p> <h3 id="只有在master上执行"><a href="#只有在master上执行" class="header-anchor">#</a> 只有在Master上执行</h3> <p><img src="/docs/images/2020-08-21-10-37-28.png" alt=""></p> <h3 id="只在worker上执行，就一句join"><a href="#只在worker上执行，就一句join" class="header-anchor">#</a> 只在worker上执行，就一句join</h3> <p><img src="/docs/images/2020-08-21-10-38-58.png" alt=""></p> <h3 id="最后验证一下。就一句"><a href="#最后验证一下。就一句" class="header-anchor">#</a> 最后验证一下。就一句</h3> <p><img src="/docs/images/2020-08-21-10-40-02.png" alt=""></p> <h3 id="文字命令"><a href="#文字命令" class="header-anchor">#</a> 文字命令</h3> <p>Get the Docker gpg key:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Add the Docker repository:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> add-apt-repository    <span class="token string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> \
   stable&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Get the Kubernetes gpg key:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -s https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Add the Kubernetes repository:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Update your packages:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Install Docker, kubelet, kubeadm, and kubectl:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y docker-ce<span class="token operator">=</span><span class="token number">5</span>:19.03.12~3-0~ubuntu-bionic <span class="token assign-left variable">kubelet</span><span class="token operator">=</span><span class="token number">1.17</span>.8-00 <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token number">1.17</span>.8-00 <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token number">1.17</span>.8-00
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Hold them at the current version:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> apt-mark hold docker-ce kubelet kubeadm kubectl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Add the iptables rule to sysctl.conf:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;net.bridge.bridge-nf-call-iptables=1&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/sysctl.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Enable iptables immediately:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> sysctl -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Initialize the cluster (run only on the master):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> kubeadm init --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Set up local kubeconfig (run only on the master):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube

<span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config

<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Apply Calico CNI network overlay (run only on the master):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f https://docs.projectcalico.org/v3.14/manifests/calico.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Join the worker nodes to the cluster:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> kubeadm <span class="token function">join</span> <span class="token punctuation">[</span>your unique string from the kubeadm init command<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Verify the worker nodes have joined the cluster successfully:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get nodes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Compare this result of the kubectl get nodes command:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>NAME                            STATUS   ROLES    AGE   VERSION
chadcrowell1c.mylabserver.com   Ready    master   4m18s v1.17.8
chadcrowell2c.mylabserver.com   Ready    none     82s   v1.17.8
chadcrowell3c.mylabserver.com   Ready    none     69s   v1.17.8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2-高可用cluster"><a href="#_2-高可用cluster" class="header-anchor">#</a> 2. 高可用cluster</h2> <p><img src="/docs/images/2020-08-23-08-52-53.png" alt=""> <img src="/docs/images/2020-08-23-08-59-49.png" alt=""></p> <p>You can provide high availability for cluster components by running multiple instances — however, some replicated components must remain in standby mode. The scheduler and the controller manager are actively watching the cluster state and take action when it changes. If multiples are running, it creates the possibility of unwarranted duplicates of pods.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos3 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o custom-columns=POD:metadata.name,NODE:spec.nodeName --sort-by spec.nodeName -n kube-system</span>
POD                                     NODE
kube-proxy-tscrk                        centos1
coredns-bccdc95cf-ss9q9                 centos1
etcd-centos1                            centos1
kube-apiserver-centos1                  centos1
kube-controller-manager-centos1         centos1
kube-scheduler-centos1                  centos1
kube-flannel-ds-amd64-rn7mc             centos1
coredns-bccdc95cf-hsvt6                 centos1
kube-proxy-5lz2q                        centos2
kube-flannel-ds-amd64-xcsg4             centos2
kube-proxy-hjlrp                        centos3
kube-flannel-ds-amd64-8ztst             centos3
kubernetes-dashboard-574b546db9-7frfw   centos3
<span class="token punctuation">[</span>root@centos3 ~<span class="token punctuation">]</span><span class="token comment">#</span>

<span class="token punctuation">[</span>root@centos3 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get endpoints kube-scheduler -n kube-system -o yaml</span>
apiVersion: v1
kind: Endpoints
metadata:
  annotations:
    control-plane.alpha.kubernetes.io/leader: <span class="token string">'{&quot;holderIdentity&quot;:&quot;centos1_4f42572f-05d7-40a6-8963-ecc1876242a5&quot;,&quot;leaseDurationSeconds&quot;:15,&quot;acquireTime&quot;:&quot;2020-08-17T05:23:55Z&quot;,&quot;renewTime&quot;:&quot;2020-08-23T00:55:40Z&quot;,&quot;leaderTransitions&quot;:7}'</span>
  creationTimestamp: <span class="token string">&quot;2020-06-29T11:23:40Z&quot;</span>
  name: kube-scheduler
  namespace: kube-system
  resourceVersion: <span class="token string">&quot;4866299&quot;</span>
  selfLink: /api/v1/namespaces/kube-system/endpoints/kube-scheduler
  uid: a14548f8-b5a9-4440-8a44-b835ffbb678d
<span class="token punctuation">[</span>root@centos3 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Create a file called kubeadm-config.yaml</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration
<span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> stable
<span class="token key atrule">controlPlaneEndpoint</span><span class="token punctuation">:</span> <span class="token string">&quot;LOAD_BALANCER_DNS:LOAD_BALANCER_PORT&quot;</span>
<span class="token key atrule">etcd</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span>
        <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//ETCD_0_IP<span class="token punctuation">:</span><span class="token number">2379</span>
        <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//ETCD_1_IP<span class="token punctuation">:</span><span class="token number">2379</span>
        <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//ETCD_2_IP<span class="token punctuation">:</span><span class="token number">2379</span>
        <span class="token key atrule">caFile</span><span class="token punctuation">:</span> /etc/kubernetes/pki/etcd/ca.crt
        <span class="token key atrule">certFile</span><span class="token punctuation">:</span> /etc/kubernetes/pki/apiserver<span class="token punctuation">-</span>etcd<span class="token punctuation">-</span>client.crt
        <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /etc/kubernetes/pki/apiserver<span class="token punctuation">-</span>etcd<span class="token punctuation">-</span>client.key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Create a stacked etcd topology using kubeadm:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubeadm init --config<span class="token operator">=</span>kubeadm-config.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Watch as pods are created in the default namespace:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get pods -n kube-system -w
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Helpful Links:</strong></p> <ul><li><a href="https://kubernetes.io/docs/setup/independent/high-availability/" target="_blank" rel="noopener noreferrer">Creating Highly Available Kubernetes Clusters with kubeadm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kubernetes.io/docs/setup/independent/ha-topology/" target="_blank" rel="noopener noreferrer">Highly Available Topologies in Kubernetes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/" target="_blank" rel="noopener noreferrer">Operating a Highly Available etcd Cluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_3-securing-k8s"><a href="#_3-securing-k8s" class="header-anchor">#</a> 3. securing k8s</h2> <p><img src="/docs/images/2020-08-23-10-03-53.png" alt=""></p> <h3 id="_3-1-apiserver接受请求的过程"><a href="#_3-1-apiserver接受请求的过程" class="header-anchor">#</a> 3.1 apiserver接受请求的过程</h3> <p>apiserver会接收两种请求，一种是命令行执行的kubectl，还有一种是
pod里执行的请求。</p> <h4 id="首先，apiserver接受请求。做下面四步"><a href="#首先，apiserver接受请求。做下面四步" class="header-anchor">#</a> 首先，apiserver接受请求。做下面四步</h4> <p>authentiation: 从请求的header中识别出user，group
authorization：判断改user和group是否有权限在改namespace
admission：增改删资源例如pod，需要发送给admission control。
resource validate:</p> <h4 id="最后，把结果写入etcd"><a href="#最后，把结果写入etcd" class="header-anchor">#</a> 最后，把结果写入etcd</h4> <h4 id="演示"><a href="#演示" class="header-anchor">#</a> 演示</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos3 kubernetes<span class="token punctuation">]</span><span class="token comment"># ls</span>
admin.conf  bootstrap-kubelet.conf  kubelet.conf  manifests  pki
<span class="token punctuation">[</span>root@centos3 kubernetes<span class="token punctuation">]</span><span class="token comment"># cat admin.conf</span>
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: <span class="token assign-left variable">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBdHUwbjJNbz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo</span><span class="token operator">=</span>
    server: https://192.168.3.105:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: <span class="token punctuation">{</span><span class="token punctuation">}</span>
users:
- name: kubernetes-admin
  user:
    client-certificate-data: <span class="token assign-left variable">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBLQo</span><span class="token operator">=</span>
    client-key-data: <span class="token assign-left variable">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBVkFURSBLRVktLS0tLQo</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_3-2-请求发起端的serviceaccount"><a href="#_3-2-请求发起端的serviceaccount" class="header-anchor">#</a> 3.2 请求发起端的ServiceAccount</h3> <p>创建pod的时候就会有serviceAccout。并带着一个tokenfile。
例如进入到某个pod的sh，打印出改pod的serviceAccount的token。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /var/secrets/kubernetes.io/serviceaccount/tocken
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>pod请求时的serviceaccount
当pod请求apiserver的时候，就是把这个serviceAccount发送给apiserver去提出user，验证user权限。</p></li> <li><p>kubectl请求时的servcieaccount
默认的serviceaccount.如果不想使用默认service account，必须在manifest目录指定serviceaccount。但是（pod不能指定别的ns的serviceaccount。只能指定自己的ns里的。）</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos3 kubernetes<span class="token punctuation">]</span><span class="token comment"># kubectl get serviceaccounts</span>
NAME      SECRETS   AGE
default   <span class="token number">1</span>         54d
<span class="token punctuation">[</span>root@centos3 kubernetes<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/docs/images/2020-08-23-10-12-05.png" alt="">
Role-binding：决定了谁能做这些事
role：角色能做哪些事</p> <p>为了防止未经授权的用户修改群集状态，使用了RBAC，它为用户定义了角色和角色绑定。为Pod创建一个服务帐户资源，以确定它如何控制群集状态。例如，默认服务帐户将不允许您在名称空间中列出服务。</p> <p>查看kube-config：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> .kube/config <span class="token operator">|</span> <span class="token function">more</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看服务帐户令牌：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get secrets
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建一个新的名称空间my-ns：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create ns my-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在my-ns名称空间中运行kube-proxy pod ：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl run <span class="token builtin class-name">test</span> --image<span class="token operator">=</span>chadmcrowell/kubectl-proxy -n my-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>列出my-ns命名空间中的Pod ：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get pods -n my-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在新创建的pod中运行shell：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>name-of-pod<span class="token operator">&gt;</span> -n my-ns <span class="token function">sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过API调用在名称空间中列出服务：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> localhost:8001/api/v1/namespaces/my-ns/services
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从Pod中查看令牌文件：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /var/run/secrets/kubernetes.io/serviceaccount/token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>列出集群中的服务帐户资源：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get serviceaccounts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>有用的网址<br> <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">服务帐号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="http://kubernetes.io/docs/admin" target="_blank" rel="noopener noreferrer">群集管理概述<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://kubernetes.io/docs/concepts/cluster-administration/cluster-administration-overview/#securing-a-cluster" target="_blank" rel="noopener noreferrer">保护集群<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://kubernetes.io/docs/reference/access-authn-authz/controlling-access/" target="_blank" rel="noopener noreferrer">控制对API的访问<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/" target="_blank" rel="noopener noreferrer">授权书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/http-proxy-access-api/" target="_blank" rel="noopener noreferrer">使用代理访问API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_4-端到端测试，验证pod状态正常"><a href="#_4-端到端测试，验证pod状态正常" class="header-anchor">#</a> 4. 端到端测试，验证pod状态正常</h2> <p>运行端到端测试可确保您的应用程序高效运行，而不必担心群集运行状况问题。Kubetest是提供端到端测试的有用工具-但是，它不在本考试范围内。在本课程中，我们将通过实践来测试我们运行部署，运行Pod，暴露容器，从容器执行命令，运行服务以及检查节点和Pod的整体运行状况的能力。</p> <p>运行一个简单的nginx部署：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create deployment nginx --image<span class="token operator">=</span>nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看集群中的部署：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get deployments
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看集群中的Pod：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get pods
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用端口转发直接访问Pod：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl port-forward <span class="token variable">$pod_name</span> <span class="token number">8081</span>:80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>直接从Nginx窗格获得响应：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> --head http://127.0.0.1:8081
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从窗格中查看日志：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl logs <span class="token variable">$pod_name</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>直接从容器运行命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it <span class="token variable">$pod_name</span> -- nginx -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过暴露nginx部署的端口80创建服务：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl expose deployment nginx --port <span class="token number">80</span> --type NodePort
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>列出集群中的服务：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get services
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>取得服务的回应：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -I localhost:<span class="token variable">$node_port</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>列出节点的状态：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get nodes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看有关节点的详细信息：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl describe nodes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看有关吊舱的详细信息：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl describe pods
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有用的网址：</p> <p><a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-testing/e2e-tests.md" target="_blank" rel="noopener noreferrer">Kubetest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://kubernetes.io/docs/getting-started-guides/ubuntu/" target="_blank" rel="noopener noreferrer">测试一个枣簇<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/31/2020, 10:10:19 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/基础设施/k8s/2020-08-21-【CKA】-00k8s管理员.html" class="prev">
        ===■ CKA.k8s管理员===
      </a></span> <span class="next"><a href="/docs/基础设施/k8s/2020-08-22-【CKA】-03管理集群.html">
        【CKA】03-管理集群
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.080d4239.js" defer></script><script src="/docs/assets/js/5.379e7eff.js" defer></script><script src="/docs/assets/js/2.28087ae7.js" defer></script><script src="/docs/assets/js/72.548dd7a5.js" defer></script><script src="/docs/assets/js/3.32492e15.js" defer></script>
  </body>
</html>
