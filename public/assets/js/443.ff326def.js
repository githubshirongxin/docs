(window.webpackJsonp=window.webpackJsonp||[]).push([[443],{925:function(s,a,e){"use strict";e.r(a);var r=e(59),n=Object(r.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker-安装sonarqube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装sonarqube"}},[s._v("#")]),s._v(" docker 安装sonarqube")]),s._v(" "),e("p",[s._v("首先需要安装数据库，开源的可以用 mysql 或者postgresql 。官网上已经声明 sonarQube 7.9 版本以上不再支持 mysql 了，为了以后升级新版本不做数据库迁移，使用postgresql")]),s._v(" "),e("h2",{attrs:{id:"安装前准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装前准备"}},[s._v("#")]),s._v(" 安装前准备")]),s._v(" "),e("p",[s._v("因为docker默认拉取镜像很慢，非常慢，慢到爆炸，所以先配置docker从国内镜像库拉取镜像，创建/etc/docker/daemon.json文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /etc/docker/daemon.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("追加如下内容")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n    "registry-mirrors" : [\n    "https://registry.docker-cn.com",\n    "https://docker.mirrors.ustc.edu.cn",\n    "http://hub-mirror.c.163.com",\n    "https://cr.console.aliyun.com/"\n  ]\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("重启docker")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("service docker restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("ok现在拉取镜像速度就非常快了，开始安装")]),s._v(" "),e("h3",{attrs:{id:"一、docker-安装-postgresql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、docker-安装-postgresql"}},[s._v("#")]),s._v(" 一、docker 安装 postgresql")]),s._v(" "),e("h4",{attrs:{id:"_1-postgresql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-postgresql"}},[s._v("#")]),s._v(" 1. postgresql")]),s._v(" "),e("p",[s._v("1).拉取 postgresql 镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull postgres:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2).创建网络")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker network create sonarqube-tier  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3).创建容器并运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run --name postgres -p 5432:5432 -e POSTGRES_USER=sonar -e POSTGRES_PASSWORD=sonar \\\n--net sonarqube-tier \\\n-e POSTGRES_DB=sonar \\\n--restart always \\\n--privileged=true \\\n--network-alias postgres \\\n-d postgres \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h4",{attrs:{id:"_2-各个参数的含义："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-各个参数的含义："}},[s._v("#")]),s._v(" 2. 各个参数的含义：")]),s._v(" "),e("blockquote",[e("p",[s._v("-p 5432:5432：将容器 5432 映射到宿主机端口 5432"),e("br"),s._v("\n-v /etc/localtime:/etc/localtime:ro：设置容器与宿主机时间一致"),e("br"),s._v("\n-e POSTGRES_USER=sonar：设置数据库用户名"),e("br"),s._v("\n-e POSTGRES_PASSWORD=sonar：设置数据库密码"),e("br"),s._v("\n-e POSTGRES_DB=sonar：新建db"),e("br"),s._v("\n-e TZ=Asia/Shanghai：设置时区"),e("br"),s._v("\n--restart always：容器退出时总是重启"),e("br"),s._v("\n--privileged=true：挂载主机目录Docker访问出现Permission denied的解决办法\n--network-alias mysql：给容器起个网络别名")])]),s._v(" "),e("h3",{attrs:{id:"二、安装-sonarqube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、安装-sonarqube"}},[s._v("#")]),s._v(" 二、安装 SonarQube")]),s._v(" "),e("p",[s._v("1.拉取镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull sonarqube\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_2-创建工作目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建工作目录"}},[s._v("#")]),s._v(" 2.创建工作目录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /data/sonarqube  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_3-修改系统参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改系统参数"}},[s._v("#")]),s._v(" 3.修改系统参数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('echo "vm.max_map_count=262144" > /etc/sysctl.conf  \nsysctl -p  \n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"_4-运行一个test容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-运行一个test容器"}},[s._v("#")]),s._v(" 4.运行一个test容器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d --name sonartest sonarqube  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("将容器内重要文件复制到宿主机")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker cp sonartest:/opt/sonarqube/conf /data/sonarqube  \ndocker cp sonartest:/opt/sonarqube/data /data/sonarqube  \ndocker cp sonartest:/opt/sonarqube/logs /data/sonarqube  \ndocker cp sonartest:/opt/sonarqube/extensions /data/sonarqube  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("然后删除此容器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker stop sonartest\ndocker rm sonartest  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改文件夹权限")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chmod -R 777 /data/sonarqube/  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_5-创建容器并运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建容器并运行"}},[s._v("#")]),s._v(" 5.创建容器并运行")]),s._v(" "),e("h5",{attrs:{id:"方法一"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方法一"}},[s._v("#")]),s._v(" 方法一")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run --name sonar --link postgres -e SONARQUBE_JDBC_URL=jdbc:postgresql://postgres:5432/sonar -p 9000:9000\\\n -e sonar.jdbc.password=sonar\\\n -e sonar.jdbc.username=sonar\\\n --restart always \\\n --net sonarqube-tier \\\n --privileged=true \\\n --restart always \\\n -v /data/sonarqube/logs:/opt/sonarqube/logs \\\n -v /data/sonarqube/conf:/opt/sonarqube/conf \\\n -v /data/sonarqube/data:/opt/sonarqube/data \\\n -d sonarqube\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("若这种方式出现连不上数据库 postgres 的问题，可参照第二种方"),e("br"),s._v("\n#####方法二"),e("br"),s._v("\n1）找到 /data/sonarqube/conf/ 路径下的文件 sonar.properties，修改如下并保存")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 找到如下配置去掉注释。并赋值 username，password  \nsonar.jdbc.username=sonar  \nsonar.jdbc.password=sonar  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 去掉 sonar.jdbc.url 注释，配置url  \n#----- PostgreSQL 9.3 or greater  \n# By default the schema named "public" is used. It can be overridden with the parameter "currentSchema".  \nsonar.jdbc.url=jdbc:postgresql://postgres:5432/sonar  \n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("2）使用docker命令创建容器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d --name sonar -p 9000:9000 \\  \n> --net sonarqube-tier \\  \n> --privileged=true \\  \n> --restart always \\  \n> -v /data/sonarqube/logs:/opt/sonarqube/logs \\  \n> -v /data/sonarqube/conf:/opt/sonarqube/conf \\  \n> -v /data/sonarqube/data:/opt/sonarqube/data \\  \n> -v /data/sonarqube/extensions:/opt/sonarqube/extensions\\  \n> sonarqube:7.4-community  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h4",{attrs:{id:"_6-浏览器输入http-ip-9000，开始初始化数据库，这个时间过程比较长，大概几分钟。初始化成功后进入登录界面，账号：admin-密码：admin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-浏览器输入http-ip-9000，开始初始化数据库，这个时间过程比较长，大概几分钟。初始化成功后进入登录界面，账号：admin-密码：admin"}},[s._v("#")]),s._v(" 6.浏览器输入http://ip:9000，开始初始化数据库，这个时间过程比较长，大概几分钟。初始化成功后进入登录界面，账号：admin  密码：admin")]),s._v(" "),e("p",[e("img",{attrs:{src:"/docs/images/123.jpg",alt:"节点"}})]),s._v(" "),e("p",[s._v("如果没有成功可以用以下命令查看log")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker logs sonar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果出现了")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ERROR: bootstrap checks failed\n[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("编辑 /etc/sysctl.conf，追加以下内容：\nvm.max_map_count=655360\n保存后，执行：\nsysctl -p")]),s._v(" "),e("p",[s._v("重新启动，成功。")]),s._v(" "),e("p",[s._v("7.可以安装中文语言包，点击Administration→Marketplace，搜索框搜索chinese第一个就是，安装即可\n"),e("img",{attrs:{src:"/docs/images/456.jpg",alt:"节点"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);