(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{510:function(r,e,s){"use strict";s.r(e);var t=s(59),o=Object(t.a)({},(function(){var r=this,e=r.$createElement,s=r._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[s("p",[r._v("主机名角色")]),r._v(" "),s("p",[r._v("192.168.3.105  Docker Repository")]),r._v(" "),s("p",[r._v("192.168.3.102  Docker Client")]),r._v(" "),s("ol",[s("li",[s("p",[r._v("在两台节点分别安装docker\nhttps://www.cnblogs.com/ilifeilong/p/11687143.html")])]),r._v(" "),s("li",[s("p",[r._v("在 3.105 （ Docker Repository ) 节点下载官方提供的registry镜像\ndocker images")])])]),r._v(" "),s("p",[r._v("docker search registry")]),r._v(" "),s("p",[r._v("docker pull registry")]),r._v(" "),s("p",[r._v("docker images")]),r._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[r._v("在3.105 （ Docker Repository ) 节点新建registry容器\ndocker run --detach --publish 5000:5000 --name registry-container --hostname registry registry")])]),r._v(" "),s("p",[r._v("docker ps")]),r._v(" "),s("p",[r._v("查看当前registry镜像仓库，当前并未有任何镜像")]),r._v(" "),s("p",[r._v("curl -X GET http://192.168.3.105:5000/v2/_catalog")]),r._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[r._v("在3.106（Docker client） 节点上模拟客户端上传和下载镜像\n4.1 在3.106 新建文件daemon.json（ 默认是没有的！）添加如下内容\n/etc/docker/daemon.json")])]),r._v(" "),s("p",[r._v('{\n"registry-mirror": [    "https://registry.docker-cn.com"  ],\n"insecure-registries": [   "192.168.3.105:5000"  ]\n}')]),r._v(" "),s("p",[r._v("4.2 在3.106 重启docker服务\nsystemctl stop docker")]),r._v(" "),s("p",[r._v("systemctl start docker")]),r._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[r._v("在3.106  上传镜像\n在3.106 为需要上传的映像文件添加新的tag\ndocker images")])]),r._v(" "),s("p",[r._v("docker tag mysql:5.7 192.168.3.105:5000/mysql:5.7")]),r._v(" "),s("p",[r._v("docker images")]),r._v(" "),s("p",[r._v("REPOSITORY                            TAG                IMAGE ID            CREATED            SIZE")]),r._v(" "),s("p",[r._v("192.168.3.105:5000/centos/mysql  5.7            b7138378001a4hours ago4.57GB")]),r._v(" "),s("p",[r._v("在3.106 上传镜像至registry\ndocker push 192.168.3.105:5000/mysql:5.7")]),r._v(" "),s("p",[r._v("在3.105（在哪都行3.105，3.106或3.107都行）registry查看镜像\ncurl -X GET http://192.168.3.105:5000/v2/")]),r._v(" "),s("p",[r._v('{"repositories":["mysql"]}')]),r._v(" "),s("p",[r._v("curl -X GET http://192.168.3.105:5000/v2/mysql/tags/list")]),r._v(" "),s("p",[r._v('{"name":"mysql","tags":["5.7"]}')]),r._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[r._v("在3.107下载镜像")])]),r._v(" "),s("p",[r._v("3.107上的daemon.json也得手动新建，改成如下。")]),r._v(" "),s("p",[r._v("（ 否则从3.105 pull的时候报错。Error response from daemon: Get https://192.168.3.105:5000/v2/: http: server gave HTTP response to HTTPS ）见到这个错误，就知道是daemon.json没有改，或者改完没有重新启动docker服务。")]),r._v(" "),s("p",[r._v("/etc/docker/daemon.json")]),r._v(" "),s("p",[r._v("{")]),r._v(" "),s("p",[r._v('"registry-mirror": [    "https://registry.docker-cn.com"  ],')]),r._v(" "),s("p",[r._v('"insecure-registries": [   "192.168.3.105:5000"  ]')]),r._v(" "),s("p",[r._v("}")]),r._v(" "),s("p",[r._v("然后service docker restart")]),r._v(" "),s("h1",{attrs:{id:"docker-images"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-images"}},[r._v("#")]),r._v(" docker images")]),r._v(" "),s("h1",{attrs:{id:"docker-pull-192-168-3-105-5000-mysql-5-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-pull-192-168-3-105-5000-mysql-5-7"}},[r._v("#")]),r._v(" docker pull 192.168.3.105:5000/mysql:5.7")]),r._v(" "),s("h1",{attrs:{id:"docker-images-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-images-2"}},[r._v("#")]),r._v(" docker images")]),r._v(" "),s("p",[r._v("REPOSITORY                            TAG                IMAGE ID            CREATED            SIZE")]),r._v(" "),s("p",[r._v("192.168.3.105:5000/mysql  5.7    b7138378001a5hours ago4.57GB")]),r._v(" "),s("p",[r._v("在3.107 为了方便使用，将下载下来的镜像再命名一份。")]),r._v(" "),s("h1",{attrs:{id:"docker-tag-192-168-3-105-5000-mysql-5-7-mysql-5-7-（会多了一个镜像，原来的不会删除）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-tag-192-168-3-105-5000-mysql-5-7-mysql-5-7-（会多了一个镜像，原来的不会删除）"}},[r._v("#")]),r._v(" docker tag 192.168.3.105:5000/mysql:5.7 mysql:5.7  （会多了一个镜像，原来的不会删除）")]),r._v(" "),s("h1",{attrs:{id:"docker-images-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-images-3"}},[r._v("#")]),r._v(" docker images")]),r._v(" "),s("p",[r._v("[root@centos3 ~]# docker images")]),r._v(" "),s("p",[r._v("REPOSITORY                TAG                IMAGE ID            CREATED            SIZE\n192.168.3.105:5000/mysql  5.7                9cfcce23593a        8 days ago          448MB\nmysql                      5.7                9cfcce23593a        8 days ago          448MB")]),r._v(" "),s("p",[r._v("在3.107用完了觉得没必要留着了，就删掉该镜像腾出地方")]),r._v(" "),s("h1",{attrs:{id:"docker-rmi-192-168-3-105-5000-centos-mysql-5-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-rmi-192-168-3-105-5000-centos-mysql-5-7"}},[r._v("#")]),r._v(" docker rmi 192.168.3.105:5000/centos/mysql:5.7")]),r._v(" "),s("h1",{attrs:{id:"docker-images-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-images-4"}},[r._v("#")]),r._v(" docker images")])])}),[],!1,null,null,null);e.default=o.exports}}]);