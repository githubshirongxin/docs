(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{542:function(s,a,n){"use strict";n.r(a);var t=n(59),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"先让runner从私服上下载吧。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#先让runner从私服上下载吧。"}},[s._v("#")]),s._v(" 先让runner从私服上下载吧。")]),s._v(" "),n("p",[s._v('[root@centos3 ~]# cat /etc/docker/daemon.json\n{\n"insecure-registries": ["harbor.ccbjb.com.cn","192.168.3.124:8082","192.168.3.124:8083"]\n}\n[root@centos3 ~]#\n[root@centos3 ~]# systemctl daemon-reload && systemctl restart docker.service\n[root@centos3 ~]# docker login 192.168.3.124:8083\nUsername: admin\nPassword:\nLogin Succeeded\n[root@centos3 ~]# docker login 192.168.3.124:8082\nUsername: admin\nPassword:\nLogin Succeeded')]),s._v(" "),n("p",[s._v("//gitlab-ci.yml")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[s._v("image: 192.168.3.124:8082/node:latest\n\npages:\n  cache:\n    paths:\n    - node_modules/\n\n  script:\n   - yarn install\n   - yarn run build \n \n  artifacts:\n    paths:\n    - public\n  only:\n  - master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[n("img",{attrs:{src:"/docs/images/2020-08-08-09-20-47.png",alt:""}})]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[s._v('\nRunning with gitlab-runner 13.2.1 (efa30e33)\n   on shared runner form 3.112 Unz4U-uF\nPreparing the "docker" executor\n00:11\n Using Docker executor with image 192.168.3.124:8082/node:latest ...\n Pulling docker image 192.168.3.124:8082/node:latest ...\n ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials (docker.go:131:0s)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("3.112\nvi docker-compose.yml\n增加 -v /etc/docker/daemon.json:/etc/docker/daemon.json")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose down\ndocker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("3.102\ngit push")]),s._v(" "),n("p",[s._v("3.112 error the same.")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("参考:https://blog.csdn.net/renguiriyue/article/details/102769884")]),s._v(" "),n("p",[s._v("课题：为什么runner里没安装docker，却能使用docker regiser？")]),s._v(" "),n("p",[s._v("课题：runner调用docker时使用了什么机制？")]),s._v(" "),n("p",[s._v("课题：runner和gitlab-ci使用什么机制通讯，日志和状态是怎么传递给gitlab-ci的？")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像")]),s._v("\n docker build -t srximg "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" \n docker images\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器")]),s._v("\n docker run -d --name srxcontainer srximg:latest "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it srxcontainer /bin/bash\n docker stop srxcontainer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" srxcontainer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker rmi srximg\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#清除坏的<none>:<none>镜像")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dangling=true"')]),s._v(" -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有停止的容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker container prune\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos112 enviroment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t srximg .")]),s._v("\nSending build context to Docker daemon  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("471")]),s._v(".2MB\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM gitlab/gitlab-runner:latest\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" a0153b77b0da\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER shirongxin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("shirx@ccbjb.com.cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 362be8f59e24\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" d0b29c3c05ee\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/java\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" f6f79795f236\nRemoving intermediate container f6f79795f236\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e76dcfbdeba9\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" WORKDIR /usr/local/java\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" f6263cebe3a2\nRemoving intermediate container f6263cebe3a2\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 2dce5a8195d3\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz /usr/local/java\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" b62304fa0fa3\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENV JAVA_HOME /usr/java/jdk1.8.0_261-amd64/bin/java\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" fa0376ce9194\nRemoving intermediate container fa0376ce9194\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" acd17be40649\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" WORKDIR /\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" c250388054b2\nRemoving intermediate container c250388054b2\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 70a3aa0cad5e\nSuccessfully built 70a3aa0cad5e\nSuccessfully tagged srximg:latest\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos112 enviroment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("GitLab Runner Docker images (based on Ubuntu or Alpine Linux)，安装docker时候出错。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("Creating config "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/apt/apt.conf.d/50unattended-upgrades with new version\nSetting up python3-software-properties "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.96")]),s._v(".20.9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSetting up software-properties-common "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.96")]),s._v(".20.9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" libc-bin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.27")]),s._v("-3ubuntu1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" sgml-base "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.26")]),s._v("+nmu4ubuntu1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" dbus "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),s._v(".6-1ubuntu3.6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nE: gnupg, gnupg2 and gnupg1 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not seem to be installed, but one of them is required "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this operation\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed writing body\nThe "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/bin/sh -c dpkg --configure -a &&     apt-get install -y apt-transport-https ca-certificates curl software-properties-common &&\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&     add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" stable\" &&     apt-get update -y &&     apt-get install -y docker-ce'")]),s._v(" returned a non-zero code: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos112 enviroment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("root@def6fbc9a09a:/# cd /etc\nroot@def6fbc9a09a:/etc# ls red*\nls: cannot access 'red*': No such file or directory\nroot@def6fbc9a09a:/etc# ls issue\nissue\nroot@def6fbc9a09a:/etc# cat issue\nUbuntu 18.04.4 LTS \\n \\l")]),s._v(" "),n("p",[s._v("识别操作系统的方法：\nhttps://blog.csdn.net/Dafei4/article/details/79589369/")]),s._v(" "),n("p",[s._v("gitlab Runner的系统名字\nlsb_release -cs = "),n("strong",[s._v("bionic")]),s._v("\nhttps://download.docker.com/linux/ubuntu")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Index of linux/ubuntu/dists/\n../\nartful/\nbionic/\ncosmic/\ndisco/\neoan/\nfocal/\ntrusty/\nxenial/\nyakkety/\nzesty/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("所以使用库的时候，必须指定bionic\n原来博文中的史xenial，而我下载的gitlabrunner使用的史bionic")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改软件源")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("// 完整Dockerfile如下，安装好docker，docker-compose，java，maven")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("MAINTAINER shirongxin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("shirx@ccbjb.com.cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改软件源")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" apt-transport-https ca-certificates "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" software-properties-common "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" apt-key "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" - "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    add-apt-repository "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu '),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' stable"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN apt-get update && apt-get install -y gnupg2 && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    dpkg --configure -a && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get install -y apt-transport-https ca-certificates curl software-properties-common && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -no-tty - && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" && \\')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get update -y && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get install -y docker-ce")]),s._v("\nCOPY daemon.json /etc/docker/daemon.json\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker Compose（这边的链接会失效的，所以还需要自己到docker-compose 确认）")]),s._v("\nWORKDIR /usr/local/bin\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://raw.githubusercontent.com/topsale/resources/master/docker-compose")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/docker/compose/releases/download/1.26.1/docker-compose-'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v("  -s"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-composeRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 java")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/java\nWORKDIR /usr/local/java\nCOPY openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz /usr/local/java\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     rm -fr openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Maven")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/maven\nWORKDIR /usr/local/maven\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://raw.githubusercontent.com/topsale/resources/master/maven/apache-maven-3.5.3-bin.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz")]),s._v("\nCOPY apache-maven-3.6.3-bin.tar.gz /usr/local/maven\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf apache-maven-3.6.3-bin.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    rm -fr apache-maven-3.6.3-bin.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备一份maven 配置好的文件，这里参考 nexus 配置")]),s._v("\nCOPY settings.xml /usr/local/maven/apache-maven-3.6.3/conf/settings.xml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置环境变量")]),s._v("\nENV JAVA_HOME /usr/local/java/java-se-8u41-ri\nENV MAVEN_HOME /usr/local/maven/apache-maven-3.6.3\nENV "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAVEN_HOME")]),s._v("/bin\n\nWORKDIR /\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br")])]),n("p",[s._v("docker-compose up -d\ndocker exec -it gitlab_runner /bin/bash")]),s._v(" "),n("p",[s._v("Runner error:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('Preparing the "docker" executor\n Using Docker executor with image 192.168.3.124:8082/node:latest ...\n Pulling docker image 192.168.3.124:8082/node:latest ...\n ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials (docker.go:131:0s)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("难道Runner里需要先docker login 192.158.3.124:8082 ?")]),s._v(" "),n("p",[s._v("试试")]),s._v(" "),n("p",[s._v("果然，更新vuepress，自动编译了。好用了")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("Running with gitlab-runner "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.2")]),s._v(".1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("efa30e33"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   on shared runner form "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.112")]),s._v(" Unz4U-uF\nPreparing the "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v(" executor\n Using Docker executor with image "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Authenticating with credentials from /root/.docker/config.json\n Pulling docker image "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Using docker image sha256:002df0b34ccb8b3bcaf022b8fea4e6b5cce1bc811fbd33d38840cdc21ee5f931 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nPreparing environment\n00:00\n Running on runner-unz4u-uf-project-11-concurrent-0 via b2fd1f150f12"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nGetting "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" from Git repository\n00:03\n Fetching changes with "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" depth "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Reinitialized existing Git repository "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /builds/shirongxin/docs/.git/\n Checking out 5c0d0b1e as master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Removing node_modules/\n Removing public/\n Skipping Git submodules setup\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("试试把nexus上的node删掉，看看nexus是否能自动下载")]),s._v(" "),n("p",[s._v("NEXUS上node镜像下来了。编译时间1m3s")]),s._v(" "),n("p",[s._v("这个基础，再次更新vuepress，看看编译时间。1m2s，也是这个时间。")]),s._v(" "),n("p",[s._v("纳闷了。不用本地库呢？")]),s._v(" "),n("p",[s._v("gitlab-ci.yml使用远程库。看看，编译时间1m10s，没差多少。")]),s._v(" "),n("p",[s._v("难道是应为runner走的都是nexus？")]),s._v(" "),n("p",[s._v("把runner")]),s._v(" "),n("p",[s._v("不使用runner、随便3.125上命令行测试docker pull node 1m\n// 3.124上还没有node\ndocker pull 192.168.3.124:8082/node  1m20s\n// 3.123已经有node的前提下\ndocker pull 192.168.3.124:8082/node  15s ， 比外网下载快多了啊。")]),s._v(" "),n("p",[s._v("那么，为什么runner上用不用私服差别不大呢？\n另外，gitlab-ci.yml中使用image: 192.168.3.124:8082/node:latest开头，应该不对。正确做法应该让gitlabci对nexus无意识，旨在runner上配置。")]),s._v(" "),n("h2",{attrs:{id:"阿里云镜像也不快，还不如不用。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里云镜像也不快，还不如不用。"}},[s._v("#")]),s._v(" 阿里云镜像也不快，还不如不用。")]),s._v(" "),n("h3",{attrs:{id:"另外，不用阿里云镜像呢-1m5s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#另外，不用阿里云镜像呢-1m5s"}},[s._v("#")]),s._v(" // 另外，不用阿里云镜像呢 , 1m5s")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n // "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ji1i86y7.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"使用阿里云镜像呢-1m25s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用阿里云镜像呢-1m25s"}},[s._v("#")]),s._v(" //使用阿里云镜像呢 ,1m25s.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ji1i86y7.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"使用192-168-3-124：8082做镜像呢？-59s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用192-168-3-124：8082做镜像呢？-59s"}},[s._v("#")]),s._v(" //使用192.168.3.124：8082做镜像呢？ 59s")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.3.124:8082"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull node")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"使用私服上已经有node-15s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用私服上已经有node-15s"}},[s._v("#")]),s._v(" //使用私服上已经有node 15s")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@centos125:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull 192.168.3.124:8082/node")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"如何让docker-pull-自动去找私服，而不用写打私服的tag呢？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何让docker-pull-自动去找私服，而不用写打私服的tag呢？"}},[s._v("#")]),s._v(" 如何让docker pull 自动去找私服，而不用写打私服的tag呢？")]),s._v(" "),n("h3",{attrs:{id:"尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在"}},[s._v("#")]),s._v(" 尝试：registry-mirrors:设置成私库地址，docker pull srximg // srximg只在私库上存在")]),s._v(" "),n("p",[s._v("结果：找不到，出错。\n分析：daemon.json里配置的registry-mirrors对“docker pull 不加私服ip”这样的命令不起作用。\n结论：想让"),n("code",[s._v("docker pull 不加私服ip")]),s._v(" 这样的命令主动去私服下载，别指望daemon.json.")]),s._v(" "),n("h3",{attrs:{id:""}},[n("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])])])}),[],!1,null,null,null);a.default=e.exports}}]);