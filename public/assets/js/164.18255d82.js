(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{647:function(e,s,a){"use strict";a.r(s);var n=a(59),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"常用工具类型解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用工具类型解读"}},[e._v("#")]),e._v(" 常用工具类型解读")]),e._v(" "),a("p",[e._v("用 JavaScript 编写中大型程序是离不开 lodash 这种工具集的，而用 TypeScript 编程同样离不开类型工具的帮助，类型工具就是类型版的 lodash.")]),e._v(" "),a("p",[e._v("我们在本节会介绍一些类型工具的设计与实现，如果你的项目不是非常简单的 demo 级项目，那么在你的开发过程中一定会用到它们。")]),e._v(" "),a("p",[e._v("起初，TypeScript 没有这么多工具类型，很多都是社区创造出来的，然后 TypeScript 陆续将一些常用的工具类型纳入了官方基准库内。")]),e._v(" "),a("p",[e._v("我们之前提到过的 "),a("code",[e._v("ReturnType")]),e._v("、"),a("code",[e._v("Partial")]),e._v("、"),a("code",[e._v("ConstructorParameters")]),e._v("、"),a("code",[e._v("Pick")]),e._v(" 都是官方的内置工具类型.")]),e._v(" "),a("p",[e._v("其实上述的工具类型都可以被我们开发者自己模拟出来,本节我们学习一下如何设计工具类型.")]),e._v(" "),a("h2",{attrs:{id:"工具类型的设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具类型的设计"}},[e._v("#")]),e._v(" 工具类型的设计")]),e._v(" "),a("h3",{attrs:{id:"泛型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#泛型"}},[e._v("#")]),e._v(" 泛型")]),e._v(" "),a("p",[e._v("我们说过可以把工具类型类比 js 中的工具函数，因此必须有输入和输出，而在TS的类型系统中能担当类型入口的只有泛型.")]),e._v(" "),a("p",[e._v("比如之前我们提到过的"),a("code",[e._v("Partial")]),e._v(",它的作用是将属性全部变为可选.")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Partial<T> = { [P in keyof T]?: T[P] };\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("这个类型工具中,我们需要将类型通过泛型"),a("code",[e._v("T")]),e._v("传入才能对类型进行处理并返回新类型,可以说,一切类型工具的基础就是泛型.")]),e._v(" "),a("h3",{attrs:{id:"类型递归"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型递归"}},[e._v("#")]),e._v(" 类型递归")]),e._v(" "),a("p",[e._v("是的,在类型中也有类似于js递归的操作,上面提到的"),a("code",[e._v("Partial")]),e._v("可以把属性变为可选,但是他有个问题,就是无法把深层属性变成可选,只能处理外层属性:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("interface Company {\n    id: number\n    name: string\n}\n\ninterface Person {\n    id: number\n    name: string\n    adress: string\n    company: Company\n}\n\ntype R1 = Partial<Person>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/6/16da1a8b34dc7e54?w=368&h=197&f=png&s=20711",alt:"2019-09-26-20-43-21"}})]),e._v(" "),a("p",[e._v("这里想处理深层属性,就必须用到类型递归:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type DeepPartial<T> = {\n    [U in keyof T]?: T[U] extends object\n    ? DeepPartial<T[U]>\n    : T[U]\n};\n\ntype R2 = DeepPartial<Person>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/6/16da1a8b34f7a170?w=438&h=173&f=png&s=23471",alt:"2019-09-26-20-48-25"}})]),e._v(" "),a("p",[e._v("这个原理跟js类似,就是对外层的value做个判断,如果恰好是"),a("code",[e._v("object")]),e._v("类型,那么对他也进行属性可选化的操作即可.")]),e._v(" "),a("h3",{attrs:{id:"关键字"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键字"}},[e._v("#")]),e._v(" 关键字")]),e._v(" "),a("p",[e._v("像"),a("code",[e._v("keyof")]),e._v("、"),a("code",[e._v("typeof")]),e._v("这种常用关键字我们已经了解过了,现在主要谈一下另外一些常用关键字.")]),e._v(" "),a("p",[a("code",[e._v("+")]),e._v(" "),a("code",[e._v("-")]),e._v("这两个关键字用于映射类型中给属性添加修饰符,比如"),a("code",[e._v("-?")]),e._v("就代表将可选属性变为必选,"),a("code",[e._v("-readonly")]),e._v("代表将只读属性变为非只读.")]),e._v(" "),a("p",[e._v("比如TS就内置了一个类型工具"),a("code",[e._v("Required<T>")]),e._v(",它的作用是将传入的属性变为必选项:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Required<T> = { [P in keyof T]-?: T[P] };\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("当然还有很常用的"),a("code",[e._v("Type inference")]),e._v("就是上一节infer关键字的使用,还有之前的"),a("code",[e._v("Conditional Type")]),e._v("条件类型都是工具类型的常用手法,在这里就不多赘述了。")]),e._v(" "),a("h2",{attrs:{id:"常见工具类型的解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见工具类型的解读"}},[e._v("#")]),e._v(" 常见工具类型的解读")]),e._v(" "),a("h3",{attrs:{id:"omit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#omit"}},[e._v("#")]),e._v(" Omit")]),e._v(" "),a("p",[a("code",[e._v("Omit")]),e._v("这个工具类型在开发过程中非常常见,以至于官方在3.5版本正式加入了"),a("code",[e._v("Omit")]),e._v("类型.")]),e._v(" "),a("p",[e._v("要了解之前我们先看一下另一个内置类型工具的实现"),a("code",[e._v("Exclude<T>")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Exclude<T, U> = T extends U ? never : T;\ntype T = Exclude<1 | 2, 1 | 3> // -> 2\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("code",[e._v("Exclude")]),e._v(" 的作用是从 "),a("code",[e._v("T")]),e._v(" 中排除出"),a("strong",[e._v("可分配")]),e._v("给 "),a("code",[e._v("U")]),e._v("的元素.")]),e._v(" "),a("blockquote",[a("p",[e._v("这里的可分配即"),a("code",[e._v("assignable")]),e._v(",指可分配的,"),a("code",[e._v("T extends U")]),e._v("指T是否可分配给U")])]),e._v(" "),a("p",[e._v("那么"),a("code",[e._v("Exclude")]),e._v("跟"),a("code",[e._v("Omit")]),e._v("有什么关系呢?")]),e._v(" "),a("p",[e._v("其实"),a("code",[e._v("Omit")]),e._v(" = "),a("code",[e._v("Exclude")]),e._v(" + "),a("code",[e._v("Pick")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Omit<T, K> = Pick<T, Exclude<keyof T, K>>\n\ntype Foo = Omit<{name: string, age: number}, 'name'> // -> { age: number }\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[a("code",[e._v("Omit<T, K>")]),e._v("的作用是忽略"),a("code",[e._v("T")]),e._v("中的某些属性.")]),e._v(" "),a("h3",{attrs:{id:"merge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#merge"}},[e._v("#")]),e._v(" Merge")]),e._v(" "),a("p",[a("code",[e._v("Merge<O1, O2>")]),e._v("的作用是将两个对象的属性合并:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type O1 = {\n    name: string\n    id: number\n}\n\ntype O2 = {\n    id: number\n    from: string\n}\n\ntype R2 = Merge<O1, O2>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("结果")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/11/16dbb1464cc80532?w=366&h=222&f=png&s=24864",alt:"2019-09-26-23-34-57"}})]),e._v(" "),a("p",[e._v("这个类型工具也非常常用,他主要有两个部分组成:")]),e._v(" "),a("p",[a("code",[e._v("Merge<O1, O2>")]),e._v(" = "),a("code",[e._v("Compute<A>")]),e._v(" + "),a("code",[e._v("Omit<U, T>")])]),e._v(" "),a("p",[a("code",[e._v("Compute")]),e._v("的作用是将交叉类型合并.即:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Compute<A extends any> =\n    A extends Function\n    ? A\n    : { [K in keyof A]: A[K] }\n\ntype R1 = Compute<{x: 'x'} & {y: 'y'}>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("结果如下:")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/11/16dbb1464cbb2ca3?w=450&h=161&f=png&s=20061",alt:"2019-09-26-23-41-30"}})]),e._v(" "),a("p",[e._v("Merge的最终实现如下:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Merge<O1 extends object, O2 extends object> =\n    Compute<O1 & Omit<O2, keyof O1>>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"intersection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#intersection"}},[e._v("#")]),e._v(" Intersection")]),e._v(" "),a("p",[a("code",[e._v("Intersection<T, U>")]),e._v("的作用是取"),a("code",[e._v("T")]),e._v("的属性,此属性同样也存在与"),a("code",[e._v("U")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\ntype Props = { name: string; age: number; visible: boolean };\ntype DefaultProps = { age: number };\n\n// Expect: { age: number; }\ntype DuplicatedProps = Intersection<Props, DefaultProps>;\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[a("code",[e._v("Intersection")]),e._v("是"),a("code",[e._v("Extract")]),e._v("与"),a("code",[e._v("Pick")]),e._v("的结合")]),e._v(" "),a("p",[a("code",[e._v("Intersection<T, U>")]),e._v(" = "),a("code",[e._v("Extract<T, U>")]),e._v(" + "),a("code",[e._v("Pick<T, U>")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\ntype Intersection<T extends object, U extends object> = Pick<\n  T,\n  Extract<keyof T, keyof U> & Extract<keyof U, keyof T>\n>;\n\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h3",{attrs:{id:"overwrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overwrite"}},[e._v("#")]),e._v(" Overwrite")]),e._v(" "),a("p",[a("code",[e._v("Overwrite<T, U>")]),e._v("顾名思义,是用"),a("code",[e._v("U")]),e._v("的属性覆盖"),a("code",[e._v("T")]),e._v("的相同属性.")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Props = { name: string; age: number; visible: boolean };\ntype NewProps = { age: string; other: string };\n\n// Expect: { name: string; age: string; visible: boolean; }\ntype ReplacedProps = Overwrite<Props, NewProps>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("即:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Overwrite<\n  T extends object,\n  U extends object,\n  I = Diff<T, U> & Intersection<U, T>\n> = Pick<I, keyof I>;\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h3",{attrs:{id:"mutable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mutable"}},[e._v("#")]),e._v(" Mutable")]),e._v(" "),a("p",[e._v("将 "),a("code",[e._v("T")]),e._v(" 的所有属性的 "),a("code",[e._v("readonly")]),e._v(" 移除")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("type Mutable<T> = {\n  -readonly [P in keyof T]: T[P]\n}\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[e._v("#")]),e._v(" 小结")]),e._v(" "),a("p",[e._v("本节我们介绍了几种常见的高级类型工具,尤其是前三个非常常用,当然如果你想进一步学习类型工具的设计,建议阅读"),a("a",{attrs:{href:"https://github.com/piotrwitek/utility-types",target:"_blank",rel:"noopener noreferrer"}},[e._v("utility-types"),a("OutboundLink")],1),e._v("的源码,本节部分实现就是源于此类型工具库.")])])}),[],!1,null,null,null);s.default=t.exports}}]);