(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{506:function(s,t,e){"use strict";e.r(t);var a=e(59),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("https://segmentfault.com/a/1190000019085780?utm_source=tag-newest")]),s._v(" "),e("h2",{attrs:{id:"_1-讲jks导出证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-讲jks导出证书"}},[s._v("#")]),s._v(" 1. 讲jks导出证书")]),s._v(" "),e("ol",[e("li",[s._v("拿到jks证书，和证书密码(确认没有密码的，拿刀找你们运维去，或找供应方去)")]),s._v(" "),e("li",[s._v("先将jks 转换成p12格式，具体命令如下:")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("keytool -importkeystore -srckeystore C:\\cert\\server.jks -destkeystore C:\\cert\\server.p12 -srcstoretype jks -deststoretype pkcs12\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("输入命令后，会提示你三步骤，需要输入口令(建议输入相同的口令，就是你的jks口令，防止后续证书转换忘记密码)")]),s._v(" "),e("ul",[e("li",[s._v("1). 输入目标密钥库口令:")]),s._v(" "),e("li",[s._v("2).再次输入新口令:")]),s._v(" "),e("li",[s._v("3).输入源密钥库口令:\n接下来就会提示你如下：\n已成功导入别名 ca_root 的条目\n已完成导入命令: 1 个条目成功导入, 0 个条目失败或取消\n到了这一步，说明已经OK了，剩下的就是转换成crt证书和key了")])]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("将p12转换成crt证书, 命令如下：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl pkcs12 -in C:\\cert\\server.p12 -nokeys -clcerts -out C:\\cert\\server.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("将p12生成非加密的key, 命令如下：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl pkcs12 -in C:\\cert\\server.p12 -nocerts -nodes -out C:\\cert\\server.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[e("p",[s._v("将证书配置到nginx以后，重启nginx服务器")])]),s._v(" "),e("li",[e("p",[s._v("使用ssl漏洞扫描工具，检验证书链的完整性，并获取证书链(防止小程序报: fail ssl hand shake error)，推荐地址https://myssl.com/chain_download.html")])]),s._v(" "),e("li",[e("p",[s._v("如果证书有漏洞，或不完整，拷贝证书链以后，将服务器上server.crt内容替换，重启nginx(或nginx -s reload)")])]),s._v(" "),e("li",[e("p",[s._v("如果还不行，(比如：网页访问，依然不安全) 请清空缓存，刷新")])])]),s._v(" "),e("h3",{attrs:{id:"练习"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#练习"}},[s._v("#")]),s._v(" 练习")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("λ keytool -importkeystore -srckeystore ./www.ca.com.jks -destkeystore ./www.ca.com.p12 -srcstoretype jks -deststoretype pkcs12\n正在将密钥库 ./www.ca.com.jks 导入到 ./www.ca.com.p12...\n输入目标密钥库口令:\n再次输入新口令:\n输入源密钥库口令:\n已成功导入别名 www.ca.com 的条目。\n已完成导入命令: 1 个条目成功导入, 0 个条目失败或取消\n\n\nλ openssl pkcs12 -in ./www.ca.com.p12 -nokeys -clcerts -out ./www.ca.com.crt\nEnter Import Password:\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"_2-浏览器安装证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-浏览器安装证书"}},[s._v("#")]),s._v(" 2. 浏览器安装证书")]),s._v(" "),e("p",[s._v("必须先安装.pk12 然后安装crt。因为需要双向认证，所以安装了两个证书。")]),s._v(" "),e("p",[s._v("安装方法，双击证书。")]),s._v(" "),e("h3",{attrs:{id:"_2-1-先安装pk12证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-先安装pk12证书"}},[s._v("#")]),s._v(" 2.1 先安装pk12证书")]),s._v(" "),e("p",[s._v("参考手顺：https://blog.csdn.net/onepiecemonkey/article/details/79252050?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_utm_term-6&spm=1001.2101.3001.4242")]),s._v(" "),e("p",[e("img",{attrs:{src:"/docs/images/2021-02-05-13-47-25.png",alt:""}}),s._v("\n输入密码之外都默认。\n"),e("img",{attrs:{src:"/docs/images/2021-02-05-13-47-45.png",alt:""}}),s._v(" "),e("img",{attrs:{src:"/docs/images/2021-02-05-13-48-07.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"_2-2-再安装crt证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-再安装crt证书"}},[s._v("#")]),s._v(" 2.2 再安装crt证书")]),s._v(" "),e("p",[s._v("安装方法于pk12一样。s")])])}),[],!1,null,null,null);t.default=r.exports}}]);