(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{520:function(s,n,a){"use strict";a.r(n);var t=a(59),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"在线在线考试系统总结-v1-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在线在线考试系统总结-v1-0"}},[s._v("#")]),s._v(" 在线在线考试系统总结 V1.0")]),s._v(" "),a("h2",{attrs:{id:"连接开发（测试）环境："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接开发（测试）环境："}},[s._v("#")]),s._v(" 连接开发（测试）环境：")]),s._v(" "),a("ul",[a("li",[s._v("前端：192.168.3.130 ,容器，nginx代理了后端/api/避免跨域问题。\n"),a("ul",[a("li",[s._v("前台代码编译， npm run build")]),s._v(" "),a("li",[s._v("Dockerfile ，把生成的dist/拷贝到nginx镜像的/usr/share/nginx/html/")]),s._v(" "),a("li",[s._v("nginx.conf ，作用有两个：\n"),a("ul",[a("li",[s._v("nginx指定了前端代码在/usr/share/nginx/html/")]),s._v(" "),a("li",[s._v("nginx代理了后端/api/避免跨域问题。 在前台nginx容器里")])])])])]),s._v(" "),a("li",[s._v("后端：192.168.3.130\n"),a("ul",[a("li",[s._v("java容器，执行java -jar命令。")])])]),s._v(" "),a("li",[s._v("DB：192.168.3.130\n"),a("ul",[a("li",[s._v("初始化数据，首次启动会导入初始数据，中间故障重启，会恢复持久化数据而不是重新导入旧的原始数据")])])])]),s._v(" "),a("h2",{attrs:{id:"本番环境："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本番环境："}},[s._v("#")]),s._v(" 本番环境：")]),s._v(" "),a("ul",[a("li",[s._v("https://kaoshi.ccbjb.com.cn\n一个前端+一个后端+一个mysql服务器。")])]),s._v(" "),a("h2",{attrs:{id:"架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[s._v("#")]),s._v(" 架构")]),s._v(" "),a("p",[s._v("前后端分离。vue+springboot+mysql")]),s._v(" "),a("h2",{attrs:{id:"前后端跨域问题解决："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前后端跨域问题解决："}},[s._v("#")]),s._v(" 前后端跨域问题解决：")]),s._v(" "),a("h3",{attrs:{id:"问题："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题："}},[s._v("#")]),s._v(" 问题：")]),s._v(" "),a("p",[s._v("前后端分离部署之后，虽然都是同一台服务器，前台http://192.168.3.130:80 后台 http://192.168.3.130:8099，\n因为端口不同，所以前台发送的请求，后台处理之后，前台接到返回的数据，首先判断数据头，发现端口对不上。\n认为中间有人修改了数据，认为不安全数据，就抛弃掉了。导致，CROS问题。")]),s._v(" "),a("h3",{attrs:{id:"解决："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决："}},[s._v("#")]),s._v(" 解决：")]),s._v(" "),a("ul",[a("li",[s._v("思路：\n一般的解决方法是用nginx来代理前台和后台。这样前台后台对客户来说就不是两个不同的端口了。而是相同端口的不同path。\n例如。后台http://192.168.3.130:8099伪装成http://192.168.3.130:80/api 端口和IP都一样，就不报CROS问题了。\n只需要在nginx配置好代理后端。")]),s._v(" "),a("li",[s._v("具体：\n后端代码不动。 前端代码：")])]),s._v(" "),a("h4",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FROM docker.ccbjb.com.cn/library/nginx\nCOPY dist/ /usr/share/nginx/html/\nCOPY nginx.conf /etc/nginx/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"nginx-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf"}},[s._v("#")]),s._v(" nginx.conf")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('user  root;\nworker_processes  auto;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n\n        include       mime.types;                                                   \n    default_type  application/octet-stream;                                     \n                                                                                \n    #log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'  \n    #                  \'$status $body_bytes_sent "$http_referer" \'              \n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';            \n                                                                                \n    #access_log  logs/access.log  main;                                         \n                                                                                \n    sendfile        on;                                                         \n    #tcp_nopush     on;                                                         \n                                                                                \n    #keepalive_timeout  0;                                                      \n    keepalive_timeout  65;                                                      \n                                                                                \n    #gzip  on;                                                                  \n                                                                                \n    server {                                                                    \n        listen       80;                                                        \n        server_name  localhost;                                                 \n                                                                                \n        #charset koi8-r;                                                        \n                                                                                \n        #access_log  logs/host.access.log  main;                                \n                                                                                \n        location / {                                                            \n            #root   html;                                                       \n            #root   /root/test-system/dist;                                      \n            root   /usr/share/nginx/html;\n            index  index.html index.htm;                                        \n        }                                                                       \n                                                                                \n        location  /api/ {                                                       \n            rewrite ^/api/(.*) /$1 break;                                       \n            proxy_pass  http://192.168.3.130:8099;                              \n        }                                                                       \n    }                                                                             \n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br")])]),a("h4",{attrs:{id:"修改config-prod-env-js-api-root后面追加一个api，这样所有的axios请求后面都会追加一个-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改config-prod-env-js-api-root后面追加一个api，这样所有的axios请求后面都会追加一个-api"}},[s._v("#")]),s._v(" 修改config/prod.env.js,API_ROOT后面追加一个api，这样所有的axios请求后面都会追加一个/api")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("'use strict'\n module.exports = {\n   NODE_ENV: '\"production\"',\n   API_ROOT: '\"http://192.168.3.130/api\"' //前后端分离，解决跨域问题。前后台都经过一个nginx\n   //API_ROOT: '\"http://localhost\"'\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"src-request-api-base-js-没动！"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#src-request-api-base-js-没动！"}},[s._v("#")]),s._v(" src/request/api/base.js 没动！")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/**\n * 接口域名的管理\n */\nconst base = {\n  url: process.env.API_ROOT\n}\n\nexport default base;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"src-request-api-login-js-没动！"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#src-request-api-login-js-没动！"}},[s._v("#")]),s._v(" src/request/api/login.js 没动！")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import base from './base'; // 导入接口域名列表\nimport axios from '../utils/http'; // 导入http中创建的axios实例\n\nconst loginUrl = base.url + '/Login';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("可见以login为例（其他功能也是一样）url都是base.js里的url后拼接真正的功能符号(例如/Login)\n所以，把config/prod.env.js改了，就把所有的url都添加上了api。")]),s._v(" "),a("h3",{attrs:{id:"这还不算完，还得知道下面的内容："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这还不算完，还得知道下面的内容："}},[s._v("#")]),s._v(" 这还不算完，还得知道下面的内容：")]),s._v(" "),a("h4",{attrs:{id:"npm-run-build-理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-run-build-理解"}},[s._v("#")]),s._v(" npm run build 理解")]),s._v(" "),a("ul",[a("li",[s._v("使用的是production环境，我们用这个环境来连接测试（真正本番环境需要修改这个文件），")]),s._v(" "),a("li",[s._v("它调用build/webpack.prod.conf.js,")]),s._v(" "),a("li",[s._v("这个js又调用config/prod.env.js")]),s._v(" "),a("li",[s._v("最终生成了/dist内容")]),s._v(" "),a("li",[s._v("config/index.js里没有启动任何端口的服务。")])]),s._v(" "),a("h4",{attrs:{id:"npm-run-dev-理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-run-dev-理解"}},[s._v("#")]),s._v(" npm run dev 理解")]),s._v(" "),a("ul",[a("li",[s._v("使用的是development环境。用这个来本地开发前台（而不是前后台联调。用这个命令联调需要修改config/dev.env.js里的url为后台真正的url，默认是/static）")]),s._v(" "),a("li",[s._v("它调用build/webpack.dev.conf.js,")]),s._v(" "),a("li",[s._v("这个js又调用config/dev.env.js")]),s._v(" "),a("li",[s._v("config/index.js里把localhost:8080端口启动起来。")])]),s._v(" "),a("h2",{attrs:{id:"以后想本地前后台联调"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以后想本地前后台联调"}},[s._v("#")]),s._v(" 以后想本地前后台联调")]),s._v(" "),a("h3",{attrs:{id:"_1-拷贝dist-到后台的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-拷贝dist-到后台的方式"}},[s._v("#")]),s._v(" 1. 拷贝dist/到后台的方式")]),s._v(" "),a("ul",[a("li",[s._v("本地启动前台和后台")]),s._v(" "),a("li",[s._v("不用修改config/dev.env.js")]),s._v(" "),a("li",[s._v("执行npm run dev")]),s._v(" "),a("li",[s._v("拷贝前台生成的代码到后台/resources/static下")]),s._v(" "),a("li",[s._v("启动后台")])]),s._v(" "),a("h3",{attrs:{id:"_2-前后台分离的方式联调前后台。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-前后台分离的方式联调前后台。"}},[s._v("#")]),s._v(" 2. 前后台分离的方式联调前后台。")]),s._v(" "),a("ul",[a("li",[s._v("修改config/prod.env.js把API_ROOT: '\"http://前台IP/api\"'")]),s._v(" "),a("li",[s._v("前台nginx.conf修改"),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" location / {                                                            \n          root   /usr/share/nginx/html;\n          index  index.html index.htm;                                        \n }                                                                       \n                                                                              \n location  /api/ {                                                       \n          rewrite ^/api/(.*) /$1 break;                                       \n          proxy_pass  http://真正后台IP:真正后台端口; # /api代理后台\n }       \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[s._v("启动前台nginx")]),s._v(" "),a("li",[s._v("启动后台服务")])])])}),[],!1,null,null,null);n.default=e.exports}}]);