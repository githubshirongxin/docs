(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{578:function(s,n,e){"use strict";e.r(n);var t=e(59),a=Object(t.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("::: warnning\n具体使用方法也可以参考：“【nexus】私有仓库使用手顺（最终版）！！”\n:::")]),s._v(" "),e("h2",{attrs:{id:"ssl方式参考这篇文章"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl方式参考这篇文章"}},[s._v("#")]),s._v(" ssl方式参考这篇文章")]),s._v(" "),e("p",[s._v("参考：https://www.cnblogs.com/sanduzxcvbnm/p/13099635.html")]),s._v(" "),e("p",[s._v("nexus3+nginx+代理docker仓库，非常好用。已经搭建好192.168.3.124")]),s._v(" "),e("h3",{attrs:{id:"思路："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#思路："}},[s._v("#")]),s._v(" 思路：")]),s._v(" "),e("p",[s._v("参考：https://www.cnblogs.com/sanduzxcvbnm/p/13099635.html")]),s._v(" "),e("ul",[e("li",[s._v("docker仓库的host仓库、group仓库这两个端口用一个域名来代理。")]),s._v(" "),e("li",[s._v("根据docker cli的method来判断是否是docker pull还是docker push。pull重定向到group仓库，push重定向到host仓库。")]),s._v(" "),e("li",[s._v("nexus web 用另一个域名来代理8081端口。")])]),s._v(" "),e("h3",{attrs:{id:"结论："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结论："}},[s._v("#")]),s._v(" 结论：")]),s._v(" "),e("ul",[e("li",[s._v("root.ca拷贝到客户端的docker目录后，就不需要设置/etc/docker/daemon.json里设置insecure-retistry了。")])]),s._v(" "),e("h3",{attrs:{id:"引申："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#引申："}},[s._v("#")]),s._v(" 引申：")]),s._v(" "),e("ul",[e("li",[s._v("harbor.ccbjb.com.cn的根证书也需要同样拷贝到/etc/docker/certs.d/harobor.ccbjb.com.cn中。这样就不用写insecre-registry了。\ndocker就可以用了。")])]),s._v(" "),e("p",[s._v("可能还可以改进一下：根据客户端使用的代理工具是docker重定向到8081，代理工具是chrome，再判断method是pull 重定向到group，push重定向的host\n不过上面已经非常好了。")]),s._v(" "),e("p",[s._v("我是在192.168.3.124上ngixn ,nexus搭建的\n在192.168.3.125上做的测试。")]),s._v(" "),e("h2",{attrs:{id:"一，3-124具体配置如下："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一，3-124具体配置如下："}},[s._v("#")]),s._v(" 一，3.124具体配置如下：")]),s._v(" "),e("h3",{attrs:{id:"_1-具体安装nexus的过程和配置nexus的docker库过程。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-具体安装nexus的过程和配置nexus的docker库过程。"}},[s._v("#")]),s._v(" 1. 具体安装nexus的过程和配置nexus的docker库过程。")]),s._v(" "),e("p",[s._v("和第一篇文章并没有什么不同，\n参考：【nexus-docker仓库配置使用（一）】nexus作为docker镜像的私服 http方式。\ndocker-private, docker-hub,docker-group并没有什么不同。")]),s._v(" "),e("h3",{attrs:{id:"_2-nginx配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx配置"}},[s._v("#")]),s._v(" 2. nginx配置")]),s._v(" "),e("p",[s._v("nginx与nexus同一台机器。")]),s._v(" "),e("h4",{attrs:{id:"etc-nginx-nginx-conf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#etc-nginx-nginx-conf"}},[s._v("#")]),s._v(" /etc/nginx/nginx.conf")]),s._v(" "),e("p",[s._v("http://nexus.ccbjb.com.cn代理http://192.168.3.124:8081")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[s._v("worker_processes  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(";\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(";\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nhttp "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$time_local"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$request"')]),s._v(" '\n                      '$status $body_bytes_sent "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$http_referer"')]),s._v(" '\n                      '"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$http_user_agent"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$http_x_forwarded_for"')]),s._v("';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    include /etc/nginx/conf.d"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*.conf;\n\n    server {\n        listen 80;\n        server_name nexus.ccbjb.com.cn;\n        location / {\n           proxy_pass  http://192.168.3.124:8081;\n           proxy_redirect  off;\n           proxy_set_header Host $host;\n           proxy_set_header X-Real-IP $remote_addr;\n           proxy_set_header X-Forwarded-For\n           $proxy_add_x_forwarded_for;\n        }\n     }\n}\n")])])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("h4",{attrs:{id:"_3-nginx用的证书生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-nginx用的证书生成"}},[s._v("#")]),s._v(" 3 nginx用的证书生成")]),s._v(" "),e("p",[s._v("https://github.com/Fishdrowned/ssl\n自动生成\n/etc/nginx/conf.d/ssl/out/docker.ccbjb.com.cn/在此目录下。")]),s._v(" "),e("p",[e("code",[s._v("gen.cert.sh docker.ccbjb.com.cn")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos124 ssl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/etc/nginx/conf.d/ssl\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos124 ssl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nca.cnf  docs  flush.sh  gen.cert.sh  gen.root.sh  LICENSE  out  README.md  readme.txt\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos124 ssl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll out/docker.ccbjb.com.cn")]),s._v("\n总用量 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxr-xr-x. "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:21 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20200812")]),s._v("-0921\nlrwxrwxrwx. "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:21 docker.ccbjb.com.cn.bundle.crt -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20200812-0921/docker.ccbjb.com.cn.bundle.crt\nlrwxrwxrwx. "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:21 docker.ccbjb.com.cn.crt -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20200812-0921/docker.ccbjb.com.cn.crt\nlrwxrwxrwx. "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:21 docker.ccbjb.com.cn.key.pem -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cert.key.pem\nlrwxrwxrwx. "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:21 root.crt -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/root.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h4",{attrs:{id:"_4-etc-nginx-conf-d-docker-nexus-conf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-etc-nginx-conf-d-docker-nexus-conf"}},[s._v("#")]),s._v(" 4 /etc/nginx/conf.d/docker.nexus.conf")]),s._v(" "),e("p",[s._v("ssl方式动态代理3.124的8082和8083端口。")]),s._v(" "),e("ul",[e("li",[s._v("8082用来下载")]),s._v(" "),e("li",[s._v("8083用来上传")])]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos124 conf.d"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat docker.nexus.conf\n# ip地址可以换成内网ip\nupstream nexus_docker_get "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.124")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),s._v(";\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nupstream nexus_docker_put "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.124")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8083")]),s._v(";\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n    listen "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl;\n    server_name docker.ccbjb.com.cn;\n    access_log /var/log/nginx/docker.ccbjb.com.cn.log;\n    # 证书\n    ssl_certificate /etc/nginx/conf.d/ssl/out/docker.ccbjb.com.cn/docker.ccbjb.com.cn.crt; # 证书路径根据上面生成的来定\n    ssl_certificate_key /etc/nginx/conf.d/ssl/out/docker.ccbjb.com.cn/docker.ccbjb.com.cn.key.pem;\n    ssl_protocols TLSv1."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" TLSv1."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(";\n    ssl_ciphers '!aNULL"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kECDH+AESGCM"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("ECDH+AESGCM"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("RSA+AESGCM"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kECDH+AES"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("ECDH+AES"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("RSA+AES"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("';\n    ssl_prefer_server_ciphers on;\n    ssl_session_cache shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("SSL"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("10m;\n    # disable any limits to avoid HTTP "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("413")]),s._v(" for large image uploads\n    client_max_body_size "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(";\n    # required to avoid HTTP "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("411")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" see Issue #"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1486")]),s._v(" (https"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//github.com/docker/docker/issues/1486)")]),s._v("\n    chunked_transfer_encoding on;\n    # 设置默认使用推送代理\n    set $upstream "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nexus_docker_put"')]),s._v(";\n    # 当请求是GET，也就是拉取镜像的时候，这里改为拉取代理，如此便解决了拉取和推送的端口统一\n    if ( $request_method ~* 'GET') "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        set $upstream "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nexus_docker_get"')]),s._v(";\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    # 只有本地仓库才支持搜索，所以将搜索请求转发到本地仓库，否则出现"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("报错\n    if ($request_uri ~ '/search') "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        set $upstream "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nexus_docker_put"')]),s._v(";\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    index index.html index.htm index.php;\n    location / "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//$upstream;")]),s._v("\n        proxy_set_header Host $host;\n        proxy_connect_timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(";\n        proxy_send_timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(";\n        proxy_read_timeout "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_buffering off;\n        proxy_request_buffering off;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto http;\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br")])]),e("h3",{attrs:{id:"二，使用docker-pull-push-："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二，使用docker-pull-push-："}},[s._v("#")]),s._v(" 二，使用docker pull push.：")]),s._v(" "),e("h4",{attrs:{id:"_1，客户端配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1，客户端配置"}},[s._v("#")]),s._v(" 1，客户端配置")]),s._v(" "),e("p",[s._v("1.1 无需修改 /etc/docker/daemon.json\n1.2 创建根证书保存目录")]),s._v(" "),e("ul",[e("li",[s._v("linux："),e("code",[s._v("mkdir -p /etc/docker/certs.d/docker.ccbjb.com.cn")])]),s._v(" "),e("li",[s._v("windows：创建目录"),e("code",[s._v("C:\\Program Files\\Docker\\Docker\\certs.d\\docker.ccbjb.com.cn")])])]),s._v(" "),e("p",[s._v("1.3 下载根证书复制到docker根证书目录")]),s._v(" "),e("ul",[e("li",[s._v("下载common工程"),e("code",[s._v("git@gitlab.ccbjb.com.cn:ec7mongrp/common.git")])]),s._v(" "),e("li",[s._v("linux : 拷贝到"),e("code",[s._v("common/docker.ccbjb.com.cnRoot证书/root.crt")]),s._v(" 到"),e("code",[s._v("/etc/docker/certs.d/docker.ccbjb.com.cn/")])]),s._v(" "),e("li",[s._v("windows：拷贝到"),e("code",[s._v("C:\\Program Files\\Docker\\Docker\\certs.d\\docker.ccbjb.com.cn\\root.crt")]),s._v("\n1.4 检查DNS设置为"),e("code",[s._v("192.168.99.2")]),s._v(" ,否则无法识别域名"),e("code",[s._v("docker.ccbjb.com.cn")])])]),s._v(" "),e("h4",{attrs:{id:"_2-客户端使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-客户端使用"}},[s._v("#")]),s._v(" 2. 客户端使用")]),s._v(" "),e("h5",{attrs:{id:"_2-1-必须登陆之后才能下载。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-必须登陆之后才能下载。"}},[s._v("#")]),s._v(" 2.1 必须登陆之后才能下载。")]),s._v(" "),e("p",[s._v("私有docker仓库地址是docker.ccbjb.com.cn\n用户名每个人都不同。初始密码123.com，必须登陆到nexus.ccbjb.com.cn上修改新密码。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("root@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login -u mengxt docker.ccbjb.com.cn")]),s._v("\nPassword:\nWARNING"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your password will be stored unencrypted "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#credentials-store")]),s._v("\nLogin Succeeded\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h5",{attrs:{id:"_2-2-拉取镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-拉取镜像"}},[s._v("#")]),s._v(" 2.2 拉取镜像")]),s._v(" "),e("p",[s._v("如果不确定镜像名，可以到dockerhub.com上搜索，搜到后右上角会有pull命令。\n镜像名前加上docker.ccbjb.com.cn这个域名")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("root@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull docker.ccbjb.com.cn/redis:latest")]),s._v("\nlatest: Pulling from redis\nbf5952930446: Pull complete\n911b8422b695: Pull complete\n093b947e0ade: Pull complete\n5b1d5f59e382: Pull complete\n7a5f59580c0b: Pull complete\nf9c63997c980: Pull complete\nDigest: sha256:09c33840ec47815dc0351f1eca3befe741d7105b3e95bc8fdb9a7e4985b9e1e5\nStatus: Downloaded newer image "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.ccbjb.com.cn/redis:latest\ndocker.ccbjb.com.cn/redis:latest\nroot@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ndocker.ccbjb.com.cn/redis   latest              1319b1eaa0b7        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago          104MB\nalpine                      latest              a24bb4013296        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".57MB\nroot@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h5",{attrs:{id:"_2-3-push镜像到私有仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-push镜像到私有仓库"}},[s._v("#")]),s._v(" 2.3 push镜像到私有仓库")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("root@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker tag alpine:latest docker.ccbjb.com.cn/alpine:latest")]),s._v("\nroot@centos125:~"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker push docker.ccbjb.com.cn/alpine:latest")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("http://nexus.ccbjb.com.cn上可以查看该镜像\n"),e("img",{attrs:{src:"/docs/images/2020-08-12-16-10-34.png",alt:""}})]),s._v(" "),e("h3",{attrs:{id:"三，使用浏览器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三，使用浏览器"}},[s._v("#")]),s._v(" 三，使用浏览器")]),s._v(" "),e("p",[s._v("http://nexus.ccbjb.com.cn")]),s._v(" "),e("p",[s._v("可以看到，nginx代理后的各个库的url也变了。注意修改。\n不过docker的使用，不用库的url，只用到了ip：port，没有影响。")]),s._v(" "),e("p",[s._v("但是npm和maven的时候就受影响了。")])])}),[],!1,null,null,null);n.default=a.exports}}]);