(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{625:function(s,n,a){"use strict";a.r(n);var e=a(59),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一，最先进得方式：使用开源方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一，最先进得方式：使用开源方式"}},[s._v("#")]),s._v(" 一，最先进得方式：使用开源方式")]),s._v(" "),a("p",[s._v("https://github.com/Fishdrowned/ssl")]),s._v(" "),a("p",[s._v("好处，")]),s._v(" "),a("ul",[a("li",[s._v("一步搞定。")]),s._v(" "),a("li",[s._v("有Root.crt供客户端浏览器安装。")])]),s._v(" "),a("p",[s._v("clone 到192.168.3.107")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ssl")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nca.cnf  docs  flush.sh  gen.cert.sh  gen.root.sh  LICENSE  README.md\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./gen.cert.sh harbor.ccbjb.com.cn")]),s._v("\nRemoving "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" out\nCreating output structure\nDone\nGenerating a "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" bit RSA private key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("+++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".+++\nwriting new private key to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'out/root.key.pem'")]),s._v("\n-----\nGenerating RSA private key, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" bit long modulus\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("+++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("+++\ne is "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65537")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x10001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nUsing configuration from ./ca.cnf\nCheck that the request matches the signature\nSignature ok\nThe Subject"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s Distinguished Name is as follows\ncountryName           :PRINTABLE:'")]),s._v("CN"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\nstateOrProvinceName   :ASN.1 12:'")]),s._v("Guangdong"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\nlocalityName          :ASN.1 12:'")]),s._v("Guangzhou"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\norganizationName      :ASN.1 12:'")]),s._v("Fishdrowned"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\norganizationalUnitName:ASN.1 12:'")]),s._v("harbor.ccbjb.com.cn"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\ncommonName            :ASN.1 12:'")]),s._v("*.harbor.ccbjb.com.cn'\nCertificate is to be certified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 01:54:11 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" GMT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("730")]),s._v(" days"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nWrite out database with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" new entries\nData Base Updated\n\nCertificates are located in:\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 09:54 /root/ssl/ssl/out/harbor.ccbjb.com.cn/harbor.ccbjb.com.cn.bundle.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20200805-0954/harbor.ccbjb.com.cn .bundle.crt\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 09:54 /root/ssl/ssl/out/harbor.ccbjb.com.cn/harbor.ccbjb.com.cn.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20200805-0954/harbor.ccbjb.com.cn.crt\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 09:54 /root/ssl/ssl/out/harbor.ccbjb.com.cn/harbor.ccbjb.com.cn.key.pem -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cert.key.pem\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 09:54 /root/ssl/ssl/out/harbor.ccbjb.com.cn/root.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/root.crt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("out/有")]),s._v(" "),a("ul",[a("li",[s._v("harbor.ccbjb.com.cn.bundle.crt")]),s._v(" "),a("li",[s._v("harbor.ccbjb.com.cn.crt")]),s._v(" "),a("li",[s._v("harbor.ccbjb.com.cn.key.pem")]),s._v(" "),a("li",[s._v("root.crt")])]),s._v(" "),a("h5",{attrs:{id:"下载root-crt到客户端，双击。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载root-crt到客户端，双击。"}},[s._v("#")]),s._v(" 下载root.crt到客户端，双击。")]),s._v(" "),a("p",[s._v("为了浏览器能够不提示“不安全，是否继续”")]),s._v(" "),a("p",[s._v("安装根证书：")]),s._v(" "),a("ul",[a("li",[s._v("双击根dao证书文件 弹出证du书属性的对话框，此zhi时该根证书并不受信任，我们dao需要将其加入“版受信任的根证书颁发机权构”")]),s._v(" "),a("li",[s._v("步骤二：点击“安装证书”，弹出证书导入向导")]),s._v(" "),a("li",[s._v("步骤三：点击下一步，选择证书的存储区")]),s._v(" "),a("li",[s._v("步骤四：选择“将所有的证书放入下列存储区”，然后点击下一步，选择证书存储")]),s._v(" "),a("li",[s._v("步骤五：在“选择证书存储”对话框中选择“受信任的根证书颁发机构”，点击确定，此时返回到证书导入向导页面")]),s._v(" "),a("li",[s._v("步骤六：在证书导入向导页面，证书存储变为“受信任的根证书颁发机构”，点击下一步")]),s._v(" "),a("li",[s._v("步骤七：点击“完成”，此时会弹出安全警告 步骤八：点击“是”，安装该证书。此时所有操作完成，成功将根证书加入“受信任的根证书颁发机构”。")])]),s._v(" "),a("h2",{attrs:{id:"二，原始得命令方式："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二，原始得命令方式："}},[s._v("#")]),s._v(" 二，原始得命令方式：")]),s._v(" "),a("p",[s._v("以harbor配置nginx的SSL私有证书为例。")]),s._v(" "),a("h3",{attrs:{id:"签发私有证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#签发私有证书"}},[s._v("#")]),s._v(" 签发私有证书")]),s._v(" "),a("h4",{attrs:{id:"生成私钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成私钥"}},[s._v("#")]),s._v(" 生成私钥")]),s._v(" "),a("p",[s._v("正式生产环境建议使用商业证书！\n使用openssl工具生成一个RSA私钥")]),s._v(" "),a("p",[a("code",[s._v("openssl genrsa -des3 -out harbor1.key 2048")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Generating RSA private key, 2048 bit long modulus\n.......................+++\n......+++\ne is 65537 (0x10001)\nEnter pass phrase for harbor.key:                   # 输入一个至少4位的密码\nVerifying - Enter pass phrase for harbor.key:       # 重复输入密码\n复制代码删除harbor.key中的密码\n# openssl rsa -in harbor.key -out harbor.key\nEnter pass phrase for harbor.key:                 # 输入刚才创建时的密码\nwriting RSA key\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"去掉key的密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#去掉key的密码"}},[s._v("#")]),s._v(" 去掉key的密码")]),s._v(" "),a("p",[a("code",[s._v("openssl rsa -in harbor1.key -out harbor.key")])]),s._v(" "),a("h4",{attrs:{id:"生成csr（证书签名请求）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成csr（证书签名请求）"}},[s._v("#")]),s._v(" 生成CSR（证书签名请求）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# openssl req -new -key harbor.key -out harbor.csr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("You are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:cn             # 国家\nState or Province Name (full name) []:Sichuan    # 地区 \nLocality Name (eg, city) [Default City]:Chengdu  # 城市\nOrganization Name (eg, company) [Default Company Ltd]:akiya  # 组织\nOrganizational Unit Name (eg, section) []:akiya  # 组织单位\nCommon Name (eg, your name or your server's hostname) []:akiya    # 常用名可填自己名字或域名\nEmail Address []:a@b.com                         # 邮件地址\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request      \nA challenge password []:       # 可留空\nAn optional company name []:   # 可留空\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h4",{attrs:{id:"生成自签名证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成自签名证书"}},[s._v("#")]),s._v(" 生成自签名证书")]),s._v(" "),a("p",[s._v("注意：在使用自签名的临时证书时，浏览器会提示证书的颁发机构是未知的。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("echo subjectAltName = IP:192.168.3.120 > extfile.cnf\nopenssl x509 -req -days 365 -in harbor.csr -signkey harbor.key -out harbor.crt -extfile extfile.cnf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Signature ok\nsubject=/C=cn/ST=Sichuan/L=Chengdu/O=akiya/OU=akiya/CN=akiya/emailAddress=a@b.com\nGetting Private key\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"存放证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存放证书"}},[s._v("#")]),s._v(" 存放证书")]),s._v(" "),a("p",[s._v("拷贝到nginx的证书目录 cp harbor.* /etc/nginx/certs/")]),s._v(" "),a("h4",{attrs:{id:"配置证书到nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置证书到nginx"}},[s._v("#")]),s._v(" 配置证书到nginx")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# vim /etc/nginx/nginx.conf\n# 替换 http 上下文的内容\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    proxy_send_timeout 120;\n    proxy_read_timeout 300;\n    proxy_buffering    off;\n    keepalive_timeout  5 5;\n    tcp_nodelay        on;\n    sendfile        on;\n    #tcp_nopush     on;\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n\n\n# vim /etc/nginx/conf.d/harbor.conf\nserver {\n    listen 2222 ssl;\n    server_name harbor.ccbjb.com.cn;\n\n    ssl_certificate /etc/nginx/certs/harbor.crt;\n    ssl_certificate_key /etc/nginx/certs/harbor.key;\n    ssl_session_cache shared:SSL:50m;\n\n    location / {\n        proxy_set_header        Host $host:$server_port;\n        proxy_set_header        X-Real-IP $remote_addr;\n        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header        X-Forwarded-Proto $scheme;\n        proxy_redirect          http:// https://;\n        proxy_pass              http://192.168.3.124:8082;\n        client_max_body_size       1024m;\n        client_body_buffer_size    128k;\n    }\n}\n\nserver {\n    listen 3333 ssl;\n    server_name harbor.ccbjb.com.cn;\n\n    ssl_certificate /etc/nginx/certs/harbor.crt;\n    ssl_certificate_key /etc/nginx/certs/harbor.key;\n    ssl_session_cache shared:SSL:50m;\n\n    location / {\n        proxy_set_header        Host $host:$server_port;\n        proxy_set_header        X-Real-IP $remote_addr;\n        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header        X-Forwarded-Proto $scheme;\n        proxy_redirect          http:// https://;\n        proxy_pass              http://192.168.3.124:8083;\n        client_max_body_size       1024m;\n        client_body_buffer_size    128k;\n    }\n}\n\n\n# 添加 https 配置\n# vim /etc/nginx/conf.d/ssl.conf\nserver {\n    listen   443 ssl;\n    server_name  harbor.ccbjb.com.cn;\n\n    # 允许大文件上传\n    client_max_body_size 1G;\n\n    # 对大于 1G 文件的下载进行优化\n    #proxy_max_temp_file_size 2G;\n\n    #ssl on;\n    ssl_certificate      /etc/nginx/certs/harbor.crt;\n    ssl_certificate_key  /etc/nginx/certs/harbor.key;\n\n    location / {\n        proxy_pass http://192.168.3.124:8081/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto "https";\n    }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br")])]),a("p",[s._v("检查语法错误"),a("br"),s._v(" "),a("code",[s._v("nginx -t")])]),s._v(" "),a("p",[s._v("启动nginx"),a("br"),s._v(" "),a("code",[s._v("systemctl start nginx")])]),s._v(" "),a("p",[s._v("启动出错，查看"),a("code",[s._v("systemctl status nginx")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@centos124 ~]# systemctl start nginx\nJob for nginx.service failed because the control process exited with error code. See "systemctl status nginx.service" and "journalctl -xe" for details.\n[root@centos124 ~]# systemctl status nginx.service\n● nginx.service - nginx - high performance web server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)\n   Active: failed (Result: exit-code) since 二 2020-08-04 14:54:21 CST; 17s ago\n     Docs: http://nginx.org/en/docs/\n  Process: 4812 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=1/FAILURE)\n\n8月 04 14:54:21 centos124 systemd[1]: Starting nginx - high performance web server...\n8月 04 14:54:21 centos124 nginx[4812]: nginx: [emerg] bind() to 0.0.0.0:2222 failed (13: Permission denied)\n8月 04 14:54:21 centos124 systemd[1]: nginx.service: control process exited, code=exited status=1\n8月 04 14:54:21 centos124 systemd[1]: Failed to start nginx - high performance web server.\n8月 04 14:54:21 centos124 systemd[1]: Unit nginx.service entered failed state.\n8月 04 14:54:21 centos124 systemd[1]: nginx.service failed.\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("原因：nginx: [emerg] bind() to 0.0.0.0:2222 failed (13: Permission denied)")])]),s._v(" "),a("li",[a("p",[s._v("解决：\nhttps://blog.csdn.net/RunSnail2018/article/details/81185653\n这篇文章是安装semanage增加允许的tcp端口。")])])]),s._v(" "),a("p",[s._v("而我干脆关闭selinux。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sed -i 's/enforcing/disabled/' /etc/selinux/config\nsetenforce 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("p",[s._v("https://harbor.ccbjb.com.cn")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("502 Bad Gateway\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("nginx配置文件中http://127.0.0.1 修改成http://192.168.3.124")]),s._v(" "),a("p",[a("img",{attrs:{src:"/docs/images/2020-08-04-15-25-47.png",alt:""}})])])}),[],!1,null,null,null);n.default=t.exports}}]);