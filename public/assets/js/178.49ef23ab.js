(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{661:function(s,n,e){"use strict";e.r(n);var t=e(59),a=Object(t.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"typescript-企业级服务器开发：实战篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#typescript-企业级服务器开发：实战篇"}},[s._v("#")]),s._v(" typescript 企业级服务器开发：实战篇")]),s._v(" "),e("h2",{attrs:{id:"nest-初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nest-初始化"}},[s._v("#")]),s._v(" Nest 初始化")]),s._v(" "),e("p",[s._v("我们先在全局安装 nest.js 的 cli，然后初始化我们的项目：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install -g @nestjs/cli\nnest new nest-app\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("我们选择 npm 进行安装：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded070281d3d31?w=505&h=343&f=png&s=87950",alt:"2019-10-21-01-15-54"}})]),s._v(" "),e("p",[s._v("我们安装完毕后打开编辑器，它的目录结构是这样的：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded070282838ce?w=252&h=483&f=png&s=39366",alt:"2019-10-21-01-18-34"}})]),s._v(" "),e("p",[s._v("运行 "),e("code",[s._v("npm start")]),s._v(" 后，在浏览器访问http://localhost:3000/，效果如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07028950d36?w=153&h=112&f=png&s=7374",alt:"2019-10-21-01-20-36"}})]),s._v(" "),e("p",[s._v("那么我们的第一个 Nest.js 程序就启动了。")]),s._v(" "),e("h2",{attrs:{id:"controller"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#controller"}},[s._v("#")]),s._v(" Controller")]),s._v(" "),e("p",[s._v("Controller 控制器，controller 负责处理传入的请求, 并调用对应的 service 完成业务处理，返回对客户端的响应。")]),s._v(" "),e("p",[s._v("我们创建一个新的 controller:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("nest g co books\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("这个命令会产生两个动作：")]),s._v(" "),e("ol",[e("li",[s._v("创建 controller 文件：")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded070288f5390?w=247&h=63&f=png&s=9368",alt:"2019-10-21-01-40-42"}})]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("将新创建的 controller 注册到 module 中去")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07028c79ea1?w=864&h=224&f=png&s=56115",alt:"2019-10-21-01-41-35"}})]),s._v(" "),e("p",[s._v("我们看到生成的 "),e("code",[s._v("books.controller.ts")]),s._v(" 文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Controller } from '@nestjs/common';\n\n@Controller('books')\nexport class BooksController {}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("code",[s._v("@Controller('books')")]),s._v(" 指定了当前路由路径为 "),e("code",[s._v("books")]),s._v("，可见 Nest.js 采用的是分散式路由。")]),s._v(" "),e("p",[s._v("我们对此文件进行改写：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Controller, Get } from '@nestjs/common';\n\n@Controller('books')\nexport class BooksController {\n    @Get('/js')\n    findJavaScript() {\n        return 'JavaScript高级程序设计';\n    }\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("这里引入的 "),e("code",[s._v("Get('/js')")]),s._v(" 代表了 get 方法，针对 "),e("code",[s._v("books/js")]),s._v(" 的路由下进行的处理。")]),s._v(" "),e("p",[s._v("我们现在把服务暂停，选择开发模式再次启动项目:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm run start:dev\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("这个时候我们的每次更改都会触发项目的二次编译，就不用反复运行项目了。")]),s._v(" "),e("p",[s._v("访问 "),e("code",[s._v("http://localhost:3000/books/js")]),s._v(" 路由，我们看到的结果如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07028b2f494?w=187&h=95&f=png&s=9216",alt:"2019-10-21-01-49-29"}})]),s._v(" "),e("p",[s._v("果然，Controller 可以控制处理路由，但是在实际开发中这些返回的数据并不是写死的，我们必须在 Controller 中调用 Service 来获取数据。")]),s._v(" "),e("h2",{attrs:{id:"service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" Service")]),s._v(" "),e("p",[s._v("我们继续用命令行生成 Service:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("nest g s books\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("效果如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07056a93717?w=242&h=112&f=png&s=13496",alt:"2019-10-21-01-54-56"}})]),s._v(" "),e("p",[s._v("我们改写 "),e("code",[s._v("books.service.ts")]),s._v(" 如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class BooksService {\n    getBooks() {\n        return `本书找到了！`;\n    }\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("改写 "),e("code",[s._v("books.controller.ts")]),s._v(" 如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Controller('books')\nexport class BooksController {\n    constructor(private readonly booksService: BooksService) {\n    }\n\n    @Get('/js')\n    findBook() {\n        const res = this.booksService.getBooks();\n\n        return res;\n    }\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("我们在 "),e("code",[s._v("BooksController")]),s._v(" 注入了 "),e("code",[s._v("BooksService")]),s._v("，从而可以在 "),e("code",[s._v("BooksController")]),s._v(" 调用相关的方法 "),e("code",[s._v("this.booksService.getBooks()")]),s._v("，这里就是依赖注入的运用。")]),s._v(" "),e("p",[s._v("但是仅仅有 Service、Controller 也是不够的，我们需要一个持久化储存数据的数据库，通常情况下我们在 Service 与 数据库之间需要加一层 DAO，开发者不应该直接操纵数据库，一方面性能没有保证，另一方面不易维护，这就涉及到了 TypeORM。")]),s._v(" "),e("h2",{attrs:{id:"typeorm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#typeorm"}},[s._v("#")]),s._v(" TypeORM")]),s._v(" "),e("p",[s._v("TypeORM 是一个 ORM 框架，在 Nest.js 架构中充当 DAO 层，我们通过操纵 TypeORM 来间接操纵数据库。")]),s._v(" "),e("p",[s._v("我们先安装相关的库以便在 nest.js 框架中使用：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install --save @nestjs/typeorm typeorm mysql\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("然后我们在 mysql 中新建一个数据库 "),e("code",[s._v("nest")]),s._v(":")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07059cf8e97?w=640&h=662&f=png&s=33588",alt:"2019-10-21-02-26-06"}})]),s._v(" "),e("p",[s._v("我们在 "),e("code",[s._v("app.module.ts")]),s._v(" 配置 "),e("code",[s._v("TypeOrmModule")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { BooksController } from './books/books.controller';\nimport { BooksService } from './books/books.service';\nimport { BooksEntity } from './entities/books.entity';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      keepConnectionAlive: true,\n      type: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: '',\n      database: 'nest',\n      synchronize: true,\n      entities: [BooksEntity],\n    }),\n  ],\n  controllers: [AppController, BooksController],\n  providers: [AppService, BooksService],\n})\nexport class AppModule {}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])]),e("p",[s._v("我们的 "),e("code",[s._v("Entity")]),s._v(" 设置如下 "),e("code",[s._v("entities/books.entity.ts")]),s._v(":")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Entity, PrimaryGeneratedColumn, Column } from 'typeorm';\n\n@Entity('books')\nexport class BooksEntity {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({ length: 20 })\n  name: string;\n\n  @Column({ length: 10 })\n  author: string;\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("成功运行之后，我们的 "),e("code",[s._v("Entity")]),s._v(" 会被映射到数据库中：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded0706b482dc8?w=617&h=171&f=png&s=54572",alt:"2019-10-21-03-15-14"}})]),s._v(" "),e("p",[s._v("接下来我们就可以通过这层 DAO 进行数据库操作了, 在 "),e("code",[s._v("books.service.ts")]),s._v(" 中如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport * as _ from 'lodash';\n\nimport { BooksEntity } from '../entities/books.entity';\nimport { CreateBooksDto } from '../dtos/books.dto';\n\n@Injectable()\nexport class BooksService {\n  constructor(\n    @InjectRepository(BooksEntity)\n    private readonly booksRepository: Repository<BooksEntity>,\n  ) {}\n  async getBooks(id: number) {\n    return await this.booksRepository.findOne(id);\n  }\n\n  async createBooks(book: CreateBooksDto) {\n    const res = await this.booksRepository.save(book);\n\n    return _.pick(res, 'id');\n  }\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("p",[s._v("我们用 "),e("code",[s._v("@InjectRepository()")]),s._v(" 修饰器向 "),e("code",[s._v("BooksService")]),s._v(" 注入 "),e("code",[s._v("booksRepository")]),s._v("，这样我们就可以在 "),e("code",[s._v("BooksService")]),s._v(" 中利用"),e("code",[s._v("this.booksRepository")]),s._v(" 进行 DAO 的操作了，比如查找、删除、创建等等。")]),s._v(" "),e("p",[s._v("我们在 "),e("code",[s._v("books.controller.ts")]),s._v(" 中编辑控制器，至于 HTTP 请求对象的内容，在大多数情况下, 不必手动获取它们。 我们可以使用专用的装饰器，比如 "),e("code",[s._v("@Body()")]),s._v(" 或 "),e("code",[s._v("@Query()")]),s._v(" 来自动获取。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { Controller, Get, Param, Post, Body } from '@nestjs/common';\nimport { BooksService } from './books.service';\nimport { CreateBooksDto } from '../dtos/books.dto';\n\n@Controller('books')\nexport class BooksController {\n  constructor(private readonly booksService: BooksService) {}\n\n  @Get(':id')\n  findBook(@Param('id') id: number) {\n    return this.booksService.getBooks(id);\n  }\n\n  @Post()\n  async create(@Body() createCatDto: CreateBooksDto): Promise<{ id: number }> {\n    return await this.booksService.createBooks(createCatDto);\n  }\n}\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("接下来我们进行一下测试，我们在 PostMan 中进行如下测试：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://xiaomuzhu-image.oss-cn-beijing.aliyuncs.com/0dbc5eaa8156ae71b886fc62f34671e4.png",alt:"2019-10-21-04-21-18"}})]),s._v(" "),e("p",[s._v("我们传入一个 json，包含书名和作者名字，用 post 方法发送，结果如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded0707f1a273a?w=945&h=192&f=png&s=21684",alt:"2019-10-21-04-22-49"}})]),s._v(" "),e("p",[s._v("我们看到了 201 创建成功的状态码，并受到了我们的 book 的 id，再看看数据库是否保存了数据：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded07086b137d5?w=262&h=72&f=png&s=6022",alt:"2019-10-21-04-23-38"}})]),s._v(" "),e("p",[s._v("没问题，我们继续尝试查询 id 为 14 的书籍信息:")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded0709aa3bb92?w=879&h=84&f=png&s=9074",alt:"2019-10-21-04-24-22"}})]),s._v(" "),e("p",[s._v("我们成功查询:")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/10/21/16ded0709adcee82?w=926&h=206&f=png&s=28607",alt:"2019-10-21-04-25-30"}})]),s._v(" "),e("p",[s._v("我们这个简易的服务器搭建算是基本告一段落。")]),s._v(" "),e("h2",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),e("p",[s._v("我们学习了基于 Nest.js 的简易服务器搭建，其分层的思想无处不在：")]),s._v(" "),e("ul",[e("li",[s._v("我们通过 Controller 处理路由请求")]),s._v(" "),e("li",[s._v("通过 Service 进行计算和数据操作")]),s._v(" "),e("li",[s._v("通过 typeorm 生成 dao 层，我们间接操作数据库")])]),s._v(" "),e("p",[s._v("各个层各司其职，通过依赖注入的方式充分解耦，这是企业级服务器开发的基本设计思想。")]),s._v(" "),e("p",[s._v("我已经把完整代码发布到了github "),e("a",{attrs:{href:"https://github.com/xiaomuzhu/nest-app",target:"_blank",rel:"noopener noreferrer"}},[s._v("仓库"),e("OutboundLink")],1),s._v(" 中。")])])}),[],!1,null,null,null);n.default=a.exports}}]);