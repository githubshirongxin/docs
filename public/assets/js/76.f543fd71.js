(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{561:function(e,s,t){"use strict";t.r(s);var a=t(59),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"_1-解决应用程序故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-解决应用程序故障"}},[e._v("#")]),e._v(" 1.解决应用程序故障")]),e._v(" "),t("p",[e._v("Application failure can happen for many reasons, but there are ways within Kubernetes that make it a little easier to discover why. In this lesson, we’ll fix some broken pods and show common methods to troubleshoot.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/docs/images/2020-08-31-17-11-39.png",alt:""}})]),e._v(" "),t("p",[e._v("The YAML for a pod with a termination reason:")]),e._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" pod2\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" busybox\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" main\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" sh\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("c\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" 'echo \"I''ve had enough\" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v(" /var/termination"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("reason ; exit 1'\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("terminationMessagePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /var/termination"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("reason\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br")])]),t("p",[e._v("One of the first steps in troubleshooting is usually to "),t("code",[e._v("describe")]),e._v(" the pod:")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("通过describe pod")]),e._v(" "),t("ul",[t("li",[e._v("查找该pod状态")]),e._v(" "),t("li",[e._v("查找该pod event")])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl describe po pod2\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The YAML for a liveness probe that checks for pod health:")]),e._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liveness\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" linuxacademycontent/candy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" kubeserve\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("livenessProbe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("httpGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /healthz\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("8081")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),t("p",[t("img",{attrs:{src:"/docs/images/2020-08-31-17-15-45.png",alt:""}})])]),e._v(" "),t("p",[e._v("View the logs for additional detail:")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("通过log查找错误")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl logs pod-with-defaults\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("Edit a pod directly (i.e., changing the image):")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("通过直接修改pod的（yaml）")]),e._v(" "),t("ul",[t("li",[e._v("不用输入命令重建，自动就会纠正好pod（自动重建）")]),e._v(" "),t("li",[e._v("这样更简洁，好！推荐。")])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl edit po nginx\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[e._v("有些配置项是edit修改不了的")]),e._v(" "),t("ul",[t("li",[e._v("例如 port")]),e._v(" "),t("li",[e._v("这种情况就只能delete掉pod，改yaml，重建pod。见下面。")])])]),e._v(" "),t("p",[e._v("Export the YAML of a running pod, in the case that you are unable to edit it directly:")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("通过yaml朝朝错误")]),e._v(" "),t("ul",[t("li",[e._v("导出yaml以便重新创建该pod")])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get po pod-with-defaults -o yaml --export > defaults-pod.yaml\n// 修改yaml\nkubectl apply -f defaults-po.yaml //(重建)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("h4",{attrs:{id:"helpful-links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helpful-links"}},[e._v("#")]),e._v(" Helpful Links")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pod Liveness & Readiness Probes"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/determine-reason-pod-failure/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pod Failure Reasons"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Debug the Application"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Troubleshoot Applications"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/",target:"_blank",rel:"noopener noreferrer"}},[e._v("The Pod Lifecycle"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"_2-controlplane-故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-controlplane-故障"}},[e._v("#")]),e._v(" 2.ControlPlane 故障")]),e._v(" "),t("p",[t("img",{attrs:{src:"/docs/images/2020-09-01-09-04-46.png",alt:""}}),e._v("\nKubernetes控制平面是备份和防止故障的重要组件。您可以采取某些最佳做法来确保没有单点故障。如果您的Control Plane组件不能有效地进行通信，则可以检查几件事以确保群集有效运行。")]),e._v(" "),t("p",[e._v("检查"),t("code",[e._v("kube-system")]),e._v("名称空间中的事件是否有错误：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get events -n kube-system\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("从"),t("code",[e._v("kube-system")]),e._v("名称空间中的各个容器中获取日志，并检查是否存在错误：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl logs [kube_scheduler_pod_name] -n kube-system\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("检查Docker服务的状态：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl status docker\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("启动并启用Docker服务，使其在启动时启动：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl enable docker && systemctl start docker\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("检查kubelet服务的状态：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl status kubelet\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("启动并启用kubelet服务，以便在重新引导计算机时启动它：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl enable kubelet && systemctl start kubelet\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("关闭计算机上的交换：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo su - swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("检查防火墙是否正在运行：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl status firewalld\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("禁用防火墙并停止firewalld服务：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo systemctl disable firewalld && systemctl stop firewalld\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h4",{attrs:{id:"有用的网址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#有用的网址"}},[e._v("#")]),e._v(" 有用的网址")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/#a-general-overview-of-cluster-failure-modes",target:"_blank",rel:"noopener noreferrer"}},[e._v("群集故障概述"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/administer-cluster/highly-available-master/",target:"_blank",rel:"noopener noreferrer"}},[e._v("HA master"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"_3-workernode-故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-workernode-故障"}},[e._v("#")]),e._v(" 3.WorkerNode 故障")]),e._v(" "),t("p",[e._v("除了我们可以使用的kubectl工具外，对工作节点故障进行故障排除与对无响应服务器进行故障排除很像。在本课程中，我们将学习如何恢复节点并将其添加回集群，以及如何识别kublet服务何时关闭。")]),e._v(" "),t("p",[t("img",{attrs:{src:"/docs/images/2020-09-01-09-13-38.png",alt:""}})]),e._v(" "),t("p",[e._v("列出节点的状态应该是第一步：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get nodes\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("使用以下命令查找有关节点的更多信息"),t("code",[e._v("kubectl describe")]),e._v("：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl describe nodes chadcrowell2c.mylabserver.com\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("您可以尝试通过SSH登录到服务器：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ssh chadcrowell2c.mylabserver.com\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("获取您的节点的IP地址：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get nodes -o wide\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("使用IP地址进一步探测服务器：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ssh cloud_user@172.31.29.182\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"场景一：worker机器死透，重做系统，重安装worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景一：worker机器死透，重做系统，重安装worker"}},[e._v("#")]),e._v(" 场景一：worker机器死透，重做系统，重安装worker")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),t("p",[e._v("上面发现node机器关机了。\n需要重新创建node机器。\n重新加入到k8s。所以下面，需要到master上生成新的令牌\n启动新服务器后生成新令牌：")])]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kubeadm token generate\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("在master上为新的worker节点创建kubeadm join命令：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo kubeadm token create [token_name] --ttl 2h --print-join-command\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"场景二：worker机器没有死透，仅仅是kubectl没启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景二：worker机器没有死透，仅仅是kubectl没启动服务"}},[e._v("#")]),e._v(" 场景二：worker机器没有死透，仅仅是kubectl没启动服务")]),e._v(" "),t("p",[e._v("在worker上查看journalctl日志：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo journalctl -u kubelet\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("查看系统日志：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo more syslog | tail -120 | grep kubelet\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("发现是服务没有启动，那就启动服务就好")])]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/concepts/architecture/nodes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("节点数"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/explore/explore-intro/#nodes",target:"_blank",rel:"noopener noreferrer"}},[e._v("探索节点"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"_4-网络故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-网络故障"}},[e._v("#")]),e._v(" 4.网络故障")]),e._v(" "),t("p",[e._v("网络问题通常开始在内部或使用服务时出现。在本课程中，我们将通过创建服务并测试集群中的通信，通过多种方法来查看您的应用程序是否正在提供流量。")]),e._v(" "),t("p",[e._v("使用容器端口9376和三个副本运行部署：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl run hostnames --image=k8s.gcr.io/serve_hostname \\\n                        --labels=app=hostnames \\\n                        --port=9376 \\\n                        --replicas=3\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[e._v("列出集群中的服务：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get svc\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("通过暴露部署上的端口来创建服务：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl expose deployment hostnames --port=80 --target-port=9376\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("运行交互式busybox pod：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl run -it --rm --restart=Never busybox --image=busybox:1.28 sh\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("从窗格中，检查DNS是否正在解析主机名：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# nslookup hostnames\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("从Pod中找出"),t("code",[e._v("/etc/resolv.conf")]),e._v("文件：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# cat /etc/resolv.conf\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("在Pod中，查找Kubernetes服务的DNS名称：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# nslookup kubernetes.default\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("获取服务的JSON输出：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get svc hostnames -o json\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("查看服务的端点：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get ep\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("与Pod直接通信（不提供服务）：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("wget -qO- 10.244.1.6:9376\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("检查kube-proxy是否在节点上运行：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ps auxw | grep kube-proxy\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("检查kube-proxy是否正在编写iptables：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("iptables-save | grep hostnames\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("查看"),t("code",[e._v("kube-system")]),e._v("豆荚列表：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get pods -n kube-system\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("连接到"),t("code",[e._v("kube-system")]),e._v("命名空间中的kube-proxy pod ：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl exec -it kube-proxy-cqptg -n kube-system -- sh\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("删除法兰绒CNI插件：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl delete -f https://raw.githubusercontent.com/coreos/flannel/bc79dd1505b0c8681ece4de4c0d86c5cd2643275/Documentation/kube-flannel.yml\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("应用Weave Net CNI插件：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h4",{attrs:{id:"有用的网址-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#有用的网址-2"}},[e._v("#")]),e._v(" 有用的网址")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes中的调试服务"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/",target:"_blank",rel:"noopener noreferrer"}},[e._v("端口转发以访问Pod"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/",target:"_blank",rel:"noopener noreferrer"}},[e._v("故障排除"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#pod-network",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装CNI插件"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"下一步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[e._v("#")]),e._v(" 下一步")]),e._v(" "),t("p",[e._v("Want to continue your Kubernetes learning journey? Here are more great Linux Academy courses!")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/certified-kubernetes-application-developer-ckad",target:"_blank",rel:"noopener noreferrer"}},[e._v("Certified Kubernetes Application Developer"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/kubernetes-the-hard-way",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes the Hard Way"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/google-kubernetes-engine-deep-dive",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Kubernetes Engine Deep Dive"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/amazon-eks-deep-dive",target:"_blank",rel:"noopener noreferrer"}},[e._v("Amazon EKS Deep Dive"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/kubernetes-and-prometheus",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monitoring Kubernetes with Prometheus"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/linux/training/course/name/docker-certified-associate-prep-course",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Certified Associate Prep Course"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://linuxacademy.com/devops/training/course/name/introduction-to-docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Deep Dive"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("Exceeded my Expectations")]),e._v(" "),t("p",[e._v("Room for Improvement")]),e._v(" "),t("p",[t("a",{attrs:{href:"/cp/courses/lesson/course/4025/lesson/2"}},[e._v("View Previous Lesson")])]),e._v(" "),t("p",[e._v("Complete Section & Return to Course Module")])])}),[],!1,null,null,null);s.default=n.exports}}]);