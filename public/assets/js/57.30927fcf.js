(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{541:function(s,a,t){"use strict";t.r(a);var n=t(59),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"这是没有使用docker-ccbjb-com-cn（ssl）的使用方式。还不成熟。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#这是没有使用docker-ccbjb-com-cn（ssl）的使用方式。还不成熟。"}},[s._v("#")]),s._v(" 这是没有使用docker.ccbjb.com.cn（ssl）的使用方式。还不成熟。")]),s._v(" "),t("p",[s._v("成熟的方案，请参考【gitlab-runner + nexus】加速docker和npm下载 （二）nginx代理docker库ssl")]),s._v(" "),t("h3",{attrs:{id:"先让runner从私服上下载吧。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#先让runner从私服上下载吧。"}},[s._v("#")]),s._v(" 先让runner从私服上下载吧。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload && systemctl restart docker.service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login 192.168.3.124:8083")]),s._v("\nUsername: admin\nPassword:\nLogin Succeeded\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos3 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login 192.168.3.124:8082")]),s._v("\nUsername: admin\nPassword:\nLogin Succeeded\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"项目中gitlab-ci-yml修改配置从私有仓库中下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目中gitlab-ci-yml修改配置从私有仓库中下载"}},[s._v("#")]),s._v(" 项目中gitlab-ci.yml修改配置从私有仓库中下载")]),s._v(" "),t("p",[s._v("//gitlab-ci.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.124"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8082/node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_modules/\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" yarn install\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" yarn run build \n \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" public\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("img",{attrs:{src:"/docs/images/2020-08-08-09-20-47.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Running with gitlab-runner "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.2")]),s._v(".1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("efa30e33"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   on shared runner form "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.112")]),s._v(" Unz4U-uF\nPreparing the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v(" executor\n00:11\n Using Docker executor with image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Pulling docker image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("docker.go:131:0s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("3.112")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" docker-compose.yml\n增加 -v /etc/docker/daemon.json:/etc/docker/daemon.json\n\ndocker-compose down\ndocker-compose up -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("hr"),s._v(" "),t("p",[s._v("参考:https://blog.csdn.net/renguiriyue/article/details/102769884")]),s._v(" "),t("h2",{attrs:{id:"【问题现象】gitlab-runner-docker-images-based-on-ubuntu-or-alpine-linux-，安装docker时候出错。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#【问题现象】gitlab-runner-docker-images-based-on-ubuntu-or-alpine-linux-，安装docker时候出错。"}},[s._v("#")]),s._v(" 【问题现象】GitLab Runner Docker images (based on Ubuntu or Alpine Linux)，安装docker时候出错。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Creating config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/apt/apt.conf.d/50unattended-upgrades with new version\nSetting up python3-software-properties "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.96")]),s._v(".20.9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSetting up software-properties-common "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.96")]),s._v(".20.9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" libc-bin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.27")]),s._v("-3ubuntu1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" sgml-base "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.26")]),s._v("+nmu4ubuntu1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nProcessing triggers "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" dbus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),s._v(".6-1ubuntu3.6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nE: gnupg, gnupg2 and gnupg1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not seem to be installed, but one of them is required "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this operation\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed writing body\nThe "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/bin/sh -c dpkg --configure -a &&     apt-get install -y apt-transport-https ca-certificates curl software-properties-common &&\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&     add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" stable\" &&     apt-get update -y &&     apt-get install -y docker-ce'")]),s._v(" returned a non-zero code: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos112 enviroment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"解决："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决："}},[s._v("#")]),s._v(" 解决：")]),s._v(" "),t("h3",{attrs:{id:"识别操作系统的方法："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#识别操作系统的方法："}},[s._v("#")]),s._v(" 识别操作系统的方法：")]),s._v(" "),t("p",[s._v("https://blog.csdn.net/Dafei4/article/details/79589369/")]),s._v(" "),t("h3",{attrs:{id:"识别操作系统的操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#识别操作系统的操作"}},[s._v("#")]),s._v(" 识别操作系统的操作")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@def6fbc9a09a:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc")]),s._v("\nroot@def6fbc9a09a:/etc"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls red*")]),s._v("\nls: cannot access "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red*'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" No such "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nroot@def6fbc9a09a:/etc"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls issue")]),s._v("\nissue\nroot@def6fbc9a09a:/etc"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat issue")]),s._v("\nUbuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v(".4 LTS "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("l\n\n// gitlab Runner的系统名字\nlsb_release -cs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" **bionic**\n\nhttps://download.docker.com/linux/ubuntu \nIndex of linux/ubuntu/dists/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\nartful/\nbionic/\ncosmic/\ndisco/\neoan/\nfocal/\ntrusty/\nxenial/\nyakkety/\nzesty/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("所以使用库的时候，必须指定bionic")]),s._v(" "),t("p",[s._v("原来博文中的史xenial，而我下载的gitlabrunner使用的史bionic")])]),s._v(" "),t("h3",{attrs:{id:"修改软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改软件源"}},[s._v("#")]),s._v(" 修改软件源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改软件源")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("// 完整Dockerfile如下，安装好docker，docker-compose，java，maven")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("MAINTAINER shirongxin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("shirx@ccbjb.com.cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改软件源")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apt/sources.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" apt-transport-https ca-certificates "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" software-properties-common "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" apt-key "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    add-apt-repository "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu '),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' stable"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN apt-get update && apt-get install -y gnupg2 && \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    dpkg --configure -a && \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get install -y apt-transport-https ca-certificates curl software-properties-common && \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -no-tty - && \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" && \\')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get update -y && \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    apt-get install -y docker-ce")]),s._v("\nCOPY daemon.json /etc/docker/daemon.json\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Docker Compose（这边的链接会失效的，所以还需要自己到docker-compose 确认）")]),s._v("\nWORKDIR /usr/local/bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://raw.githubusercontent.com/topsale/resources/master/docker-compose")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/docker/compose/releases/download/1.26.1/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v("  -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-composeRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 java")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/java\nWORKDIR /usr/local/java\nCOPY openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz /usr/local/java\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     rm -fr openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Maven")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/maven\nWORKDIR /usr/local/maven\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://raw.githubusercontent.com/topsale/resources/master/maven/apache-maven-3.5.3-bin.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz")]),s._v("\nCOPY apache-maven-3.6.3-bin.tar.gz /usr/local/maven\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf apache-maven-3.6.3-bin.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    rm -fr apache-maven-3.6.3-bin.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备一份maven 配置好的文件，这里参考 nexus 配置")]),s._v("\nCOPY settings.xml /usr/local/maven/apache-maven-3.6.3/conf/settings.xml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置环境变量")]),s._v("\nENV JAVA_HOME /usr/local/java/java-se-8u41-ri\nENV MAVEN_HOME /usr/local/maven/apache-maven-3.6.3\nENV "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAVEN_HOME")]),s._v("/bin\n\nWORKDIR /\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker-compose up -d\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it gitlab_runner /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"runner-error"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#runner-error"}},[s._v("#")]),s._v(" Runner error:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Preparing the "docker" executor\n Using Docker executor with image 192.168.3.124:8082/node:latest ...\n Pulling docker image 192.168.3.124:8082/node:latest ...\n ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials (docker.go:131:0s)\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Runner里需要先docker login 192.158.3.124:8082\n试试\n果然，更新vuepress，自动编译了。好用了")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Running with gitlab-runner "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.2")]),s._v(".1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("efa30e33"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   on shared runner form "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.112")]),s._v(" Unz4U-uF\nPreparing the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v(" executor\n Using Docker executor with image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Authenticating with credentials from /root/.docker/config.json\n Pulling docker image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Using docker image sha256:002df0b34ccb8b3bcaf022b8fea4e6b5cce1bc811fbd33d38840cdc21ee5f931 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.124:8082/node:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nPreparing environment\n00:00\n Running on runner-unz4u-uf-project-11-concurrent-0 via b2fd1f150f12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nGetting "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" from Git repository\n00:03\n Fetching changes with "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" depth "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Reinitialized existing Git repository "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /builds/shirongxin/docs/.git/\n Checking out 5c0d0b1e as master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Removing node_modules/\n Removing public/\n Skipping Git submodules setup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("试试把nexus上的node删掉，看看nexus是否能自动下载")]),s._v(" "),t("p",[s._v("NEXUS上node镜像下来了。编译时间1m3s")]),s._v(" "),t("p",[s._v("这个基础，再次更新vuepress，看看编译时间。1m2s，也是这个时间。")]),s._v(" "),t("p",[s._v("纳闷了。不用本地库呢？")]),s._v(" "),t("p",[s._v("gitlab-ci.yml使用远程库。看看，编译时间1m10s，没差多少。")]),s._v(" "),t("p",[s._v("难道是应为runner走的都是nexus？")]),s._v(" "),t("p",[s._v("把runner")]),s._v(" "),t("p",[s._v("不使用runner、随便3.125上命令行测试docker pull node 1m\n// 3.124上还没有node\ndocker pull 192.168.3.124:8082/node  1m20s\n// 3.123已经有node的前提下\ndocker pull 192.168.3.124:8082/node  15s ， 比外网下载快多了啊。")]),s._v(" "),t("p",[s._v("那么，为什么runner上用不用私服差别不大呢？\n另外，gitlab-ci.yml中使用image: 192.168.3.124:8082/node:latest开头，应该不对。正确做法应该让gitlabci对nexus无意识，旨在runner上配置。")]),s._v(" "),t("h2",{attrs:{id:"阿里云镜像也不快，还不如不用。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里云镜像也不快，还不如不用。"}},[s._v("#")]),s._v(" 阿里云镜像也不快，还不如不用。")]),s._v(" "),t("h3",{attrs:{id:"另外，不用阿里云镜像呢-1m5s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#另外，不用阿里云镜像呢-1m5s"}},[s._v("#")]),s._v(" // 另外，不用阿里云镜像呢 , 1m5s")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n // "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ji1i86y7.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"使用阿里云镜像呢-1m25s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用阿里云镜像呢-1m25s"}},[s._v("#")]),s._v(" //使用阿里云镜像呢 ,1m25s.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ji1i86y7.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"使用192-168-3-124：8082做镜像呢？-59s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用192-168-3-124：8082做镜像呢？-59s"}},[s._v("#")]),s._v(" //使用192.168.3.124：8082做镜像呢？ 59s")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.3.124:8082"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"harbor.ccbjb.com.cn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8082"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.124:8083"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nroot@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull node")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"使用私服上已经有node-15s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用私服上已经有node-15s"}},[s._v("#")]),s._v(" //使用私服上已经有node 15s")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@centos125:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull 192.168.3.124:8082/node")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"如何让docker-pull-自动去找私服，而不用写打私服的tag呢？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何让docker-pull-自动去找私服，而不用写打私服的tag呢？"}},[s._v("#")]),s._v(" 如何让docker pull 自动去找私服，而不用写打私服的tag呢？")]),s._v(" "),t("h3",{attrs:{id:"尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在"}},[s._v("#")]),s._v(" 尝试：registry-mirrors:设置成私库地址，docker pull srximg // srximg只在私库上存在")]),s._v(" "),t("p",[s._v("结果：找不到，出错。\n分析：daemon.json里配置的registry-mirrors对“docker pull 不加私服ip”这样的命令不起作用。\n结论：想让"),t("code",[s._v("docker pull 不加私服ip")]),s._v(" 这样的命令主动去私服下载，别指望daemon.json.")])])}),[],!1,null,null,null);a.default=e.exports}}]);