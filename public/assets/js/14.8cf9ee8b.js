(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{425:function(s,a,e){"use strict";e.r(a);var n=e(48),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("共享存储，NFS以及DB仍旧有单点故障。Nginx也有单点故障。以后：DB可以做成集群。nginx可以做成主从。NFS换成ceph。")]),s._v(" "),e("p",[s._v("感谢原作者akiya的分享。这篇文章写得已经算是不错了。至少给了一个尝试的方案。我略加整理，并解决了一下小Bug。亲测可以push。\nhttps://juejin.im/post/5d973e246fb9a04dfa0963fb")]),s._v(" "),e("p",[s._v("下面是思路：\nnginx负责负载均衡，nginx提供https。\nnginx后面的两个harobr使用http服务。\n网页访问的时候访问最前端的nginx。\n客户端需要docker的daemon.json中加入最前端nginx的domain。")]),s._v(" "),e("p",[e("img",{attrs:{src:"/docs/images/2020-07-16-10-50-44.png",alt:""}})]),s._v(" "),e("p",[s._v("如果最终生产环境集群中服务器较多，依赖做完LB的Harbor也无法完全达到需求时，可以使用如下架构，部署下级Harbor节点从主节点同步镜像，然后再分发给生产服务器。\n"),e("img",{attrs:{src:"/docs/images/2020-07-16-10-51-12.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("IP")]),s._v(" "),e("th",[s._v("用途")]),s._v(" "),e("th",[s._v("安装的服务")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("192.168.3.120")]),s._v(" "),e("td",[s._v("NFS服务器，Nginx服务器，Harbor存储层")]),s._v(" "),e("td",[s._v("NFS、Redis、PostgressSQL、Nginx、Docker、docker-compose")])]),s._v(" "),e("tr",[e("td",[s._v("192.168.3.108")]),s._v(" "),e("td",[s._v("Harbor无状态节点")]),s._v(" "),e("td",[s._v("docker、docker-compose、harbor（http方式）")])]),s._v(" "),e("tr",[e("td",[s._v("192.168.3.109")]),s._v(" "),e("td",[s._v("Harbor无状态节点")]),s._v(" "),e("td",[s._v("docker、docker-compose、harbor（http方式）")])])])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("软件")]),s._v(" "),e("th",[s._v("版本")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Docker")]),s._v(" "),e("td",[s._v("19.06.3-ce")])]),s._v(" "),e("tr",[e("td",[s._v("docker-compose")]),s._v(" "),e("td",[s._v("1.25.0-rc2")])]),s._v(" "),e("tr",[e("td",[s._v("Harbor")]),s._v(" "),e("td",[s._v("1.10.0")])]),s._v(" "),e("tr",[e("td",[s._v("Nginx")]),s._v(" "),e("td",[s._v("1.16.1")])]),s._v(" "),e("tr",[e("td",[s._v("PostgreSQL")]),s._v(" "),e("td",[s._v("9.6.14")])]),s._v(" "),e("tr",[e("td",[s._v("Redis")]),s._v(" "),e("td",[s._v("4.0.14")])])])]),s._v(" "),e("p",[s._v("版本的确定，首先你下载一个Harbor，然后用下面方法确认好redis，postgress的版本。")]),s._v(" "),e("h2",{attrs:{id:"_1-192-168-3-120-部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-192-168-3-120-部署"}},[s._v("#")]),s._v(" 1. 192.168.3.120 部署")]),s._v(" "),e("p",[s._v("上安装registry、clair、notarysigner、notaryserver、Redis、NFS、证书")]),s._v(" "),e("h3",{attrs:{id:"怎么查看harbor用的redis版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么查看harbor用的redis版本"}},[s._v("#")]),s._v(" 怎么查看harbor用的redis版本")]),s._v(" "),e("p",[e("code",[s._v("docker exec -it redis /bin/bash")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("redis [ ~ ]$ redis-server --version\nRedis server v=4.0.14 sha=00000000:0 malloc=jemalloc-4.0.3 bits=64 build=1e2a11bfe971a20a\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"怎么查看harbor用的postgress版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么查看harbor用的postgress版本"}},[s._v("#")]),s._v(" 怎么查看harbor用的postgress版本")]),s._v(" "),e("p",[e("code",[s._v("docker exec -it harbor-db /bin/bash")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('postgres [ / ]$ psql\npsql (9.6.14)\nType "help" for help.\n\npostgres=# select version();\n PostgreSQL 9.6.14 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 6.3.0, 64-bit\n(1 row)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_1-1-签发私有证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-签发私有证书"}},[s._v("#")]),s._v(" 1.1 签发私有证书")]),s._v(" "),e("h4",{attrs:{id:"生成私钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成私钥"}},[s._v("#")]),s._v(" 生成私钥")]),s._v(" "),e("h4",{attrs:{id:"正式生产环境建议使用商业证书！"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#正式生产环境建议使用商业证书！"}},[s._v("#")]),s._v(" 正式生产环境建议使用商业证书！")]),s._v(" "),e("h5",{attrs:{id:"使用openssl工具生成一个rsa私钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用openssl工具生成一个rsa私钥"}},[s._v("#")]),s._v(" 使用openssl工具生成一个RSA私钥")]),s._v(" "),e("p",[e("code",[s._v("# openssl genrsa -des3 -out harbor1.key 2048")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Generating RSA private key, 2048 bit long modulus\n.......................+++\n......+++\ne is 65537 (0x10001)\nEnter pass phrase for harbor.key:                   # 输入一个至少4位的密码\nVerifying - Enter pass phrase for harbor.key:       # 重复输入密码\n复制代码删除harbor.key中的密码\n# openssl rsa -in harbor.key -out harbor.key\nEnter pass phrase for harbor.key:                 # 输入刚才创建时的密码\nwriting RSA key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h5",{attrs:{id:"去掉key的密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#去掉key的密码"}},[s._v("#")]),s._v(" 去掉key的密码")]),s._v(" "),e("p",[e("code",[s._v("openssl rsa -in harbor1.key -out harbor.key")])]),s._v(" "),e("h5",{attrs:{id:"生成csr（证书签名请求）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成csr（证书签名请求）"}},[s._v("#")]),s._v(" 生成CSR（证书签名请求）")]),s._v(" "),e("p",[e("code",[s._v("# openssl req -new -key harbor.key -out harbor.csr")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("You are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:cn             # 国家\nState or Province Name (full name) []:Sichuan    # 地区 \nLocality Name (eg, city) [Default City]:Chengdu  # 城市\nOrganization Name (eg, company) [Default Company Ltd]:akiya  # 组织\nOrganizational Unit Name (eg, section) []:akiya  # 组织单位\nCommon Name (eg, your name or your server's hostname) []:akiya    # 常用名可填自己名字或域名\nEmail Address []:a@b.com                         # 邮件地址\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request      \nA challenge password []:       # 可留空\nAn optional company name []:   # 可留空\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h5",{attrs:{id:"生成自签名证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成自签名证书"}},[s._v("#")]),s._v(" 生成自签名证书")]),s._v(" "),e("p",[s._v("注意：在使用自签名的临时证书时，浏览器会提示证书的颁发机构是未知的。\n"),e("code",[s._v("# echo subjectAltName = IP:192.168.3.120 > extfile.cnf")])]),s._v(" "),e("p",[e("code",[s._v("# openssl x509 -req -days 365 -in harbor.csr -signkey harbor.key -out harbor.crt -extfile extfile.cnf")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Signature ok\nsubject=/C=cn/ST=Sichuan/L=Chengdu/O=akiya/OU=akiya/CN=akiya/emailAddress=a@b.com\nGetting Private key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"存放证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#存放证书"}},[s._v("#")]),s._v(" 存放证书")]),s._v(" "),e("p",[s._v("复制证书到/www/certs待用\n"),e("code",[s._v("# mkdir -p /www/certs && cp harbor.crt harbor.key /www/certs")]),s._v("\n拷贝到nginx的证书目录\n"),e("code",[s._v("cp /www/certs/* /etc/nginx/certs/")])]),s._v(" "),e("h2",{attrs:{id:"_1-2-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker"}},[s._v("#")]),s._v(" 1.2 Docker")]),s._v(" "),e("h5",{attrs:{id:"官方一键脚本安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#官方一键脚本安装"}},[s._v("#")]),s._v(" 官方一键脚本安装")]),s._v(" "),e("p",[e("code",[s._v("# curl -sSL https://get.docker.com/ | sh")])]),s._v(" "),e("h5",{attrs:{id:"先安装必要的依赖环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先安装必要的依赖环境"}},[s._v("#")]),s._v(" 先安装必要的依赖环境")]),s._v(" "),e("p",[e("code",[s._v("# yum -y install yum-utils device-mapper-persistent-data lvm2")])]),s._v(" "),e("h5",{attrs:{id:"添加软件源信息使用阿里云源安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加软件源信息使用阿里云源安装"}},[s._v("#")]),s._v(" 添加软件源信息使用阿里云源安装")]),s._v(" "),e("p",[e("code",[s._v("# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")])]),s._v(" "),e("h5",{attrs:{id:"更新缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新缓存"}},[s._v("#")]),s._v(" 更新缓存")]),s._v(" "),e("p",[e("code",[s._v("# yum makecache fast")])]),s._v(" "),e("h5",{attrs:{id:"安装docker或安装指定版本docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker或安装指定版本docker"}},[s._v("#")]),s._v(" 安装Docker或安装指定版本Docker")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# yum -y install docker\n# yum -y install docker-ce-18.06.3.ce-3.el7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"查看docker版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看docker版本"}},[s._v("#")]),s._v(" 查看Docker版本")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker --version\nDocker version 18.06.3-ce, build d7080c1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"修改docker仓库为国内镜像站"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改docker仓库为国内镜像站"}},[s._v("#")]),s._v(" 修改Docker仓库为国内镜像站")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"启动docker服务并添加至开机自启"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动docker服务并添加至开机自启"}},[s._v("#")]),s._v(" 启动Docker服务并添加至开机自启")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# systemctl start docker\n# systemctl enable docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_1-3-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-compose"}},[s._v("#")]),s._v(" 1.3 Compose")]),s._v(" "),e("p",[s._v("compose是Docker提供的一个命令行工具，用来定义和运行由多个容器组成的应用。使用compose，我们可以通过YAML文件声明式的定义应用程序的各个服务，并由单个命令完成应用的创建和启动。\n由于国内政策原因，可能在海外网站上下载文件速度较慢，建议下载本地后上传至服务器")]),s._v(" "),e("h5",{attrs:{id:"下载docker-compose并赋予可执行权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载docker-compose并赋予可执行权限"}},[s._v("#")]),s._v(" 下载docker-compose并赋予可执行权限")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# curl -L https://github.com/docker/compose/releases/download/1.25.0-rc2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose\n\n# chmod +x /usr/local/bin/docker-compose\n\n//查看compose本地版本\n# docker-compose -v\n\ndocker-compose version 1.25.0-rc2, build 661ac20e\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"_1-4-四个服务的安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-四个服务的安装"}},[s._v("#")]),s._v(" 1.4 四个服务的安装")]),s._v(" "),e("p",[s._v("由于Harbor v1.9.0使用的是PostgreSQL，我们也同样独立部署一套PostgreSQL与Redis，此次演示使用Docker部署，实际生产环境按需要选择是否部署至宿主机。")]),s._v(" "),e("h5",{attrs:{id:"postgresql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[s._v("#")]),s._v(" PostgreSQL")]),s._v(" "),e("p",[s._v("通过查看已安装的Harbor v1.9.0单机版中运行的harbor-db容器可得知此次运行的PostgreSQL版本为9.6.14")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# docker exec -it harbor-db /bin/bash\npostgres [ / ]$ psql\npsql (9.6.14)\nType "help" for help.\n\npostgres=# select version();\n                                    version\n-------------------------------------------------------------------------------\n PostgreSQL 9.6.14 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 6.3.0, 64-bit\n(1 row)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h5",{attrs:{id:"redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")]),s._v(" "),e("p",[s._v("根据官方文档描述，使用Redis需要4.0.10-1.ph2版本。同样，此次我们为了演示也使用docker-compose来部署。")]),s._v(" "),e("h5",{attrs:{id:"yaml脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yaml脚本"}},[s._v("#")]),s._v(" yaml脚本")]),s._v(" "),e("p",[s._v("那么我们使用同一版本的PostgreSQL与Redis，编写docker-compose.yml 内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# author:akiya\nversion: "3"\n\nnetworks:\n  harbor:\n    driver: bridge\n\nservices:\n  registry:\n    image: postgres:9.6.14\n    container_name: harbor-registry\n    restart: always\n    environment:\n      POSTGRES_DB: registry\n      POSTGRES_PASSWORD: root123\n    volumes:\n      - $PWD/postgres/registry:/var/lib/postgresql/data\n    networks:\n      - harbor\n    ports:\n      - 20010:5432\n  clair:\n    image: postgres:9.6.14\n    container_name: harbor-clair\n    restart: always\n    environment:\n      POSTGRES_DB: clair\n      POSTGRES_PASSWORD: root123\n    volumes:\n      - $PWD/postgres/clair:/var/lib/postgresql/data\n    networks:\n      - harbor\n    ports:\n      - 20011:5432\n  notarysigner:\n    image: postgres:9.6.14\n    container_name: harbor-notarysigner\n    restart: always\n    environment:\n      POSTGRES_DB: notarysigner\n      POSTGRES_PASSWORD: root123\n    volumes:\n      - $PWD/postgres/notarysigner:/var/lib/postgresql/data\n    networks:\n      - harbor\n    ports:\n      - 20012:5432\n  notaryserver:\n    image: postgres:9.6.14\n    container_name: harbor-notaryserver\n    restart: always\n    environment:\n      POSTGRES_DB: notaryserver\n      POSTGRES_PASSWORD: root123\n    volumes:\n      - $PWD/postgres/notaryserver:/var/lib/postgresql/data\n    networks:\n      - harbor\n    ports:\n      - 20013:5432\n  Redis:\n    image: redis:4.0.10\n    container_name: harbor-redis\n    command: redis-server /usr/local/etc/redis/redis.conf\n    restart: always\n    volumes:\n      - $PWD/redis/data:/data\n      - $PWD/redis/redis.conf:/usr/local/etc/redis/redis.conf\n    networks:\n      - harbor\n    ports:\n      - 20000:6379\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br")])]),e("p",[s._v("保存后我们用"),e("code",[s._v("docker-compose up -d")]),s._v("命令启动相应的容器.\n并在防火墙中开放对应的端口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker-compose up -d\n# firewall-cmd --zone=public --permanent --add-port=20000/tcp\n# firewall-cmd --zone=public --permanent --add-port=20010/tcp\n# firewall-cmd --zone=public --permanent --add-port=20011/tcp\n# firewall-cmd --zone=public --permanent --add-port=20012/tcp\n# firewall-cmd --zone=public --permanent --add-port=20013/tcp\n# firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("blockquote",[e("p",[s._v("我一般推荐关闭防火墙。在内网里面开启防火墙没有任何意义。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\nsed -i 's/enforcing/disabled/' /etc/selinux/config\nsetenforce 0\nsystemctl stop NetworkManager\nsystemctl disable NetworkManager\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h5",{attrs:{id:"troubleshooting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[s._v("#")]),s._v(" TroubleShooting")]),s._v(" "),e("h6",{attrs:{id:"error"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#error"}},[s._v("#")]),s._v(" Error:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ERROR: Failed to Setup IP tables: Unable to enable SKIP DNAT rule:  (iptables failed: iptables --wait -t nat -I DOCKER -i br-02aaea983fab -j RETURN: iptables: No chain/target/match by that name.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("解决：")]),s._v(" "),e("ul",[e("li",[s._v("1.查看nginx日志/var/log/nginx/access.log")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('2020/08/04 12:04:29 [emerg] 24778#24778: cannot load certificate key "/etc/nginx/certs/harbor.key": PEM_read_bio_PrivateKey() failed (SSL: error:0906406D:PEM routines:PEM_def_callback:problems getting password error:0906A068:PEM routines:PEM_do_header:bad password read)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("原来是，自己的密钥忘了去掉密码了。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl rsa -in harbor1.key -out harbor.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("2.另外，3.108和3.109的防火墙允许80端口，或者干脆关闭两台机器的防火墙。")])]),s._v(" "),e("h2",{attrs:{id:"_1-5-nfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-nfs"}},[s._v("#")]),s._v(" 1.5 NFS")]),s._v(" "),e("h3",{attrs:{id:"_1-5-1-服务端-192-168-3-120"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-服务端-192-168-3-120"}},[s._v("#")]),s._v(" 1.5.1 服务端 192.168.3.120")]),s._v(" "),e("h5",{attrs:{id:"创建nfs共享文件路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建nfs共享文件路径"}},[s._v("#")]),s._v(" 创建NFS共享文件路径")]),s._v(" "),e("p",[e("code",[s._v("# mkdir -p /data")])]),s._v(" "),e("h5",{attrs:{id:"安装nfs（在安装完nfs-utils后，rpcbind默认是启动了的）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nfs（在安装完nfs-utils后，rpcbind默认是启动了的）"}},[s._v("#")]),s._v(" 安装NFS（在安装完nfs-utils后，rpcbind默认是启动了的）")]),s._v(" "),e("p",[e("code",[s._v("sudo yum -y install nfs-utils")])]),s._v(" "),e("h5",{attrs:{id:"启动nfs相关服务并设置开机启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动nfs相关服务并设置开机启动"}},[s._v("#")]),s._v(" 启动NFS相关服务并设置开机启动")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl start rpcbind\nsystemctl enable rpcbind\nsystemctl start nfs-server\nsystemctl enable nfs-server\nsystemctl start nfs-lock\nsystemctl enable nfs-lock\nsystemctl start nfs-idmap\nsystemctl enable nfs-idmap\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h5",{attrs:{id:"使用如下命令像-etc-exports中添加配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用如下命令像-etc-exports中添加配置"}},[s._v("#")]),s._v(" 使用如下命令像/etc/exports中添加配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# echo '/data     192.168.3.0/24(rw,sync,no_root_squash,no_all_squash)' >> /etc/exports\n# exportfs -a      # 使exports的修改生效\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"检查nfs共享目录是否正确"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查nfs共享目录是否正确"}},[s._v("#")]),s._v(" 检查NFS共享目录是否正确")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# showmount -e localhost\nExport list for localhost:\n/data 192.168.3.0/24\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"放行防火墙相应服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#放行防火墙相应服务"}},[s._v("#")]),s._v(" 放行防火墙相应服务")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# firewall-cmd --add-service=nfs --permanent --zone=public\n# firewall-cmd --add-service=mountd --permanent --zone=public\n# firewall-cmd --add-service=rpc-bind --permanent --zone=public\n# firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("我推荐关闭防火墙")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum -y install wget vim net-tools ntpdate\nsystemctl stop firewalld\nsystemctl disable firewalld\nsed -i 's/enforcing/disabled/' /etc/selinux/config\nsetenforce 0\nsystemctl stop NetworkManager\nsystemctl disable NetworkManager\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_1-5-2-客户端-192-168-3-108，192-168-3-109"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-客户端-192-168-3-108，192-168-3-109"}},[s._v("#")]),s._v(" 1.5.2 客户端 192.168.3.108，192.168.3.109")]),s._v(" "),e("h5",{attrs:{id:"创建nfs挂载文件路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建nfs挂载文件路径"}},[s._v("#")]),s._v(" 创建NFS挂载文件路径")]),s._v(" "),e("p",[e("code",[s._v("# mkdir /data")])]),s._v(" "),e("h5",{attrs:{id:"安装nfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nfs"}},[s._v("#")]),s._v(" 安装NFS")]),s._v(" "),e("p",[e("code",[s._v("# yum -y install nfs-utils")])]),s._v(" "),e("h5",{attrs:{id:"检查nfs远程共享目录是否存在"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查nfs远程共享目录是否存在"}},[s._v("#")]),s._v(" 检查NFS远程共享目录是否存在")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# showmount -e 192.168.3.120\nExport list for 192.168.3.120:\n/data 192.168.3.0/24\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"挂载远程nfs共享文件路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#挂载远程nfs共享文件路径"}},[s._v("#")]),s._v(" 挂载远程NFS共享文件路径")]),s._v(" "),e("p",[e("code",[s._v("# mount -t nfs 192.168.3.120:/data /data")])]),s._v(" "),e("h5",{attrs:{id:"添加到系统开机自动挂载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加到系统开机自动挂载"}},[s._v("#")]),s._v(" 添加到系统开机自动挂载")]),s._v(" "),e("p",[e("code",[s._v("# echo '192.168.3.120:/data /data nfs defaults 0 0' >> /etc/fstab")])]),s._v(" "),e("h5",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("在客户端上挂载完NFS后创建一个测试文件\n# touch /data/test\n然后切换到服务器查看是否存在\n# ls /data/nfs/\ntest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_1-6-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-nginx"}},[s._v("#")]),s._v(" 1.6 Nginx")]),s._v(" "),e("h3",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("h5",{attrs:{id:"添加nginx源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加nginx源"}},[s._v("#")]),s._v(" 添加Nginx源")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"yum安装nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yum安装nginx"}},[s._v("#")]),s._v(" yum安装Nginx")]),s._v(" "),e("p",[e("code",[s._v("# yum -y install nginx")])]),s._v(" "),e("h5",{attrs:{id:"启动nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx"}},[s._v("#")]),s._v(" 启动Nginx")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# systemctl start nginx\n# systemctl enable nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"编写配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写配置"}},[s._v("#")]),s._v(" 编写配置")]),s._v(" "),e("p",[s._v("创建"),e("code",[s._v("/etc/nginx/conf.d/harbor.conf")]),s._v("文件，并写入如下内容")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[s._v("upstream harbor "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ip_hash;\n    server "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.108")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n    server "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.109")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   listen       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n   # 提供访问的域名或者IP\n   server_name  harbor.ccbjb.com.cn;\n   return      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("308")]),s._v(" https"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//$host$request_uri;")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl;\n    server_name harbor.ccbjb.com.cn;\n    \n    # SSL 证书\n    ssl_certificate ./certs/harbor.crt;\n    # SSL 私钥\n    ssl_certificate_key ./certs/harbor.key;\n    client_max_body_size "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(";\n    chunked_transfer_encoding on;\n\n    location / "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-Proto https;\n        proxy_redirect off;\n        proxy_ssl_verify off;\n        proxy_ssl_session_reuse on;\n        proxy_pass http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//harbor;")]),s._v("\n        proxy_http_version "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(";\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    location /v"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//harbor/v2/;")]),s._v("\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_ssl_verify off;\n        proxy_ssl_session_reuse on;\n        proxy_buffering off;\n        proxy_request_buffering off;\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br")])]),e("h4",{attrs:{id:"启动nginx-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx-2"}},[s._v("#")]),s._v(" 启动Nginx")]),s._v(" "),e("h5",{attrs:{id:"验证nginx配置正确性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证nginx配置正确性"}},[s._v("#")]),s._v(" 验证Nginx配置正确性")]),s._v(" "),e("p",[e("code",[s._v("# nginx -t")])]),s._v(" "),e("h5",{attrs:{id:"平滑重启nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#平滑重启nginx"}},[s._v("#")]),s._v(" 平滑重启Nginx")]),s._v(" "),e("p",[e("code",[s._v("# nginx -s reload")])]),s._v(" "),e("h5",{attrs:{id:"开放防火墙80-443端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开放防火墙80-443端口"}},[s._v("#")]),s._v(" 开放防火墙80/443端口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# firewall-cmd --zone=public --permanent --add-port=80/tcp\n# firewall-cmd --zone=public --permanent --add-port=443/tcp\n# firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"问题处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题处理"}},[s._v("#")]),s._v(" 问题处理")]),s._v(" "),e("p",[s._v("Nginx")]),s._v(" "),e("h5",{attrs:{id:"问题：使用自签证书时报错"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题：使用自签证书时报错"}},[s._v("#")]),s._v(" 问题：使用自签证书时报错")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("emerg] 31815#31815: cannot load certificate \"/www/certs/harbor.crt\": BIO_new_file() failed (SSL: error:0200100D:system library:fopen:Permission denied:fopen('/www/certs/harbor.crt','r') error:2006D002:BIO routines:BIO_new_file:system lib)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"解决方法：创建-etc-nginx-certs路径，并复制证书到此路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方法：创建-etc-nginx-certs路径，并复制证书到此路径"}},[s._v("#")]),s._v(" 解决方法：创建/etc/nginx/certs路径，并复制证书到此路径")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /etc/nginx/certs && cp /www/certs/ ./certs\n// 修改harbor.conf中证书相关路径\n# 刚才我们自己签发的证书\nssl_certificate ./certs/harbor.crt;\n# 证书对应的私钥\nssl_certificate_key ./certs/harbor.key;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"_2-两台harbor节点安装harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-两台harbor节点安装harbor"}},[s._v("#")]),s._v(" 2. 两台Harbor节点安装Harbor")]),s._v(" "),e("h3",{attrs:{id:"_2-1-修改配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-修改配置文件"}},[s._v("#")]),s._v(" 2.1 修改配置文件")]),s._v(" "),e("h4",{attrs:{id:"修改harbor-yml配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改harbor-yml配置文件"}},[s._v("#")]),s._v(" 修改harbor.yml配置文件")]),s._v(" "),e("p",[e("code",[s._v("# vim harbor.yml")])]),s._v(" "),e("ul",[e("li",[s._v("使用NFS存储/data存储harobr的磁盘数据，NFS服务端磁盘在3.120上")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# The default data volume\ndata_volume: /data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("使用120上配置的postgress和redis等服务，外部存储数据也在3.120\n主要配置参数如下，由于我们这里使用外置PostgreSQL与Redis所以直接注释掉database相关配置改用external_database与external_redis")])]),s._v(" "),e("p",[s._v("以192.168.3.108为例，192.168.3.109只需要修改hostname")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为当前服务器内网IP地址即可")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostname")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.108 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一台修改为192.168.3.109")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP相关配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS相关配置，这里由于我们会在前端加一个Nginx")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以我们直接使用HTTP，而在Nginx上做SSL")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#https:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # HTTPS端口")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  port: 443")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # TLS证书")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  certificate: /www/certs/harbor.crt")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # TLS私钥")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  private_key: /www/certs/harbor.key")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认管理员密码")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("harbor_admin_password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Harbor12345\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Harbor DB配置，由于使用外部数据库，所以这里我们注释掉")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# database:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   password: root123")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   max_idle_conns: 50")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   max_open_conns: 100")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 外部PostgreSQL，由于Harbor使用了4个数据库，这里我们也需要对相应数据库地址进行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external_database")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("harbor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.120\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20010")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root123\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ssl_mode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" disable\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_idle_conns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_open_conns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clair")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.120\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20011")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" clair\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root123\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ssl_mode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" disable\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notary_signer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.120\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20012")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" notarysigner\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root123\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ssl_mode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" disable\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notary_server")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.120\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20013")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" notaryserver\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root123\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ssl_mode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" disable\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用外部Redis，取消相应注释即可")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external_redis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.120\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("registry_db_index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobservice_db_index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("chartmuseum_db_index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br")])]),e("ul",[e("li",[s._v("所以 3.120存在单点问题。\n3.120要是损坏了。就什么都完了。\n改进：我写了个shell，每天备份3.120数据到另外一个机器。")])]),s._v(" "),e("h3",{attrs:{id:"_2-2-安装harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装harbor"}},[s._v("#")]),s._v(" 2.2 安装Harbor")]),s._v(" "),e("h5",{attrs:{id:"生成harbor运行的必要文件（环境）以及docker-compose-yml文件；"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成harbor运行的必要文件（环境）以及docker-compose-yml文件；"}},[s._v("#")]),s._v(" 生成harbor运行的必要文件（环境）以及docker-compose.yml文件；")]),s._v(" "),e("p",[s._v("执行后会通过网络获取Docker Image，建议提前修改好国内镜像站加速。\n"),e("code",[s._v("# ./prepare")])]),s._v(" "),e("p",[e("code",[s._v("# ./install.sh")])]),s._v(" "),e("h5",{attrs:{id:"开放harbor端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开放harbor端口"}},[s._v("#")]),s._v(" 开放Harbor端口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# firewall-cmd --zone=public --permanent --add-port=80/tcp\n# firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("推荐关闭防火墙，就不需要这步了")])]),s._v(" "),e("h4",{attrs:{id:"以上就是原文的全部了。这里有一处漏记。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#以上就是原文的全部了。这里有一处漏记。"}},[s._v("#")]),s._v(" 以上就是原文的全部了。这里有一处漏记。")]),s._v(" "),e("p",[s._v("如果不处理，会有push镜像失败的问题。")]),s._v(" "),e("h3",{attrs:{id:"_2-3-修改harbor的nginx配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-修改harbor的nginx配置"}},[s._v("#")]),s._v(" 2.3 修改harbor的nginx配置")]),s._v(" "),e("h6",{attrs:{id:"参考："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考："}},[s._v("#")]),s._v(" 参考：")]),s._v(" "),e("p",[s._v("https://goharbor.io/docs/2.0.0/install-config/troubleshoot-installation/")]),s._v(" "),e("blockquote",[e("p",[s._v("使用nginx或负载平衡\n如果Harbor在nginx代理或弹性负载平衡之后运行，请打开文件common/config/nginx/nginx.conf并搜索以下行。\nproxy_set_header X-Forwarded-Proto $scheme;\n如果代理已经有类似的设置，从部分删除\nlocation /，\nlocation /v2/\nlocation /service/\n和重新部署港湾。有关如何重新部署Harbor的说明，请参阅 重新配置Harbor和管理Harbor生命周期。")])]),s._v(" "),e("h5",{attrs:{id:"首先，修改两个nginx节点的nginx配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#首先，修改两个nginx节点的nginx配置文件"}},[s._v("#")]),s._v(" 首先，修改两个nginx节点的nginx配置文件")]),s._v(" "),e("p",[s._v("harbor安装目录（harbor.xml同级目录）"),e("code",[s._v("/root/harbor")]),s._v("，修改nginx的配置文件\n"),e("code",[s._v("/root/harbor/common/config/nginx/nginx.conf")]),s._v(" 三处，注意只改三处。\n否则，push的时候会一直retring！！！！！！！！\n"),e("font",{attrs:{color:"red"}},[s._v("该配置文件的注释会有误导，导致你都注释掉，就怎么也push不成功,  注意只改三处（/，/v2/,/service/）! 注释“proxy_set_header X-Forwarded-Proto $scheme;”")])],1),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" location / {\n      proxy_pass http://portal/;\n      proxy_set_header Host $host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.\n      # proxy_set_header X-Forwarded-Proto $scheme;\n\n      proxy_buffering off;\n      proxy_request_buffering off;\n    }\nlocation /v2/ {\n      proxy_pass http://core/v2/;\n      proxy_set_header Host $http_host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.\n      # proxy_set_header X-Forwarded-Proto $scheme;\n      proxy_buffering off;\n      proxy_request_buffering off;\n\n      proxy_send_timeout 900;\n      proxy_read_timeout 900;\n    }\n location /service/ {\n      proxy_pass http://core/service/;\n      proxy_set_header Host $host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.\n      # proxy_set_header X-Forwarded-Proto $scheme;\n\n      proxy_buffering off;\n      proxy_request_buffering off;\n    }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br")])]),e("h5",{attrs:{id:"然后，重启harbor服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#然后，重启harbor服务"}},[s._v("#")]),s._v(" 然后，重启harbor服务")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose down\ndocker-compose up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_3-dockers客户端测试push"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-dockers客户端测试push"}},[s._v("#")]),s._v(" 3. dockers客户端测试push")]),s._v(" "),e("h5",{attrs:{id:"_192-168-3-107-上测试push"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_192-168-3-107-上测试push"}},[s._v("#")]),s._v(" 192.168.3.107 上测试push")]),s._v(" "),e("h6",{attrs:{id:"客户端上修改docker配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端上修改docker配置文件"}},[s._v("#")]),s._v(" 客户端上修改docker配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# vi /etc/docker/daemon.json\n{\n "insecure-registries": ["harbor.ccbjb.com.cn"]\n}\n\n// 修改/etc/docker/daemon.json完成后reload配置文件\n# sudo systemctl daemon-reload\n\n// 重启docker服务\n# sudo systemctl restart docker.service\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("不修改login不进去，push不让")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker login -u admin harbor.ccbjb.com.cn\npassword:\n输入harbor.xml里Harbor12345（当然我已经改成别的了，输入你自己的密码）\nLogin Succeeded\n\n# docker tag node harbor.ccbjb.com.cn/library/vue/js\n\n# docker push harbor.ccbjb.com.cn/library/vue/js\nThe push refers to a repository [harbor.ccbjb.com.cn/library/vuejs/ci]\n3cb56e88501e: Pushed\n5fe5f08a709e: Pushed\n99ad6967cf69: Pushed\n2aa1c54ebc66: Pushed\n89cb25530034: Pushed\nc4b55423085b: Pushed\nb5e9932b9936: Pushed\nd5644f4d8741: Pushed\n4a03ae8d3bee: Pushed\na9286fedbd63: Pushed\nd50e7be1e737: Pushed\n6b114a2dd6de: Pushed\nbb9315db9240: Pushed\nlatest: digest: sha256:3b766dda613fcd2dce50e4e2ba6ef9ae0e322a52ca1fff6d9e466a06e2a8a0e6 size: 3063\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("h5",{attrs:{id:"同一个网段192-168-3-随便哪台机器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#同一个网段192-168-3-随便哪台机器"}},[s._v("#")]),s._v(" 同一个网段192.168.3.*随便哪台机器")]),s._v(" "),e("p",[s._v("https://harbor.ccbjb.com.cn/\nadmin\nHarbor12345\n都能够看到已经上传的镜像文件。")]),s._v(" "),e("hr"),s._v(" "),e("h1",{attrs:{id:"以下：一次失败的把-harbor安装在samba挂载上的经历（不要尝试）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#以下：一次失败的把-harbor安装在samba挂载上的经历（不要尝试）"}},[s._v("#")]),s._v(" 以下：一次失败的把 Harbor安装在samba挂载上的经历（不要尝试）")]),s._v(" "),e("p",[s._v("修改docker卷位置\n首先把公司分给我的raid盘挂载过来。\n然后把harbor默认的dockers卷修改在这块磁盘上。这样至少存储上提高了点安全性。")]),s._v(" "),e("h2",{attrs:{id:"_1，作为samba的客户端挂载服务端的磁盘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1，作为samba的客户端挂载服务端的磁盘"}},[s._v("#")]),s._v(" 1，作为samba的客户端挂载服务端的磁盘")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://githubshirongxin.github.io/Smba%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%A3%81%E7%9B%98/",target:"_blank",rel:"noopener noreferrer"}},[s._v("samba实现分布式磁盘"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("已经挂完 /data_cjb/")]),s._v(" "),e("ul",[e("li",[s._v("确认一下挂载情况：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mount | grep data_cjb\n或者\ndf -hT | grep data_cjb\n或者\ncat /etc/fstab\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_2，修改harbor-docker-compose-yml-harbor-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2，修改harbor-docker-compose-yml-harbor-yml"}},[s._v("#")]),s._v(" 2，修改harbor/docker-compose.yml , harbor.yml")]),s._v(" "),e("h3",{attrs:{id:"harbor-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#harbor-yml"}},[s._v("#")]),s._v(" harbor.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" # Log configurations\n   location: /var/log/harbor # 不改了，这块丢就丢了。\n # The default data volume\n #  data_volume: /data #这得改成mount好的raid盘目录\n data_volume: /data_cjb/harbordata\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"docker-compose-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[s._v("#")]),s._v(" docker-compose.yml")]),s._v(" "),e("p",[s._v("所有/data/ 都改成/data_cjb/harbordata/")]),s._v(" "),e("h2",{attrs:{id:"_3，执行-install-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3，执行-install-sh"}},[s._v("#")]),s._v(" 3，执行"),e("code",[s._v("./install.sh")])]),s._v(" "),e("p",[s._v("最后/root/harbor/prepare 执行的时候报错。\n说容器内没有/data/secret/cert/目录没有permission denied")]),s._v(" "),e("h2",{attrs:{id:"结论：samba共享目录上无法安装harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结论：samba共享目录上无法安装harbor"}},[s._v("#")]),s._v(" 结论：samba共享目录上无法安装harbor")]),s._v(" "),e("p",[s._v("另外，我在nfs上共享目录上就能安装harbor。")]),s._v(" "),e("hr")])}),[],!1,null,null,null);a.default=t.exports}}]);