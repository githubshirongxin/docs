<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【gitlab-ci-runner + nexus】加速docker下载 （一）IP | 共享</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/docs/logo.png">
    <link rel="icon" href="/docs/logo.png">
    <link rel="manifest" href="/docs/manifest.json">
    <link rel="apple-touch-icon" href="/docs/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/docs/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="共享库">
    <meta name="name" content="cjb的资料库">
    <meta name="keywords" content="java,cobol,分布式存储">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/docs/assets/css/0.styles.27bfdfe7.css" as="style"><link rel="preload" href="/docs/assets/js/app.6e55b747.js" as="script"><link rel="preload" href="/docs/assets/js/5.379e7eff.js" as="script"><link rel="preload" href="/docs/assets/js/2.28087ae7.js" as="script"><link rel="preload" href="/docs/assets/js/53.7c3a1c31.js" as="script"><link rel="preload" href="/docs/assets/js/3.32492e15.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.a8c07073.js"><link rel="prefetch" href="/docs/assets/js/100.f691b998.js"><link rel="prefetch" href="/docs/assets/js/101.95504fdb.js"><link rel="prefetch" href="/docs/assets/js/102.40abdd12.js"><link rel="prefetch" href="/docs/assets/js/103.6718ba31.js"><link rel="prefetch" href="/docs/assets/js/104.11bda7cb.js"><link rel="prefetch" href="/docs/assets/js/105.1a6c292b.js"><link rel="prefetch" href="/docs/assets/js/106.fa53759d.js"><link rel="prefetch" href="/docs/assets/js/107.3b64ec12.js"><link rel="prefetch" href="/docs/assets/js/108.4f8cc558.js"><link rel="prefetch" href="/docs/assets/js/109.8af9d095.js"><link rel="prefetch" href="/docs/assets/js/11.a1fe48fc.js"><link rel="prefetch" href="/docs/assets/js/110.c0b7140e.js"><link rel="prefetch" href="/docs/assets/js/111.2324c77d.js"><link rel="prefetch" href="/docs/assets/js/112.dc2637ea.js"><link rel="prefetch" href="/docs/assets/js/113.8b9b71c9.js"><link rel="prefetch" href="/docs/assets/js/114.6a9ceeff.js"><link rel="prefetch" href="/docs/assets/js/115.8fe89cff.js"><link rel="prefetch" href="/docs/assets/js/116.f342e4a1.js"><link rel="prefetch" href="/docs/assets/js/117.4620477a.js"><link rel="prefetch" href="/docs/assets/js/118.7981b3f5.js"><link rel="prefetch" href="/docs/assets/js/119.2ca384f1.js"><link rel="prefetch" href="/docs/assets/js/12.cd4e8d90.js"><link rel="prefetch" href="/docs/assets/js/120.540d1f9b.js"><link rel="prefetch" href="/docs/assets/js/121.b5c5d382.js"><link rel="prefetch" href="/docs/assets/js/122.150bd431.js"><link rel="prefetch" href="/docs/assets/js/123.6e43e320.js"><link rel="prefetch" href="/docs/assets/js/124.fdf50321.js"><link rel="prefetch" href="/docs/assets/js/125.c448ac7e.js"><link rel="prefetch" href="/docs/assets/js/126.8a9f6a47.js"><link rel="prefetch" href="/docs/assets/js/127.a865ae13.js"><link rel="prefetch" href="/docs/assets/js/128.04fcb4f2.js"><link rel="prefetch" href="/docs/assets/js/129.45ffba0e.js"><link rel="prefetch" href="/docs/assets/js/13.4b9ad952.js"><link rel="prefetch" href="/docs/assets/js/130.579326b1.js"><link rel="prefetch" href="/docs/assets/js/131.ed79563d.js"><link rel="prefetch" href="/docs/assets/js/14.7e60c2ed.js"><link rel="prefetch" href="/docs/assets/js/15.367ac9f7.js"><link rel="prefetch" href="/docs/assets/js/16.06233627.js"><link rel="prefetch" href="/docs/assets/js/17.d1bf7fd6.js"><link rel="prefetch" href="/docs/assets/js/18.d93731a4.js"><link rel="prefetch" href="/docs/assets/js/19.01badb85.js"><link rel="prefetch" href="/docs/assets/js/20.64ff113b.js"><link rel="prefetch" href="/docs/assets/js/21.06653c04.js"><link rel="prefetch" href="/docs/assets/js/22.bf6cb808.js"><link rel="prefetch" href="/docs/assets/js/23.a9bcc779.js"><link rel="prefetch" href="/docs/assets/js/24.2740b2d2.js"><link rel="prefetch" href="/docs/assets/js/25.ccde2628.js"><link rel="prefetch" href="/docs/assets/js/26.748a202c.js"><link rel="prefetch" href="/docs/assets/js/27.30ae861c.js"><link rel="prefetch" href="/docs/assets/js/28.1fd6ea1f.js"><link rel="prefetch" href="/docs/assets/js/29.4af5443c.js"><link rel="prefetch" href="/docs/assets/js/30.fcf8467e.js"><link rel="prefetch" href="/docs/assets/js/31.7ac5aaa5.js"><link rel="prefetch" href="/docs/assets/js/32.e6ce87f2.js"><link rel="prefetch" href="/docs/assets/js/33.c132c1a9.js"><link rel="prefetch" href="/docs/assets/js/34.60dc99c0.js"><link rel="prefetch" href="/docs/assets/js/35.c971ca86.js"><link rel="prefetch" href="/docs/assets/js/36.b666a590.js"><link rel="prefetch" href="/docs/assets/js/37.47f1df6a.js"><link rel="prefetch" href="/docs/assets/js/38.9cc8507d.js"><link rel="prefetch" href="/docs/assets/js/39.0af0b115.js"><link rel="prefetch" href="/docs/assets/js/4.19274861.js"><link rel="prefetch" href="/docs/assets/js/40.f2dcfd11.js"><link rel="prefetch" href="/docs/assets/js/41.49ede3e2.js"><link rel="prefetch" href="/docs/assets/js/42.56dbce72.js"><link rel="prefetch" href="/docs/assets/js/43.ffa70e8d.js"><link rel="prefetch" href="/docs/assets/js/44.6a546718.js"><link rel="prefetch" href="/docs/assets/js/45.ac09bf10.js"><link rel="prefetch" href="/docs/assets/js/46.758ee881.js"><link rel="prefetch" href="/docs/assets/js/47.e2e35ac5.js"><link rel="prefetch" href="/docs/assets/js/48.b5c84a0a.js"><link rel="prefetch" href="/docs/assets/js/49.a235999a.js"><link rel="prefetch" href="/docs/assets/js/50.300c683b.js"><link rel="prefetch" href="/docs/assets/js/51.76819f93.js"><link rel="prefetch" href="/docs/assets/js/52.3ad409ec.js"><link rel="prefetch" href="/docs/assets/js/54.bc9bcd5e.js"><link rel="prefetch" href="/docs/assets/js/55.3bc6e3af.js"><link rel="prefetch" href="/docs/assets/js/56.9b082ef4.js"><link rel="prefetch" href="/docs/assets/js/57.5ed9bd17.js"><link rel="prefetch" href="/docs/assets/js/58.ade6fb92.js"><link rel="prefetch" href="/docs/assets/js/59.23455a7b.js"><link rel="prefetch" href="/docs/assets/js/6.d4972abb.js"><link rel="prefetch" href="/docs/assets/js/60.4484b3e7.js"><link rel="prefetch" href="/docs/assets/js/61.f608a58c.js"><link rel="prefetch" href="/docs/assets/js/62.0251cff2.js"><link rel="prefetch" href="/docs/assets/js/63.5886cbca.js"><link rel="prefetch" href="/docs/assets/js/64.06d3cb7c.js"><link rel="prefetch" href="/docs/assets/js/65.e7c31045.js"><link rel="prefetch" href="/docs/assets/js/66.f3405a17.js"><link rel="prefetch" href="/docs/assets/js/67.f8032304.js"><link rel="prefetch" href="/docs/assets/js/68.8d124d81.js"><link rel="prefetch" href="/docs/assets/js/69.a2e0530c.js"><link rel="prefetch" href="/docs/assets/js/7.9affb0fc.js"><link rel="prefetch" href="/docs/assets/js/70.6d501178.js"><link rel="prefetch" href="/docs/assets/js/71.8d32deb5.js"><link rel="prefetch" href="/docs/assets/js/72.b24f7dd9.js"><link rel="prefetch" href="/docs/assets/js/73.715d8f9e.js"><link rel="prefetch" href="/docs/assets/js/74.19c2aa3e.js"><link rel="prefetch" href="/docs/assets/js/75.d8b9b1a0.js"><link rel="prefetch" href="/docs/assets/js/76.4b895d60.js"><link rel="prefetch" href="/docs/assets/js/77.7c1850d1.js"><link rel="prefetch" href="/docs/assets/js/78.ccc1066a.js"><link rel="prefetch" href="/docs/assets/js/79.efc920cf.js"><link rel="prefetch" href="/docs/assets/js/8.2d653edf.js"><link rel="prefetch" href="/docs/assets/js/80.1faebb0f.js"><link rel="prefetch" href="/docs/assets/js/81.03b8bc03.js"><link rel="prefetch" href="/docs/assets/js/82.b6022252.js"><link rel="prefetch" href="/docs/assets/js/83.92c1422f.js"><link rel="prefetch" href="/docs/assets/js/84.569da873.js"><link rel="prefetch" href="/docs/assets/js/85.13ea5733.js"><link rel="prefetch" href="/docs/assets/js/86.11f3ac49.js"><link rel="prefetch" href="/docs/assets/js/87.8b1ce2e7.js"><link rel="prefetch" href="/docs/assets/js/88.f0a2995c.js"><link rel="prefetch" href="/docs/assets/js/89.54fe35f8.js"><link rel="prefetch" href="/docs/assets/js/9.2dd78087.js"><link rel="prefetch" href="/docs/assets/js/90.d78f6a18.js"><link rel="prefetch" href="/docs/assets/js/91.aa1cf114.js"><link rel="prefetch" href="/docs/assets/js/92.4a218073.js"><link rel="prefetch" href="/docs/assets/js/93.990f6166.js"><link rel="prefetch" href="/docs/assets/js/94.c32b4e33.js"><link rel="prefetch" href="/docs/assets/js/95.3d42890a.js"><link rel="prefetch" href="/docs/assets/js/96.b431e07a.js"><link rel="prefetch" href="/docs/assets/js/97.b205777f.js"><link rel="prefetch" href="/docs/assets/js/98.ad6f5a44.js"><link rel="prefetch" href="/docs/assets/js/99.69f02348.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.27bfdfe7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/logo.png" alt="共享" class="logo"> <span class="site-name can-hide">共享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux-powshell" class="dropdown-title"><span class="title">linux-powshell</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/linux-powshell/" class="nav-link">
  linux-powshell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="elasticSearch" class="dropdown-title"><span class="title">elasticSearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/elasticSearch/" class="nav-link">
  elasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="maven-nexus" class="dropdown-title"><span class="title">maven-nexus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/maven-nexus/" class="nav-link">
  maven-nexus
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vuepress/" class="nav-link">
  vuepress
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="docker" class="dropdown-title"><span class="title">docker</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/docker/" class="nav-link">
  docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="gitlab" class="dropdown-title"><span class="title">gitlab</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/gitlab/" class="nav-link router-link-active">
  gitlab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vscode" class="dropdown-title"><span class="title">vscode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  vscode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高可用系统" class="dropdown-title"><span class="title">高可用系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/高可用系统/" class="nav-link">
  高可用系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NFS" class="dropdown-title"><span class="title">NFS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/NFS/" class="nav-link">
  NFS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git" class="dropdown-title"><span class="title">git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/git/" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="k8s" class="dropdown-title"><span class="title">k8s</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/k8s/" class="nav-link">
  k8s
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux-powshell" class="dropdown-title"><span class="title">linux-powshell</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/linux-powshell/" class="nav-link">
  linux-powshell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="elasticSearch" class="dropdown-title"><span class="title">elasticSearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/elasticSearch/" class="nav-link">
  elasticSearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="maven-nexus" class="dropdown-title"><span class="title">maven-nexus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/maven-nexus/" class="nav-link">
  maven-nexus
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vuepress/" class="nav-link">
  vuepress
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="docker" class="dropdown-title"><span class="title">docker</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/docker/" class="nav-link">
  docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="gitlab" class="dropdown-title"><span class="title">gitlab</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/gitlab/" class="nav-link router-link-active">
  gitlab
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vscode" class="dropdown-title"><span class="title">vscode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  vscode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高可用系统" class="dropdown-title"><span class="title">高可用系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/高可用系统/" class="nav-link">
  高可用系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NFS" class="dropdown-title"><span class="title">NFS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/NFS/" class="nav-link">
  NFS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git" class="dropdown-title"><span class="title">git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/git/" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="k8s" class="dropdown-title"><span class="title">k8s</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/k8s/" class="nav-link">
  k8s
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>gitlab</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/gitlab/2020-7-2-GitLab【单机版】docker-compose部署.html" class="sidebar-link">【GitLab安装】Docker和docker-compose部署GitLab（第一天）</a></li><li><a href="/docs/gitlab/2020-7-2-GitLab【单机版】docker-compose部署第二天.html" class="sidebar-link">【GitLab安装】Docker和docker-compose部署GitLab 单机版（第二天补记，成功经验）</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab-Pages-Domain.html" class="sidebar-link">【gitlab pages】 设置域名</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab-Pages-Runner.html" class="sidebar-link">【gitlab vuepress】 能够成功编译vuepress项目了</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab-Runner编译springcloud项目.html" class="sidebar-link">【gitlab runner】编译springcloud项目</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab-SharedRunner-GroupRunner.html" class="sidebar-link">【Gitlab Runner】 本地Gitlab服务器的shared runner 和 Group Runner的配置方法</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab-团队使用Gitlab的流程.html" class="sidebar-link">【gitlab工作流】</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab_Runner安装配置.html" class="sidebar-link">【GitlabRunner安装配置】</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab使用自签名证书开启https.html" class="sidebar-link">【Gitlab配置】使用自签名证书开启Https</a></li><li><a href="/docs/gitlab/2020-7-2-Gitlab协同开发.html" class="sidebar-link">【gitlab协同开发】</a></li><li><a href="/docs/gitlab/2020-7-3-gitlabTroubleShooting.html" class="sidebar-link">【GitLab trouble shootting】（持续更新中）</a></li><li><a href="/docs/gitlab/2020-8-10-GitlabRunner-neuxs-maven.html" class="sidebar-link">【how-to-use-gitlab-ci-with-nexus maven】</a></li><li><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（一）.html" class="active sidebar-link">【gitlab-ci-runner + nexus】加速docker下载 （一）IP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（一）.html#先让runner从私服上下载吧。" class="sidebar-link">先让runner从私服上下载吧。</a></li><li class="sidebar-sub-header"><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（一）.html#阿里云镜像也不快，还不如不用。" class="sidebar-link">阿里云镜像也不快，还不如不用。</a></li><li class="sidebar-sub-header"><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（一）.html#如何让docker-pull-自动去找私服，而不用写打私服的tag呢？" class="sidebar-link">如何让docker pull 自动去找私服，而不用写打私服的tag呢？</a></li></ul></li><li><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（二）.html" class="sidebar-link">【gitlab-runner + nexus】加速docker和npm下载 （二）nginx代理docker库ssl</a></li><li><a href="/docs/gitlab/2020-8-13-gitlab日常维护.html" class="sidebar-link">【gitlab日常维护】</a></li><li><a href="/docs/gitlab/2020-8-4-GitlabPages公司方案思考.html" class="sidebar-link">【gitlab pages】公司方案思考</a></li><li><a href="/docs/gitlab/" aria-current="page" class="sidebar-link">gitlab EE 与 CE 的区别</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="先让runner从私服上下载吧。"><a href="#先让runner从私服上下载吧。" class="header-anchor">#</a> 先让runner从私服上下载吧。</h2> <p>[root@centos3 ~]# cat /etc/docker/daemon.json
{
&quot;insecure-registries&quot;: [&quot;harbor.ccbjb.com.cn&quot;,&quot;192.168.3.124:8082&quot;,&quot;192.168.3.124:8083&quot;]
}
[root@centos3 ~]#
[root@centos3 ~]# systemctl daemon-reload &amp;&amp; systemctl restart docker.service
[root@centos3 ~]# docker login 192.168.3.124:8083
Username: admin
Password:
Login Succeeded
[root@centos3 ~]# docker login 192.168.3.124:8082
Username: admin
Password:
Login Succeeded</p> <p>//gitlab-ci.yml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>image: 192.168.3.124:8082/node:latest

pages:
  cache:
    paths:
    - node_modules/

  script:
   - yarn install
   - yarn run build 
 
  artifacts:
    paths:
    - public
  only:
  - master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/docs/images/2020-08-08-09-20-47.png" alt=""></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>
Running with gitlab-runner 13.2.1 (efa30e33)
   on shared runner form 3.112 Unz4U-uF
Preparing the &quot;docker&quot; executor
00:11
 Using Docker executor with image 192.168.3.124:8082/node:latest ...
 Pulling docker image 192.168.3.124:8082/node:latest ...
 ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials (docker.go:131:0s)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>3.112
vi docker-compose.yml
增加 -v /etc/docker/daemon.json:/etc/docker/daemon.json</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose down
docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3.102
git push</p> <p>3.112 error the same.</p> <hr> <p>参考:https://blog.csdn.net/renguiriyue/article/details/102769884</p> <p>课题：为什么runner里没安装docker，却能使用docker regiser？</p> <p>课题：runner调用docker时使用了什么机制？</p> <p>课题：runner和gitlab-ci使用什么机制通讯，日志和状态是怎么传递给gitlab-ci的？</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 生成镜像</span>
 docker build -t srximg <span class="token builtin class-name">.</span> 
 docker images
<span class="token comment"># 运行容器</span>
 docker run -d --name srxcontainer srximg:latest <span class="token operator">&amp;&amp;</span> docker <span class="token builtin class-name">exec</span> -it srxcontainer /bin/bash
 docker stop srxcontainer <span class="token operator">&amp;&amp;</span> docker <span class="token function">rm</span> srxcontainer <span class="token operator">&amp;&amp;</span> docker rmi srximg

<span class="token comment">#清除坏的&lt;none&gt;:&lt;none&gt;镜像</span>
docker rmi <span class="token variable"><span class="token variable">$(</span>docker images -f <span class="token string">&quot;dangling=true&quot;</span> -q<span class="token variable">)</span></span>

<span class="token comment">#删除所有停止的容器</span>
<span class="token function">sudo</span> docker container prune
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos112 enviroment<span class="token punctuation">]</span><span class="token comment"># docker build -t srximg .</span>
Sending build context to Docker daemon  <span class="token number">471</span>.2MB
Step <span class="token number">1</span>/8 <span class="token builtin class-name">:</span> FROM gitlab/gitlab-runner:latest
 ---<span class="token operator">&gt;</span> a0153b77b0da
Step <span class="token number">2</span>/8 <span class="token builtin class-name">:</span> MAINTAINER shirongxin <span class="token operator">&lt;</span>shirx@ccbjb.com.cn<span class="token operator">&gt;</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 362be8f59e24
Step <span class="token number">3</span>/8 <span class="token builtin class-name">:</span> RUN <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse'</span> <span class="token operator">&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span>     <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span>     <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span>     <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span>     <span class="token function">apt-get</span> update -y <span class="token operator">&amp;&amp;</span>     <span class="token function">apt-get</span> clean
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> d0b29c3c05ee
Step <span class="token number">4</span>/8 <span class="token builtin class-name">:</span> RUN <span class="token function">mkdir</span> -p /usr/local/java
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> f6f79795f236
Removing intermediate container f6f79795f236
 ---<span class="token operator">&gt;</span> e76dcfbdeba9
Step <span class="token number">5</span>/8 <span class="token builtin class-name">:</span> WORKDIR /usr/local/java
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> f6263cebe3a2
Removing intermediate container f6263cebe3a2
 ---<span class="token operator">&gt;</span> 2dce5a8195d3
Step <span class="token number">6</span>/8 <span class="token builtin class-name">:</span> COPY openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz /usr/local/java
 ---<span class="token operator">&gt;</span> b62304fa0fa3
Step <span class="token number">7</span>/8 <span class="token builtin class-name">:</span> ENV JAVA_HOME /usr/java/jdk1.8.0_261-amd64/bin/java
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fa0376ce9194
Removing intermediate container fa0376ce9194
 ---<span class="token operator">&gt;</span> acd17be40649
Step <span class="token number">8</span>/8 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> c250388054b2
Removing intermediate container c250388054b2
 ---<span class="token operator">&gt;</span> 70a3aa0cad5e
Successfully built 70a3aa0cad5e
Successfully tagged srximg:latest
<span class="token punctuation">[</span>root@centos112 enviroment<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>GitLab Runner Docker images (based on Ubuntu or Alpine Linux)，安装docker时候出错。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Creating config <span class="token function">file</span> /etc/apt/apt.conf.d/50unattended-upgrades with new version
Setting up python3-software-properties <span class="token punctuation">(</span><span class="token number">0.96</span>.20.9<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
Setting up software-properties-common <span class="token punctuation">(</span><span class="token number">0.96</span>.20.9<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
Processing triggers <span class="token keyword">for</span> libc-bin <span class="token punctuation">(</span><span class="token number">2.27</span>-3ubuntu1<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
Processing triggers <span class="token keyword">for</span> sgml-base <span class="token punctuation">(</span><span class="token number">1.26</span>+nmu4ubuntu1<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
Processing triggers <span class="token keyword">for</span> dbus <span class="token punctuation">(</span><span class="token number">1.10</span>.6-1ubuntu3.6<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
E: gnupg, gnupg2 and gnupg1 <span class="token keyword">do</span> not seem to be installed, but one of them is required <span class="token keyword">for</span> this operation
<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span> Failed writing body
The <span class="token builtin class-name">command</span> <span class="token string">'/bin/sh -c dpkg --configure -a &amp;&amp;     apt-get install -y apt-transport-https ca-certificates curl software-properties-common &amp;&amp;
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &amp;&amp;     add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable&quot; &amp;&amp;     apt-get update -y &amp;&amp;     apt-get install -y docker-ce'</span> returned a non-zero code: <span class="token number">255</span>
<span class="token punctuation">[</span>root@centos112 enviroment<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>root@def6fbc9a09a:/# cd /etc
root@def6fbc9a09a:/etc# ls red*
ls: cannot access 'red*': No such file or directory
root@def6fbc9a09a:/etc# ls issue
issue
root@def6fbc9a09a:/etc# cat issue
Ubuntu 18.04.4 LTS \n \l</p> <p>识别操作系统的方法：
https://blog.csdn.net/Dafei4/article/details/79589369/</p> <p>gitlab Runner的系统名字
lsb_release -cs = <strong>bionic</strong>
https://download.docker.com/linux/ubuntu</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Index of linux/ubuntu/dists/
../
artful/
bionic/
cosmic/
disco/
eoan/
focal/
trusty/
xenial/
yakkety/
zesty/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>所以使用库的时候，必须指定bionic
原来博文中的史xenial，而我下载的gitlabrunner使用的史bionic</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 修改软件源</span>
RUN <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'</span> <span class="token operator">&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> update -y <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> clean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>// 完整Dockerfile如下，安装好docker，docker-compose，java，maven</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>MAINTAINER shirongxin <span class="token operator">&lt;</span>shirx@ccbjb.com.cn<span class="token operator">&gt;</span>

<span class="token comment"># 修改软件源</span>
RUN <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse'</span> <span class="token operator">&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse'</span> <span class="token operator">&gt;&gt;</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> update -y <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> clean

<span class="token comment"># 安装 Docker</span>
RUN <span class="token function">apt-get</span> -y <span class="token function">install</span> apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">curl</span> -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> - <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    add-apt-repository <span class="token string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> update -y <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">apt-get</span> <span class="token function">install</span> -y docker-ce
<span class="token comment">#RUN apt-get update &amp;&amp; apt-get install -y gnupg2 &amp;&amp; \</span>
<span class="token comment">#    dpkg --configure -a &amp;&amp; \</span>
<span class="token comment">#    apt-get install -y apt-transport-https ca-certificates curl software-properties-common &amp;&amp; \</span>
<span class="token comment">#    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -no-tty - &amp;&amp; \</span>
<span class="token comment">#    add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; &amp;&amp; \</span>
<span class="token comment">#    apt-get update -y &amp;&amp; \</span>
<span class="token comment">#    apt-get install -y docker-ce</span>
COPY daemon.json /etc/docker/daemon.json

<span class="token comment"># 安装 Docker Compose（这边的链接会失效的，所以还需要自己到docker-compose 确认）</span>
WORKDIR /usr/local/bin
<span class="token comment">#RUN wget https://raw.githubusercontent.com/topsale/resources/master/docker-compose</span>
RUN <span class="token function">curl</span> -L <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.26.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span>  -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-composeRUN <span class="token function">chmod</span> +x /usr/local/bin/docker-compose

<span class="token comment"># 安装 java</span>
RUN <span class="token function">mkdir</span> -p /usr/local/java
WORKDIR /usr/local/java
COPY openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz /usr/local/java
RUN <span class="token function">tar</span> -zxvf openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz
<span class="token comment">#     rm -fr openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz</span>

<span class="token comment"># 安装 Maven</span>
RUN <span class="token function">mkdir</span> -p /usr/local/maven
WORKDIR /usr/local/maven
<span class="token comment">#RUN wget https://raw.githubusercontent.com/topsale/resources/master/maven/apache-maven-3.5.3-bin.tar.gz</span>
<span class="token comment">#RUN wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz</span>
COPY apache-maven-3.6.3-bin.tar.gz /usr/local/maven
RUN <span class="token function">tar</span> -zxvf apache-maven-3.6.3-bin.tar.gz
<span class="token comment">#    rm -fr apache-maven-3.6.3-bin.tar.gz</span>
<span class="token comment"># 准备一份maven 配置好的文件，这里参考 nexus 配置</span>
COPY settings.xml /usr/local/maven/apache-maven-3.6.3/conf/settings.xml

<span class="token comment"># 配置环境变量</span>
ENV JAVA_HOME /usr/local/java/java-se-8u41-ri
ENV MAVEN_HOME /usr/local/maven/apache-maven-3.6.3
ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$MAVEN_HOME</span>/bin

WORKDIR /
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>docker-compose up -d
docker exec -it gitlab_runner /bin/bash</p> <p>Runner error:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Preparing the &quot;docker&quot; executor
 Using Docker executor with image 192.168.3.124:8082/node:latest ...
 Pulling docker image 192.168.3.124:8082/node:latest ...
 ERROR: Preparation failed: Error response from daemon: Get http://192.168.3.124:8082/v2/node/manifests/latest: no basic auth credentials (docker.go:131:0s)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>难道Runner里需要先docker login 192.158.3.124:8082 ?</p> <p>试试</p> <p>果然，更新vuepress，自动编译了。好用了</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Running with gitlab-runner <span class="token number">13.2</span>.1 <span class="token punctuation">(</span>efa30e33<span class="token punctuation">)</span>
   on shared runner form <span class="token number">3.112</span> Unz4U-uF
Preparing the <span class="token string">&quot;docker&quot;</span> executor
 Using Docker executor with image <span class="token number">192.168</span>.3.124:8082/node:latest <span class="token punctuation">..</span>.
 Authenticating with credentials from /root/.docker/config.json
 Pulling docker image <span class="token number">192.168</span>.3.124:8082/node:latest <span class="token punctuation">..</span>.
 Using docker image sha256:002df0b34ccb8b3bcaf022b8fea4e6b5cce1bc811fbd33d38840cdc21ee5f931 <span class="token keyword">for</span> <span class="token number">192.168</span>.3.124:8082/node:latest <span class="token punctuation">..</span>.
Preparing environment
00:00
 Running on runner-unz4u-uf-project-11-concurrent-0 via b2fd1f150f12<span class="token punctuation">..</span>.
Getting <span class="token builtin class-name">source</span> from Git repository
00:03
 Fetching changes with <span class="token function">git</span> depth <span class="token builtin class-name">set</span> to <span class="token number">50</span><span class="token punctuation">..</span>.
 Reinitialized existing Git repository <span class="token keyword">in</span> /builds/shirongxin/docs/.git/
 Checking out 5c0d0b1e as master<span class="token punctuation">..</span>.
 Removing node_modules/
 Removing public/
 Skipping Git submodules setup
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>试试把nexus上的node删掉，看看nexus是否能自动下载</p> <p>NEXUS上node镜像下来了。编译时间1m3s</p> <p>这个基础，再次更新vuepress，看看编译时间。1m2s，也是这个时间。</p> <p>纳闷了。不用本地库呢？</p> <p>gitlab-ci.yml使用远程库。看看，编译时间1m10s，没差多少。</p> <p>难道是应为runner走的都是nexus？</p> <p>把runner</p> <p>不使用runner、随便3.125上命令行测试docker pull node 1m
// 3.124上还没有node
docker pull 192.168.3.124:8082/node  1m20s
// 3.123已经有node的前提下
docker pull 192.168.3.124:8082/node  15s ， 比外网下载快多了啊。</p> <p>那么，为什么runner上用不用私服差别不大呢？
另外，gitlab-ci.yml中使用image: 192.168.3.124:8082/node:latest开头，应该不对。正确做法应该让gitlabci对nexus无意识，旨在runner上配置。</p> <h2 id="阿里云镜像也不快，还不如不用。"><a href="#阿里云镜像也不快，还不如不用。" class="header-anchor">#</a> 阿里云镜像也不快，还不如不用。</h2> <h3 id="另外，不用阿里云镜像呢-1m5s"><a href="#另外，不用阿里云镜像呢-1m5s" class="header-anchor">#</a> // 另外，不用阿里云镜像呢 , 1m5s</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@centos125:~<span class="token comment"># cat /etc/docker/daemon.json</span>
<span class="token punctuation">{</span>
 // <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://ji1i86y7.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;harbor.ccbjb.com.cn&quot;</span>,<span class="token string">&quot;192.168.3.124:8082&quot;</span>,<span class="token string">&quot;192.168.3.124:8083&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
root@centos125:~<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="使用阿里云镜像呢-1m25s"><a href="#使用阿里云镜像呢-1m25s" class="header-anchor">#</a> //使用阿里云镜像呢 ,1m25s.</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@centos125:~<span class="token comment"># cat /etc/docker/daemon.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://ji1i86y7.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;harbor.ccbjb.com.cn&quot;</span>,<span class="token string">&quot;192.168.3.124:8082&quot;</span>,<span class="token string">&quot;192.168.3.124:8083&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
root@centos125:~<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="使用192-168-3-124：8082做镜像呢？-59s"><a href="#使用192-168-3-124：8082做镜像呢？-59s" class="header-anchor">#</a> //使用192.168.3.124：8082做镜像呢？ 59s</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@centos125:~<span class="token comment"># cat /etc/docker/daemon.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://192.168.3.124:8082&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;harbor.ccbjb.com.cn&quot;</span>,<span class="token string">&quot;192.168.3.124:8082&quot;</span>,<span class="token string">&quot;192.168.3.124:8083&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
root@centos125:~<span class="token comment"># docker pull node</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="使用私服上已经有node-15s"><a href="#使用私服上已经有node-15s" class="header-anchor">#</a> //使用私服上已经有node 15s</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@centos125:~<span class="token comment"># docker pull 192.168.3.124:8082/node</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="如何让docker-pull-自动去找私服，而不用写打私服的tag呢？"><a href="#如何让docker-pull-自动去找私服，而不用写打私服的tag呢？" class="header-anchor">#</a> 如何让docker pull 自动去找私服，而不用写打私服的tag呢？</h2> <h3 id="尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在"><a href="#尝试：registry-mirrors-设置成私库地址，docker-pull-srximg-srximg只在私库上存在" class="header-anchor">#</a> 尝试：registry-mirrors:设置成私库地址，docker pull srximg // srximg只在私库上存在</h3> <p>结果：找不到，出错。
分析：daemon.json里配置的registry-mirrors对“docker pull 不加私服ip”这样的命令不起作用。
结论：想让<code>docker pull 不加私服ip</code> 这样的命令主动去私服下载，别指望daemon.json.</p> <h3 id=""><a href="#" class="header-anchor">#</a></h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/14/2020, 10:43:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/gitlab/2020-8-10-GitlabRunner-neuxs-maven.html" class="prev">
        【how-to-use-gitlab-ci-with-nexus maven】
      </a></span> <span class="next"><a href="/docs/gitlab/2020-8-13-Gitlab-Runner使用nexus私服加速（二）.html">
        【gitlab-runner + nexus】加速docker和npm下载 （二）nginx代理docker库ssl
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.6e55b747.js" defer></script><script src="/docs/assets/js/5.379e7eff.js" defer></script><script src="/docs/assets/js/2.28087ae7.js" defer></script><script src="/docs/assets/js/53.7c3a1c31.js" defer></script><script src="/docs/assets/js/3.32492e15.js" defer></script>
  </body>
</html>
