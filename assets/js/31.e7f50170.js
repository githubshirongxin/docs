(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{507:function(s,t,a){"use strict";a.r(t);var e=a(55),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("我机器192.168.3.105安装的就是这个方法。\n验证过好用。")]),s._v(" "),a("p",[s._v("参考：https://blog.csdn.net/mtldswz312/article/details/98732198?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase")]),s._v(" "),a("h2",{attrs:{id:"第一章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一章"}},[s._v("#")]),s._v(" 第一章")]),s._v(" "),a("h3",{attrs:{id:"_1-1-前期准备工作："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-前期准备工作："}},[s._v("#")]),s._v(" 1.1 前期准备工作：")]),s._v(" "),a("h5",{attrs:{id:"（1）关闭防火墙，和selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（1）关闭防火墙，和selinux"}},[s._v("#")]),s._v(" （1）关闭防火墙，和selinux")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" net-tools ntpdate\nsystemctl stop firewalld\nsystemctl disable firewalld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nsystemctl stop NetworkManager\nsystemctl disable NetworkManager\n")])])]),a("h5",{attrs:{id:"（2）时钟同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（2）时钟同步"}},[s._v("#")]),s._v(" （2）时钟同步")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/10 * * * * /usr/sbin/ntpdate -s 10.100.60.6 >/dev/null 2>&1 && /sbin/clock -w'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/spool/cron/root \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" crond restart \nntpdate -s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".60.6\n")])])]),a("h5",{attrs:{id:"（3）私有主机禁用swap分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（3）私有主机禁用swap分区"}},[s._v("#")]),s._v(" （3）私有主机禁用swap分区")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("swapoff -a   \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/fstab ")]),s._v("\n/dev/mapper/centos-root /                       xfs     defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("8d103c59-0306-4493-94f2-1e3726d87cfb /boot                   xfs     defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/dev/mapper/centos-swap swap                    swap    defaults        0 0")]),s._v("\n")])])]),a("h5",{attrs:{id:"（4）互相解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（4）互相解析"}},[s._v("#")]),s._v(" （4）互相解析")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n192.168.3.105 centos1\n192.168.3.106 centos2\n192.168.3.107 centos3\n192.168.3.105 master01\n192.168.3.106 node01\n192.168.3.107 node02\nEOF")]),s._v("\n")])])]),a("h5",{attrs:{id:"（5）master对node节点ssh互信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（5）master对node节点ssh互信"}},[s._v("#")]),s._v(" （5）master对node节点ssh互信")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id node01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id node02")]),s._v("\n")])])]),a("h5",{attrs:{id:"（6）修改内核参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（6）修改内核参数"}},[s._v("#")]),s._v(" （6）修改内核参数")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/k8s.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n\nsysctl --system\n")])])]),a("h2",{attrs:{id:"第二章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二章"}},[s._v("#")]),s._v(" 第二章")]),s._v(" "),a("p",[s._v("注意：以下在所有节点执行（master+node），安装docker，kubeadm，kubelet")]),s._v(" "),a("h3",{attrs:{id:"_1、配置docker源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置docker源"}},[s._v("#")]),s._v(" 1、配置docker源")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/yum.repos.d/docker.repo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[docker-repo]\nname=Docker Repository\nbaseurl=http://mirrors.aliyun.com/docker-engine/yum/repo/main/centos/7\nenabled=1\ngpgcheck=0\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置kubernetes源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/yum.repos.d/kubernetes.repo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nEOF")]),s._v("\n\nyum clean all\nyum makecache\n")])])]),a("h3",{attrs:{id:"_2、安装kubeadm和相关工具包（所有节点）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装kubeadm和相关工具包（所有节点）"}},[s._v("#")]),s._v(" 2、安装kubeadm和相关工具包（所有节点）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker --disableexcludes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker-repo\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start docker\n\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet-1.15.3 kubeadm-1.15.3 kubectl-1.15.3 --disableexcludes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start kubelet\n")])])]),a("p",[s._v("（现在版本1.18.5国内镜像没有，所以降低了一点）")]),s._v(" "),a("h3",{attrs:{id:"_3、初始kubeadm集群环境（仅master节点）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、初始kubeadm集群环境（仅master节点）"}},[s._v("#")]),s._v(" 3、初始kubeadm集群环境（仅master节点）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubeadm init --image-repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.aliyuncs.com/google_containers --service-cidr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/16 --pod-network-cidr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16 --kubernetes-version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.15.3\n")])])]),a("p",[a("strong",[s._v("安装完成后记录一下")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using Kubernetes version: v1.15.3\nYour Kubernetes control-plane has initialized successfully"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.105:6443 --token p9916m.96bm9res6l15zusq "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:3ce5cc691f042b2ee466365064fa858132e8149ca8e623bd6d2997ef0601c886\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n \n")])])]),a("p",[a("strong",[s._v("确认：")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME       STATUS     ROLES    AGE     VERSION     \nmaster01   NotReady   master   2m42s   v1.15.3      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#状态是Notready，在等待网络的加入")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n kube-system      #看到有2个pod处于pending")]),s._v("\nNAME                               READY   STATUS    RESTARTS   AGE\ncoredns-bccdc95cf-bhtms            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m18s\ncoredns-bccdc95cf-jmbds            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m17s\netcd-master01                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m30s\nkube-apiserver-master01            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m15s\nkube-controller-manager-master01   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m23s\nkube-proxy-n62h7                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m18s\nkube-scheduler-master01            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m14s\n")])])]),a("h3",{attrs:{id:"_4、在master节点上安装flannel网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、在master节点上安装flannel网络"}},[s._v("#")]),s._v(" 4、在master节点上安装flannel网络")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/bc79dd1505b0c8681ece4de4c0d86c5cd2643275/Documentation/kube-flannel.yml\n")])])]),a("p",[s._v("("),a("font",{attrs:{color:"red"}},[s._v("raw.githubusercontent.com找不到。因为对应的IP被墙了。解决见下面TroubleShooting问题1")]),s._v(")")],1),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n kube-system    #看到所有的pod都处于running状态。")]),s._v("\nNAME                               READY   STATUS    RESTARTS   AGE\ncoredns-bccdc95cf-bhtms            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m4s\ncoredns-bccdc95cf-jmbds            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m3s\netcd-master01                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m16s\nkube-apiserver-master01            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m1s\nkube-controller-manager-master01   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m9s\nkube-flannel-ds-amd64-6jjwf        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          59s\nkube-proxy-n62h7                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6m4s\nkube-scheduler-master01            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m\n")])])]),a("h3",{attrs:{id:"_5、添加计算节点（在节点上执行）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、添加计算节点（在节点上执行）"}},[s._v("#")]),s._v(" 5、添加计算节点（在节点上执行）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm join 192.168.3.105:6443 --token p9916m.96bm9res6l15zusq \\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:3ce5cc691f042b2ee466365064fa858132e8149ca8e623bd6d2997ef0601c886 \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node02 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm join 192.168.3.105:6443 --token p9916m.96bm9res6l15zusq \\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:3ce5cc691f042b2ee466365064fa858132e8149ca8e623bd6d2997ef0601c886\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME       STATUS     ROLES    AGE     VERSION\nmaster01   Ready      master   8m55s   v1.15.3\nnode01     NotReady   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   37s     v1.15.3\nnode02     NotReady   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   14s     v1.15.3\n")])])]),a("h3",{attrs:{id:"_6、部署dashboard（在master上操作）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、部署dashboard（在master上操作）"}},[s._v("#")]),s._v(" 6、部署dashboard（在master上操作）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta1/aio/deploy/recommended.yaml")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods --namespace=kubernetes-dashboard      #查看创建的namespace")]),s._v("\nNAME                                          READY   STATUS    RESTARTS   AGE\nkubernetes-dashboard-5c8f9556c4-w6pzj         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          7m46s\nkubernetes-metrics-scraper-86456cdd8f-7js7v   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          7m46s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service --namespace=kubernetes-dashboard   #查看端口映射关系")]),s._v("\nNAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         AGE\ndashboard-metrics-scraper   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".83.31     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("/TCP        55m\nkubernetes-dashboard        NodePort    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".192.48   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":30520/TCP   55m\n")])])]),a("h3",{attrs:{id:"_7、修改service配置，将type-clusterip改成nodeport"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、修改service配置，将type-clusterip改成nodeport"}},[s._v("#")]),s._v(" 7、修改service配置，将type: ClusterIP改成NodePort")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit service kubernetes-dashboard --namespace=kubernetes-dashboard")]),s._v("\n如下：\nspec:\n  clusterIP: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".192.48\n  externalTrafficPolicy: Cluster\n  ports:\n  - nodePort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30924")]),s._v("\n    port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    protocol: TCP\n    targetPort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n  selector:\n    k8s-app: kubernetes-dashboard\n  sessionAffinity: None\n  type: NodePort      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意这行。")]),s._v("\n")])])]),a("h3",{attrs:{id:"_8、创建dashboard-admin-token（仅master上执行）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、创建dashboard-admin-token（仅master上执行）"}},[s._v("#")]),s._v(" 8、创建dashboard admin-token（仅master上执行）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/root/admin-token.yaml"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: admin\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: "true"\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\nsubjects:\n- kind: ServiceAccount\n  name: admin\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin\n  namespace: kube-system\n  labels:\n    kubernetes.io/cluster-service: "true"\n    addonmanager.kubernetes.io/mode: Reconcile\nEOF')]),s._v("\n")])])]),a("p",[s._v("（"),a("font",{attrs:{color:"red"}},[s._v("直接拷贝会有乱字符,从别的网址搜索admin-token.yaml内容都一样，试试看")]),s._v("）")],1),s._v(" "),a("h6",{attrs:{id:"创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[s._v("#")]),s._v(" 创建用户")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f admin-token.yaml")]),s._v("\nclusterrolebinding.rbac.authorization.k8s.io/admin created\nserviceaccount/admin created\n")])])]),a("h6",{attrs:{id:"获取token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取token"}},[s._v("#")]),s._v(" 获取token")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe secret/$(kubectl get secret -nkube-system |grep admin|awk '{print $1}') -nkube-s ystem")]),s._v("\nName:         admin-token-pq6z6\nNamespace:    kube-system\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  kubernetes.io/service-account.name: admin\n              kubernetes.io/service-account.uid: 3f9d518a-228a-4489-9df7-a391e0f0fb48\n\nType:  kubernetes.io/service-account-token\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nnamespace:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi1wcTZ6NiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjNmOWQ1MThhLTIyOGEtNDQ4OS05ZGY3LWEzOTFlMGYwZmI0OCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphZG1pbiJ9.rTrAY1oFNbGmcCtJ_uecMzaFgpCuoJoGMYJfmlppDD7DaoaWZjLYCA9GQWFI9yEb0lyu3Y8jotO_MRO8GuPQ5Tv1CiplEaeTGWf77hTM1iIqRFTGV67yZOKaVoyr-Ck-k5UVGwq5uEGSiYNUm18q88qr7CBS9Xjw5x2lrzAo4tucpsr6NeVWL29MBoE6KVb42RiIelCxC_I3zdmYNpv4YWPaT-YOHJCcwx5N8cxcba44pSUEtOIBM8rVHTWdbE9LbdJ6etIewDKxH8RCqdzU4vq7u5oGXoVsNVwyfIiObQSi9b9-J5aiEGZaqj2UmlaiROzytf03GEUgCj-ES8SMfg\nca.crt:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1025")]),s._v(" bytes\n")])])]),a("h3",{attrs:{id:"_9-登录dashboard-必须用火狐浏览器https-192-168-3-105-30924"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-登录dashboard-必须用火狐浏览器https-192-168-3-105-30924"}},[s._v("#")]),s._v(" 9.登录dashboard 必须用火狐浏览器https://192.168.3.105:30924")]),s._v(" "),a("p",[s._v("选token方式，输入上面的token")]),s._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")]),s._v(" "),a("img",{attrs:{src:"/docs/images/2020-06-29-21-16-42.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"【trubleshooting】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【trubleshooting】"}},[s._v("#")]),s._v(" 【TrubleShooting】")]),s._v(" "),a("h4",{attrs:{id:"问题1：raw-githubusercontent-com-找不到不识别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题1：raw-githubusercontent-com-找不到不识别"}},[s._v("#")]),s._v(" [问题1：raw.githubusercontent.com 找不到不识别]")]),s._v(" "),a("p",[a("strong",[s._v("解决：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("https://site.ip138.com/raw.Githubusercontent.com/\n\n输入raw.githubusercontent.com\n\n查询IP地址\n\n修改hosts Ubuntu，CentOS及macOS直接在终端输入\n\nsudo vi /etc/hosts\n \n\n添加以下内容保存即可 （IP地址查询后相应修改，可以ping不同IP的延时 选择最佳IP地址）\n\n# GitHub Start\n52.74.223.119 github.com\n192.30.253.119 gist.github.com\n54.169.195.247 api.github.com\n185.199.111.153 assets-cdn.github.com\n151.101.76.133 raw.githubusercontent.com\n151.101.108.133 user-images.githubusercontent.com\n151.101.76.133 gist.githubusercontent.com\n151.101.76.133 cloud.githubusercontent.com\n151.101.76.133 camo.githubusercontent.com\n151.101.76.133 avatars0.githubusercontent.com\n151.101.76.133 avatars1.githubusercontent.com\n151.101.76.133 avatars2.githubusercontent.com\n151.101.76.133 avatars3.githubusercontent.com\n151.101.76.133 avatars4.githubusercontent.com\n151.101.76.133 avatars5.githubusercontent.com\n151.101.76.133 avatars6.githubusercontent.com\n151.101.76.133 avatars7.githubusercontent.com\n151.101.76.133 avatars8.githubusercontent.com\n# GitHub End\n\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);